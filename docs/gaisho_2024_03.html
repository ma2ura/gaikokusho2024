<!DOCTYPE html>
<html lang="ja"><head>
<script src="gaisho_2024_03_files/libs/clipboard/clipboard.min.js"></script>
<script src="gaisho_2024_03_files/libs/quarto-html/tabby.min.js"></script>
<script src="gaisho_2024_03_files/libs/quarto-html/popper.min.js"></script>
<script src="gaisho_2024_03_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="gaisho_2024_03_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="gaisho_2024_03_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="gaisho_2024_03_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="gaisho_2024_03_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.56">

  <meta name="author" content="Soichi Matsuura">
  <title>外国書購読 Day3  Analysis of Accounting Transactions</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="gaisho_2024_03_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="gaisho_2024_03_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="gaisho_2024_03_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="mystyle.css">
  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">
  <link href="gaisho_2024_03_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="gaisho_2024_03_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="gaisho_2024_03_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="gaisho_2024_03_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="gaisho_2024_03_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="gaisho_2024_03_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="gaisho_2024_03_files/libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="gaisho_2024_03_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
  <style>
  .v-center-container {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/editor/editor.main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
  <style type="text/css">
  .monaco-editor pre {
    background-color: unset !important;
  }

  .qwebr-editor-toolbar {
    width: 100%;
    display: flex;
    justify-content: space-between;
    box-sizing: border-box;
  }

  .qwebr-editor-toolbar-left-buttons, .qwebr-editor-toolbar-right-buttons {
    display: flex;
  }

  .qwebr-non-interactive-loading-container.qwebr-cell-needs-evaluation, .qwebr-non-interactive-loading-container.qwebr-cell-evaluated {
    justify-content: center;
    display: flex;
    background-color: rgba(250, 250, 250, 0.65);
    border: 1px solid rgba(233, 236, 239, 0.65);
    border-radius: 0.5rem;
    margin-top: 15px;
    margin-bottom: 15px;
  }

  .qwebr-r-project-logo {
    color: #2767B0; /* R Project's blue color */
  }

  .qwebr-icon-status-spinner {
    color: #7894c4;
  }

  .qwebr-icon-run-code {
    color: #0d9c29
  }

  body.quarto-light .qwebr-output-code-stdout {
    color: #111;
  }

  body.quarto-dark .qwebr-output-code-stdout {
    color: #EEE;
  }

  .qwebr-output-code-stderr {
    color: #db4133;
  }

  body.quarto-light .qwebr-editor {
    border: 1px solid #EEEEEE;
  }

  body.quarto-light .qwebr-editor-toolbar {
    background-color: #EEEEEE;
    padding: 0.2rem 0.5rem;
  }

  body.quarto-dark .qwebr-editor {
    border: 1px solid #111;
  }

  body.quarto-dark .qwebr-editor-toolbar {
    background-color: #111;
    padding: 0.2rem 0.5rem;
  }

  .qwebr-button {
    display: inline-block;
    font-weight: 400;
    line-height: 1;
    text-decoration: none;
    text-align: center;
    padding: 0.375rem 0.75rem;
    font-size: .9rem;
    border-radius: 0.25rem;
    transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
  }

  body.quarto-light .qwebr-button {
    background-color: #EEEEEE;
    color: #000;
    border-color: #dee2e6;
    border: 1px solid rgba(0,0,0,0);
  }

  body.quarto-dark .qwebr-button {
    background-color: #111;
    color: #EEE;
    border-color: #dee2e6;
    border: 1px solid rgba(0,0,0,0);
  }

  body.quarto-light .qwebr-button:hover {
    color: #000;
    background-color: #d9dce0;
    border-color: #c8ccd0;
  }

  body.quarto-dark .qwebr-button:hover {
    color: #d9dce0;
    background-color: #323232;
    border-color: #d9dce0;
  }

  .qwebr-button:disabled,.qwebr-button.disabled,fieldset:disabled .qwebr-button {
    pointer-events: none;
    opacity: .65
  }

  .qwebr-button-reset {
    color: #696969; /*#4682b4;*/
  }

  .qwebr-button-copy {
    color: #696969;
  }

  /* Style the code highlight lines */
  body.quarto-light .qwebr-editor-highlight-line {
    background-color: lightblue;
  }

  body.quarto-dark .qwebr-editor-highlight-line {
    background-color: darkblue;
  }

  /* Style the modal pop-up */

  /* The Modal (background) */
  .qwebr-modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    padding-top: 60px;
  }

  /* Modal Content */
  .qwebr-modal-content {
    background-color: #fefefe;
    margin: 5% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
  }

  .qwebr-modal-content-code {
    max-height: 50vh;
    min-height: 5vh;
    overflow: scroll;
    border: 1px solid #888;
  }

  /* The Close Button */
  .qwebr-modal-close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .qwebr-modal-close:hover,
  .qwebr-modal-close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  .qwebr-download-btn {
    margin-top: 10px;
    text-decoration: none !important;
  }

  /* Styling to download image that is created */

  .qwebr-canvas-image {
    position: relative;
    display: inline-block;
    margin: 10px;
  }

  .qwebr-canvas-image-download-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 5px 10px;
    background-color: #007BFF;
    color: white;
    border: none;
    cursor: pointer;
    display: none;
  }

  figure:hover .qwebr-canvas-image-download-btn {
    display: block;
  }

  /* Custom styling for RevealJS Presentations*/

  /* Reset the style of the interactive area */
  .reveal div.qwebr-interactive-area {
    display: block;
    box-shadow: none;
    max-width: 100%;
    max-height: 100%;
    margin: 0;
    padding: 0;
  } 

  /* Provide space to entries */
  .reveal div.qwebr-output-code-area pre div {
    margin: 1px 2px 1px 10px;
  }

  /* Collapse the inside code tags to avoid extra space between line outputs */
  .reveal pre div code.qwebr-output-code-stdout, .reveal pre div code.qwebr-output-code-stderr {
    padding: 0;
    display: contents;
  }

  body.reveal.quarto-light pre div code.qwebr-output-code-stdout {
    color: #111;
  }

  body.reveal.quarto-dark pre div code.qwebr-output-code-stdout {
    color: #EEEEEE;
  }

  .reveal pre div code.qwebr-output-code-stderr {
    color: #db4133;
  }


  /* Create a border around console and output (does not effect graphs) */
  body.reveal.quarto-light div.qwebr-console-area {
    border: 1px solid #EEEEEE;
    box-shadow: 2px 2px 10px #EEEEEE;
  }

  body.reveal.quarto-dark div.qwebr-console-area {
    border: 1px solid #111;
    box-shadow: 2px 2px 10px #111;
  }


  /* Cap output height and allow text to scroll */
  /* TODO: Is there a better way to fit contents/max it parallel to the monaco editor size? */
  .reveal div.qwebr-output-code-area pre {
    max-height: 400px;
    overflow: scroll;
  }

  </style>
  <script type="module">
  // Document level settings ----

  // Determine if we need to install R packages
  globalThis.qwebrInstallRPackagesList = ['dplyr', 'lubridate', 'readr'];

  // Specify possible locations to search for the repository
  globalThis.qwebrPackageRepoURLS = ['https://repo.r-wasm.org/'];

  // Check to see if we have an empty array, if we do set to skip the installation.
  globalThis.qwebrSetupRPackages = !(qwebrInstallRPackagesList.indexOf("") !== -1);
  globalThis.qwebrAutoloadRPackages = true;

  // Display a startup message?
  globalThis.qwebrShowStartupMessage = true;
  globalThis.qwebrShowHeaderMessage = false;

  // Describe the webR settings that should be used
  globalThis.qwebrCustomizedWebROptions = {
    "baseURL": "https://webr.r-wasm.org/v0.4.0/",
    "serviceWorkerUrl": "",
    "homedir": "/home/web_user", 
    "channelType": "ChannelType.Automatic"
  };

  // Store cell data
  globalThis.qwebrCellDetails = [{"code":"d <- c(1, 2, 3, \"4\", 5)\n# What is the class of d?\nclass(d)\n\ne <- c(1, 2, 3, NA, 5, 6)\n# What is the class of e?\nclass(e)","id":1,"options":{"output":"true","fig-cap":"","autorun":"false","editor-quick-suggestions":"false","comment":"","read-only":"false","editor-word-wrap":"true","editor-max-height":"","context":"interactive","dpi":72,"fig-width":7,"message":"true","classes":"","results":"markup","out-width":"700px","out-height":"","label":"unnamed-chunk-1","editor-font-scale":"0.5","fig-height":5,"warning":"true"}},{"code":"mydata <- data.frame(\n  ID = c(1, 2, 3, 4),\n  Color = c(\"red\", \"white\", \"red\", NA),\n  Passed = c(TRUE, TRUE, TRUE, FALSE)\n)\n\n# mydataからColorを取り出す\n\n# mydataからIDの3番目の要素を取り出す","id":2,"options":{"output":"true","fig-cap":"","autorun":"false","editor-quick-suggestions":"false","comment":"","read-only":"false","editor-word-wrap":"true","editor-max-height":"","context":"interactive","dpi":72,"fig-width":7,"message":"true","classes":"","results":"markup","out-width":"700px","out-height":"","label":"unnamed-chunk-2","editor-font-scale":"0.5","fig-height":5,"warning":"true"}},{"code":"mylist <- list(\n  a = c(\"one\", \"two\", \"three\"),\n  b = c(1,2,3),\n  c = matrix(1:9, nrow = 3)\n)\n# mylistからaを取り出す\n\n# mylistからbの2番目の要素を取り出す","id":3,"options":{"output":"true","fig-cap":"","autorun":"false","editor-quick-suggestions":"false","comment":"","read-only":"false","editor-word-wrap":"true","editor-max-height":"","context":"interactive","dpi":72,"fig-width":7,"message":"true","classes":"","results":"markup","out-width":"700px","out-height":"","label":"unnamed-chunk-3","editor-font-scale":"0.5","fig-height":5,"warning":"true"}},{"code":"# 2024年10月16日を日付オブジェクトstartとして作成\n\n# 2025年10月16日を日付オブジェクトendとして作成\n\n# start から年をyear, 月をmonthとして作成","id":4,"options":{"output":"true","fig-cap":"","autorun":"false","editor-quick-suggestions":"false","comment":"","read-only":"false","editor-word-wrap":"true","editor-max-height":"","context":"interactive","dpi":72,"fig-width":7,"message":"true","classes":"","results":"markup","out-width":"700px","out-height":"","label":"unnamed-chunk-4","editor-font-scale":"0.5","fig-height":5,"warning":"true"}}];

  </script>
  <script type="module">
  // Declare startupMessageQWebR globally
  globalThis.qwebrStartupMessage = document.createElement("p");

  // Verify if OffScreenCanvas is supported
  globalThis.qwebrOffScreenCanvasSupport = function() {
    return typeof OffscreenCanvas !== 'undefined'
  }

  // Function to set the button text
  globalThis.qwebrSetInteractiveButtonState = function(buttonText, enableCodeButton = true) {
    document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
      btn.innerHTML = buttonText;
      btn.disabled = !enableCodeButton;
    });
  }

  // Function to update the status message in non-interactive cells
  globalThis.qwebrUpdateStatusMessage = function(message) {
    document.querySelectorAll(".qwebr-status-text.qwebr-cell-needs-evaluation").forEach((elem) => {
      elem.innerText = message;
    });
  }

  // Function to update the status message
  globalThis.qwebrUpdateStatusHeader = function(message) {
    qwebrStartupMessage.innerHTML = `
      <i class="fa-solid fa-spinner fa-spin qwebr-icon-status-spinner"></i>
      <span>${message}</span>`;
  }

  // Function to return true if element is found, false if not
  globalThis.qwebrCheckHTMLElementExists = function(selector) {
    const element = document.querySelector(selector);
    return !!element;
  }

  // Function that detects whether reveal.js slides are present
  globalThis.qwebrIsRevealJS = function() {
    // If the '.reveal .slides' selector exists, RevealJS is likely present
    return qwebrCheckHTMLElementExists('.reveal .slides');
  }

  // Initialize the Quarto sidebar element
  function qwebrSetupQuartoSidebar() {
    var newSideBarDiv = document.createElement('div');
    newSideBarDiv.id = 'quarto-margin-sidebar';
    newSideBarDiv.className = 'sidebar margin-sidebar';
    newSideBarDiv.style.top = '0px';
    newSideBarDiv.style.maxHeight = 'calc(0px + 100vh)';

    return newSideBarDiv;
  }

  // Position the sidebar in the document
  function qwebrPlaceQuartoSidebar() {
    // Get the reference to the element with id 'quarto-document-content'
    var referenceNode = document.getElementById('quarto-document-content');

    // Create the new div element
    var newSideBarDiv = qwebrSetupQuartoSidebar();

    // Insert the new div before the 'quarto-document-content' element
    referenceNode.parentNode.insertBefore(newSideBarDiv, referenceNode);
  }

  function qwebrPlaceMessageContents(content, html_location = "title-block-header", revealjs_location = "title-slide") {

    // Get references to header elements
    const headerHTML = document.getElementById(html_location);
    const headerRevealJS = document.getElementById(revealjs_location);

    // Determine where to insert the quartoTitleMeta element
    if (headerHTML || headerRevealJS) {
      // Append to the existing "title-block-header" element or "title-slide" div
      (headerHTML || headerRevealJS).appendChild(content);
    } else {
      // If neither headerHTML nor headerRevealJS is found, insert after "webr-monaco-editor-init" script
      const monacoScript = document.getElementById("qwebr-monaco-editor-init");
      const header = document.createElement("header");
      header.setAttribute("id", "title-block-header");
      header.appendChild(content);
      monacoScript.after(header);
    }
  }



  function qwebrOffScreenCanvasSupportWarningMessage() {
    
    // Verify canvas is supported.
    if(qwebrOffScreenCanvasSupport()) return;

    // Create the main container div
    var calloutContainer = document.createElement('div');
    calloutContainer.classList.add('callout', 'callout-style-default', 'callout-warning', 'callout-titled');

    // Create the header div
    var headerDiv = document.createElement('div');
    headerDiv.classList.add('callout-header', 'd-flex', 'align-content-center');

    // Create the icon container div
    var iconContainer = document.createElement('div');
    iconContainer.classList.add('callout-icon-container');

    // Create the icon element
    var iconElement = document.createElement('i');
    iconElement.classList.add('callout-icon');

    // Append the icon element to the icon container
    iconContainer.appendChild(iconElement);

    // Create the title container div
    var titleContainer = document.createElement('div');
    titleContainer.classList.add('callout-title-container', 'flex-fill');
    titleContainer.innerText = 'Warning: Web Browser Does Not Support Graphing!';

    // Append the icon container and title container to the header div
    headerDiv.appendChild(iconContainer);
    headerDiv.appendChild(titleContainer);

    // Create the body container div
    var bodyContainer = document.createElement('div');
    bodyContainer.classList.add('callout-body-container', 'callout-body');

    // Create the paragraph element for the body content
    var paragraphElement = document.createElement('p');
    paragraphElement.innerHTML = 'This web browser does not have support for displaying graphs through the <code>quarto-webr</code> extension since it lacks an <code>OffScreenCanvas</code>. Please upgrade your web browser to one that supports <code>OffScreenCanvas</code>.';

    // Append the paragraph element to the body container
    bodyContainer.appendChild(paragraphElement);

    // Append the header div and body container to the main container div
    calloutContainer.appendChild(headerDiv);
    calloutContainer.appendChild(bodyContainer);

    // Append the main container div to the document depending on format
    qwebrPlaceMessageContents(calloutContainer, "title-block-header"); 

  }


  // Function that attaches the document status message and diagnostics
  function displayStartupMessage(showStartupMessage, showHeaderMessage) {
    if (!showStartupMessage) {
      return;
    }

    // Create the outermost div element for metadata
    const quartoTitleMeta = document.createElement("div");
    quartoTitleMeta.classList.add("quarto-title-meta");

    // Create the first inner div element
    const firstInnerDiv = document.createElement("div");
    firstInnerDiv.setAttribute("id", "qwebr-status-message-area");

    // Create the second inner div element for "WebR Status" heading and contents
    const secondInnerDiv = document.createElement("div");
    secondInnerDiv.setAttribute("id", "qwebr-status-message-title");
    secondInnerDiv.classList.add("quarto-title-meta-heading");
    secondInnerDiv.innerText = "WebR Status";

    // Create another inner div for contents
    const secondInnerDivContents = document.createElement("div");
    secondInnerDivContents.setAttribute("id", "qwebr-status-message-body");
    secondInnerDivContents.classList.add("quarto-title-meta-contents");

    // Describe the WebR state
    qwebrStartupMessage.innerText = "🟡 Loading...";
    qwebrStartupMessage.setAttribute("id", "qwebr-status-message-text");
    // Add `aria-live` to auto-announce the startup status to screen readers
    qwebrStartupMessage.setAttribute("aria-live", "assertive");

    // Append the startup message to the contents
    secondInnerDivContents.appendChild(qwebrStartupMessage);

    // Add a status indicator for COOP and COEP Headers if needed
    if (showHeaderMessage) {
      const crossOriginMessage = document.createElement("p");
      crossOriginMessage.innerText = `${crossOriginIsolated ? '🟢' : '🟡'} COOP & COEP Headers`;
      crossOriginMessage.setAttribute("id", "qwebr-coop-coep-header");
      secondInnerDivContents.appendChild(crossOriginMessage);
    }

    // Combine the inner divs and contents
    firstInnerDiv.appendChild(secondInnerDiv);
    firstInnerDiv.appendChild(secondInnerDivContents);
    quartoTitleMeta.appendChild(firstInnerDiv);

    // Place message on webpage
    qwebrPlaceMessageContents(quartoTitleMeta); 
  }

  function qwebrAddCommandHistoryModal() {
    // Create the modal div
    var modalDiv = document.createElement('div');
    modalDiv.id = 'qwebr-history-modal';
    modalDiv.className = 'qwebr-modal';

    // Create the modal content div
    var modalContentDiv = document.createElement('div');
    modalContentDiv.className = 'qwebr-modal-content';

    // Create the span for closing the modal
    var closeSpan = document.createElement('span');
    closeSpan.id = 'qwebr-command-history-close-btn';
    closeSpan.className = 'qwebr-modal-close';
    closeSpan.innerHTML = '&times;';

    // Create the h1 element for the modal
    var modalH1 = document.createElement('h1');
    modalH1.textContent = 'R History Command Contents';

    // Create an anchor element for downloading the Rhistory file 
    var downloadLink = document.createElement('a');
    downloadLink.href = '#';
    downloadLink.id = 'qwebr-download-history-btn';
    downloadLink.className = 'qwebr-download-btn';

    // Create an 'i' element for the icon
    var icon = document.createElement('i');
    icon.className = 'bi bi-file-code';

    // Append the icon to the anchor element
    downloadLink.appendChild(icon);

    // Add the text 'Download R History' to the anchor element
    downloadLink.appendChild(document.createTextNode(' Download R History File'));

    // Create the pre for command history contents
    var commandContentsPre = document.createElement('pre');
    commandContentsPre.id = 'qwebr-command-history-contents';
    commandContentsPre.className = 'qwebr-modal-content-code';

    // Append the close span, h1, and history contents pre to the modal content div
    modalContentDiv.appendChild(closeSpan);
    modalContentDiv.appendChild(modalH1);
    modalContentDiv.appendChild(downloadLink);
    modalContentDiv.appendChild(commandContentsPre);

    // Append the modal content div to the modal div
    modalDiv.appendChild(modalContentDiv);

    // Append the modal div to the body
    document.body.appendChild(modalDiv);
  }

  function qwebrRegisterRevealJSCommandHistoryModal() {
    // Select the <ul> element inside the <div> with data-panel="Custom0"
    let ulElement = document.querySelector('div[data-panel="Custom0"] > ul.slide-menu-items');

    // Find the last <li> element with class slide-tool-item
    let lastItem = ulElement.querySelector('li.slide-tool-item:last-child');

    // Calculate the next data-item value
    let nextItemValue = 0;
    if (lastItem) {
        nextItemValue = parseInt(lastItem.dataset.item) + 1;
    }

    // Create a new <li> element
    let newListItem = document.createElement('li');
    newListItem.className = 'slide-tool-item';
    newListItem.dataset.item = nextItemValue.toString(); // Set the next available data-item value

    // Create the <a> element inside the <li>
    let newLink = document.createElement('a');
    newLink.href = '#';
    newLink.id = 'qwebrRHistoryButton'; // Set the ID for the new link
    
    // Create the <kbd> element inside the <a>
    let newKbd = document.createElement('kbd');
    newKbd.textContent = ' '; // Set to empty as we are not registering a keyboard shortcut

    // Create text node for the link text
    let newText = document.createTextNode(' View R History');

    // Append <kbd> and text node to <a>
    newLink.appendChild(newKbd);
    newLink.appendChild(newText);

    // Append <a> to <li>
    newListItem.appendChild(newLink);

    // Append <li> to <ul>
    ulElement.appendChild(newListItem);
  }

  // Handle setting up the R history modal
  function qwebrCodeLinks() {

    if (qwebrIsRevealJS()) {
      qwebrRegisterRevealJSCommandHistoryModal();
      return;
    }

    // Create the container div
    var containerDiv = document.createElement('div');
    containerDiv.className = 'quarto-code-links';

    // Create the h2 element
    var h2 = document.createElement('h2');
    h2.textContent = 'webR Code Links';

    // Create the ul element
    var ul = document.createElement('ul');

    // Create the li element
    var li = document.createElement('li');

    // Create the a_history_btn element
    var a_history_btn = document.createElement('a');
    a_history_btn.href = 'javascript:void(0)';
    a_history_btn.setAttribute('id', 'qwebrRHistoryButton');

    // Create the i_history_btn element
    var i_history_btn = document.createElement('i');
    i_history_btn.className = 'bi bi-file-code';

    // Create the text node for the link text
    var text_history_btn = document.createTextNode('View R History');

    // Append the icon element and link text to the a element
    a_history_btn.appendChild(i_history_btn);
    a_history_btn.appendChild(text_history_btn);

    // Append the a element to the li element
    li.appendChild(a_history_btn);

    // Append the li element to the ul element
    ul.appendChild(li);

    // Append the h2 and ul elements to the container div
    containerDiv.appendChild(h2);
    containerDiv.appendChild(ul);

    // Append the container div to the element with the ID 'quarto-margin-sidebar'
    var sidebar = document.getElementById('quarto-margin-sidebar');
      
    // If the sidebar element is not found, create it
    if(!sidebar) {
      qwebrPlaceQuartoSidebar();
    }
    
    // Re-select the sidebar element (if it was just created)
    sidebar = document.getElementById('quarto-margin-sidebar');   


    // If the sidebar element exists, append the container div to it
    if(sidebar) {
      // Append the container div to the sidebar
      sidebar.appendChild(containerDiv);
      // Force the sidebar to be clickable by removing the 'zindex-bottom' class
      // added in pre-release: https://github.com/quarto-dev/quarto-cli/commit/f0c53a1ffcaa1de4eccbf07803b096898248adcc
      sidebar.className = 'sidebar margin-sidebar';
    } else {
      // Get a debugger ...
      console.warn('Element with ID "quarto-margin-sidebar" not found.');
    }
  }

  // Call the function to append the code links for qwebR into the right sidebar
  qwebrCodeLinks();

  // Add the command history modal
  qwebrAddCommandHistoryModal();

  displayStartupMessage(qwebrShowStartupMessage, qwebrShowHeaderMessage);
  qwebrOffScreenCanvasSupportWarningMessage();
  </script>
  <script type="module">
  // Define a global storage and retrieval solution ----

  // Store commands executed in R
  globalThis.qwebrRCommandHistory = [];

  // Function to retrieve the command history
  globalThis.qwebrFormatRHistory = function() {
     return qwebrRCommandHistory.join("\n\n");
  }

  // Retrieve HTML Elements ----

  // Get the command modal
  const command_history_modal = document.getElementById("qwebr-history-modal");

  // Get the button that opens the command modal
  const command_history_btn = document.getElementById("qwebrRHistoryButton");

  // Get the <span> element that closes the command modal
  const command_history_close_span = document.getElementById("qwebr-command-history-close-btn");

  // Get the download button for r history information
  const command_history_download_btn = document.getElementById("qwebr-download-history-btn");

  // Plug in command history into modal/download button ----

  // Function to populate the modal with command history
  function populateCommandHistoryModal() {
      document.getElementById("qwebr-command-history-contents").innerHTML = qwebrFormatRHistory() || "No commands have been executed yet.";
  }

  // Function to format the current date and time to
  // a string with the format YYYY-MM-DD-HH-MM-SS
  function formatDateTime() {
      const now = new Date();

      const year = now.getFullYear();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are zero-based
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');

      return `${year}-${month}-${day}-${hours}-${minutes}-${seconds}`;
  }


  // Function to convert document title with datetime to a safe filename
  function safeFileName() {
      // Get the current page title
      let pageTitle = document.title;

      // Combine the current page title with the current date and time
      let pageNameWithDateTime = `Rhistory-${pageTitle}-${formatDateTime()}`;

      // Replace unsafe characters with safe alternatives
      let safeFilename = pageNameWithDateTime.replace(/[\\/:\*\?! "<>\|]/g, '-');

      return safeFilename;
  }


  // Function to download list contents as text file
  function downloadRHistory() {
      // Get the current page title + datetime and use it as the filename
      const filename = `${safeFileName()}.R`;

      // Get the text contents of the R History list
      const text = qwebrFormatRHistory();

      // Create a new Blob object with the text contents
      const blob = new Blob([text], { type: 'text/plain' });
    
      // Create a new anchor element for the download
      const a = document.createElement('a');
      a.style.display = 'none';
      a.href = URL.createObjectURL(blob);
      a.download = filename;

      // Append the anchor to the body, click it, and remove it
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
  }

  // Register event handlers ----

  // When the user clicks the View R History button, open the command modal
  command_history_btn.onclick = function() {
      populateCommandHistoryModal();
      command_history_modal.style.display = "block";
  }

  // When the user clicks on <span> (x), close the command modal
  command_history_close_span.onclick = function() {
      command_history_modal.style.display = "none";
  }

  // When the user clicks anywhere outside of the command modal, close it
  window.onclick = function(event) {
      if (event.target == command_history_modal) {
          command_history_modal.style.display = "none";
      }
  }

  // Add an onclick event listener to the download button so that
  // the user can download the R history as a text file
  command_history_download_btn.onclick = function() {
      downloadRHistory();
  };
  </script>
  <script type="module">
  // Supported Evaluation Types for Context
  globalThis.EvalTypes = Object.freeze({
    Interactive: 'interactive',
    Setup: 'setup',
    Output: 'output',
  });

  // Function that obtains the font size for a given element 
  globalThis.qwebrCurrentFontSizeOnElement = function(element, cssProperty = 'font-size') {

    const currentFontSize = parseFloat(
      window
      .getComputedStyle(element)
      .getPropertyValue(cssProperty)
    );
    
    return currentFontSize;
  }

  // Function to determine font scaling
  globalThis.qwebrScaledFontSize = function(div, qwebrOptions) {
    // Determine if we should compute font-size using RevealJS's `--r-main-font-size` 
    // or if we can directly use the document's `font-size`.
    const cssProperty = document.body.classList.contains('reveal') ? 
      "--r-main-font-size" : "font-size";
    
    // Get the current font size on the div element
    const elementFontSize = qwebrCurrentFontSizeOnElement(div, cssProperty);

    // Determine the scaled font size value
    const scaledFontSize = ((qwebrOptions['editor-font-scale'] ?? 1) * elementFontSize) ?? 17.5;

    return scaledFontSize;
  }


  // Function that dispatches the creation request
  globalThis.qwebrCreateHTMLElement = function (
    cellData
  ) {

    // Extract key components
    const evalType = cellData.options.context;
    const qwebrCounter = cellData.id;

    // We make an assumption that insertion points are defined by the Lua filter as:
    // qwebr-insertion-location-{qwebrCounter} 
    const elementLocator = document.getElementById(`qwebr-insertion-location-${qwebrCounter}`);

    // Figure out the routine to use to insert the element.
    let qwebrElement;
    switch ( evalType ) {
      case EvalTypes.Interactive:
        qwebrElement = qwebrCreateInteractiveElement(qwebrCounter, cellData.options);
        break;
      case EvalTypes.Output: 
        qwebrElement = qwebrCreateNonInteractiveOutputElement(qwebrCounter, cellData.options);
        break;
      case EvalTypes.Setup: 
        qwebrElement = qwebrCreateNonInteractiveSetupElement(qwebrCounter, cellData.options);
        break;
      default: 
        qwebrElement = document.createElement('div');
        qwebrElement.textContent = 'Error creating `quarto-webr` element';
    }

    // Insert the dynamically generated object at the document location.
    elementLocator.appendChild(qwebrElement);
  };

  // Function that setups the interactive element creation
  globalThis.qwebrCreateInteractiveElement = function (qwebrCounter, qwebrOptions) {

    // Create main div element
    var mainDiv = document.createElement('div');
    mainDiv.id = 'qwebr-interactive-area-' + qwebrCounter;
    mainDiv.className = `qwebr-interactive-area`;
    if (qwebrOptions.classes) {
      mainDiv.className += " " + qwebrOptions.classes
    }

    // Add a unique cell identifier that users can customize
    if (qwebrOptions.label) {
      mainDiv.setAttribute('data-id', qwebrOptions.label);
    }

    // Create toolbar div
    var toolbarDiv = document.createElement('div');
    toolbarDiv.className = 'qwebr-editor-toolbar';
    toolbarDiv.id = 'qwebr-editor-toolbar-' + qwebrCounter;

    // Create a div to hold the left buttons
    var leftButtonsDiv = document.createElement('div');
    leftButtonsDiv.className = 'qwebr-editor-toolbar-left-buttons';

    // Create a div to hold the right buttons
    var rightButtonsDiv = document.createElement('div');
    rightButtonsDiv.className = 'qwebr-editor-toolbar-right-buttons';

    // Create Run Code button
    var runCodeButton = document.createElement('button');
    runCodeButton.className = 'btn btn-default qwebr-button qwebr-button-run';
    runCodeButton.disabled = true;
    runCodeButton.type = 'button';
    runCodeButton.id = 'qwebr-button-run-' + qwebrCounter;
    runCodeButton.textContent = '🟡 Loading webR...';
    runCodeButton.title = `Run code (Shift + Enter)`;

    // Append buttons to the leftButtonsDiv
    leftButtonsDiv.appendChild(runCodeButton);

    // Create Reset button
    var resetButton = document.createElement('button');
    resetButton.className = 'btn btn-light btn-xs qwebr-button qwebr-button-reset';
    resetButton.type = 'button';
    resetButton.id = 'qwebr-button-reset-' + qwebrCounter;
    resetButton.title = 'Start over';
    resetButton.innerHTML = '<i class="fa-solid fa-arrows-rotate"></i>';

    // Create Copy button
    var copyButton = document.createElement('button');
    copyButton.className = 'btn btn-light btn-xs qwebr-button qwebr-button-copy';
    copyButton.type = 'button';
    copyButton.id = 'qwebr-button-copy-' + qwebrCounter;
    copyButton.title = 'Copy code';
    copyButton.innerHTML = '<i class="fa-regular fa-copy"></i>';

    // Append buttons to the rightButtonsDiv
    rightButtonsDiv.appendChild(resetButton);
    rightButtonsDiv.appendChild(copyButton);

    // Create console area div
    var consoleAreaDiv = document.createElement('div');
    consoleAreaDiv.id = 'qwebr-console-area-' + qwebrCounter;
    consoleAreaDiv.className = 'qwebr-console-area';

    // Create editor div
    var editorDiv = document.createElement('div');
    editorDiv.id = 'qwebr-editor-' + qwebrCounter;
    editorDiv.className = 'qwebr-editor';

    // Create output code area div
    var outputCodeAreaDiv = document.createElement('div');
    outputCodeAreaDiv.id = 'qwebr-output-code-area-' + qwebrCounter;
    outputCodeAreaDiv.className = 'qwebr-output-code-area';
    outputCodeAreaDiv.setAttribute('aria-live', 'assertive');

    // Create pre element inside output code area
    var preElement = document.createElement('pre');
    preElement.style.visibility = 'hidden';
    outputCodeAreaDiv.appendChild(preElement);

    // Create output graph area div
    var outputGraphAreaDiv = document.createElement('div');
    outputGraphAreaDiv.id = 'qwebr-output-graph-area-' + qwebrCounter;
    outputGraphAreaDiv.className = 'qwebr-output-graph-area';

    // Append buttons to the toolbar
    toolbarDiv.appendChild(leftButtonsDiv);
    toolbarDiv.appendChild(rightButtonsDiv);

    // Append all elements to the main div
    mainDiv.appendChild(toolbarDiv);
    consoleAreaDiv.appendChild(editorDiv);
    consoleAreaDiv.appendChild(outputCodeAreaDiv);
    mainDiv.appendChild(consoleAreaDiv);
    mainDiv.appendChild(outputGraphAreaDiv);

    return mainDiv;
  }

  // Function that adds output structure for non-interactive output
  globalThis.qwebrCreateNonInteractiveOutputElement = function(qwebrCounter, qwebrOptions) {
    // Create main div element
    var mainDiv = document.createElement('div');
    mainDiv.id = 'qwebr-noninteractive-area-' + qwebrCounter;
    mainDiv.className = `qwebr-noninteractive-area`;
    if (qwebrOptions.classes) {
      mainDiv.className += " " + qwebrOptions.classes
    }
    
    // Add a unique cell identifier that users can customize
    if (qwebrOptions.label) {
      mainDiv.setAttribute('data-id', qwebrOptions.label);
    }
    
    // Create a status container div
    var statusContainer = createLoadingContainer(qwebrCounter);

    // Create output code area div
    var outputCodeAreaDiv = document.createElement('div');
    outputCodeAreaDiv.id = 'qwebr-output-code-area-' + qwebrCounter;
    outputCodeAreaDiv.className = 'qwebr-output-code-area';
    outputCodeAreaDiv.setAttribute('aria-live', 'assertive');

    // Create pre element inside output code area
    var preElement = document.createElement('pre');
    preElement.style.visibility = 'hidden';
    outputCodeAreaDiv.appendChild(preElement);

    // Create output graph area div
    var outputGraphAreaDiv = document.createElement('div');
    outputGraphAreaDiv.id = 'qwebr-output-graph-area-' + qwebrCounter;
    outputGraphAreaDiv.className = 'qwebr-output-graph-area';

    // Append all elements to the main div
    mainDiv.appendChild(statusContainer);
    mainDiv.appendChild(outputCodeAreaDiv);
    mainDiv.appendChild(outputGraphAreaDiv);

    return mainDiv;
  };

  // Function that adds a stub in the page to indicate a setup cell was used.
  globalThis.qwebrCreateNonInteractiveSetupElement = function(qwebrCounter, qwebrOptions) {
    // Create main div element
    var mainDiv = document.createElement('div');
    mainDiv.id = `qwebr-noninteractive-setup-area-${qwebrCounter}`;
    mainDiv.className = `qwebr-noninteractive-setup-area`;
    if (qwebrOptions.classes) {
      mainDiv.className += " " + qwebrOptions.classes
    }


    // Add a unique cell identifier that users can customize
    if (qwebrOptions.label) {
      mainDiv.setAttribute('data-id', qwebrOptions.label);
    }

    // Create a status container div
    var statusContainer = createLoadingContainer(qwebrCounter);

    // Append status onto the main div
    mainDiv.appendChild(statusContainer);

    return mainDiv;
  }


  // Function to create loading container with specified ID
  globalThis.createLoadingContainer = function(qwebrCounter) {

    // Create a status container
    const container = document.createElement('div');
    container.id = `qwebr-non-interactive-loading-container-${qwebrCounter}`;
    container.className = 'qwebr-non-interactive-loading-container qwebr-cell-needs-evaluation';

    // Create an R project logo to indicate its a code space
    const rProjectIcon = document.createElement('i');
    rProjectIcon.className = 'fa-brands fa-r-project fa-3x qwebr-r-project-logo';

    // Setup a loading icon from font awesome
    const spinnerIcon = document.createElement('i');
    spinnerIcon.className = 'fa-solid fa-spinner fa-spin fa-1x qwebr-icon-status-spinner';

    // Add a section for status text
    const statusText = document.createElement('p');
    statusText.id = `qwebr-status-text-${qwebrCounter}`;
    statusText.className = `qwebr-status-text qwebr-cell-needs-evaluation`;
    statusText.innerText = 'Loading webR...';

    // Incorporate an inner container
    const innerContainer = document.createElement('div');

    // Append elements to the inner container
    innerContainer.appendChild(spinnerIcon);
    innerContainer.appendChild(statusText);

    // Append elements to the main container
    container.appendChild(rProjectIcon);
    container.appendChild(innerContainer);

    return container;
  }
  </script>
  <script type="module">
  // Function to install a single package
  async function qwebrInstallRPackage(packageName) {
    await mainWebR.evalRVoid(`webr::install('${packageName}');`);
  }

  // Function to load a single package
  async function qwebrLoadRPackage(packageName) {
    await mainWebR.evalRVoid(`require('${packageName}', quietly = TRUE)`);
  }

  // Generic function to process R packages
  async function qwebrProcessRPackagesWithStatus(packages, processType, displayStatusMessageUpdate = true) {
    // Switch between contexts
    const messagePrefix = processType === 'install' ? 'Installing' : 'Loading';

    // Modify button state
    qwebrSetInteractiveButtonState(`🟡 ${messagePrefix} package ...`, false);

    // Iterate over packages
    for (let i = 0; i < packages.length; i++) {
      const activePackage = packages[i];
      const formattedMessage = `${messagePrefix} package ${i + 1} out of ${packages.length}: ${activePackage}`;

      // Display the update in header
      if (displayStatusMessageUpdate) {
        qwebrUpdateStatusHeader(formattedMessage);
      }

      // Display the update in non-active areas
      qwebrUpdateStatusMessage(formattedMessage);

      // Run package installation
      if (processType === 'install') {
        await qwebrInstallRPackage(activePackage);
      } else {
        await qwebrLoadRPackage(activePackage);
      }
    }

    // Clean slate
    if (processType === 'load') {
      await mainWebR.flush();
    }
  }

  // Start a timer
  const initializeWebRTimerStart = performance.now();

  // Encase with a dynamic import statement
  globalThis.qwebrInstance = import(qwebrCustomizedWebROptions.baseURL + "webr.mjs").then(
    async ({ WebR, ChannelType }) => {
      // Populate WebR options with defaults or new values based on `webr` meta
      globalThis.mainWebR = new WebR(qwebrCustomizedWebROptions);

      // Initialization WebR
      await mainWebR.init();

      // Setup a shelter
      globalThis.mainWebRCodeShelter = await new mainWebR.Shelter();

      // Setup a pager to allow processing help documentation 
      await mainWebR.evalRVoid('webr::pager_install()'); 

      // Override the existing install.packages() to use webr::install()
      await mainWebR.evalRVoid('webr::shim_install()'); 

      // Specify the repositories to pull from
      // Note: webR does not use the `repos` option, but instead uses `webr_pkg_repos`
      // inside of `install()`. However, other R functions still pull from `repos`.
      await mainWebR.evalRVoid(`
        options(
          webr_pkg_repos = c(${qwebrPackageRepoURLS.map(repoURL => `'${repoURL}'`).join(',')}),
          repos = c(${qwebrPackageRepoURLS.map(repoURL => `'${repoURL}'`).join(',')})
        )
      `);

      // Check to see if any packages need to be installed
      if (qwebrSetupRPackages) {
        // Obtain only a unique list of packages
        const uniqueRPackageList = Array.from(new Set(qwebrInstallRPackagesList));

        // Install R packages one at a time (either silently or with a status update)
        await qwebrProcessRPackagesWithStatus(uniqueRPackageList, 'install', qwebrShowStartupMessage);

        if (qwebrAutoloadRPackages) {
          // Load R packages one at a time (either silently or with a status update)
          await qwebrProcessRPackagesWithStatus(uniqueRPackageList, 'load', qwebrShowStartupMessage);
        }
      }
    }
  );

  // Stop timer
  const initializeWebRTimerEnd = performance.now();

  </script>
  <script type="module">
  // Function to verify a given JavaScript Object is empty
  globalThis.qwebrIsObjectEmpty = function (arr) {
      return Object.keys(arr).length === 0;
  }

  // Global version of the Escape HTML function that converts HTML 
  // characters to their HTML entities.
  globalThis.qwebrEscapeHTMLCharacters = function(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    };

  // Passthrough results
  globalThis.qwebrIdentity = function(x) {
      return x;
  };

  // Append a comment
  globalThis.qwebrPrefixComment = function(x, comment) {
      return `${comment}${x}`;
  };

  // Function to store the code in the history
  globalThis.qwebrLogCodeToHistory = function(codeToRun, options) {
      qwebrRCommandHistory.push(
          `# Ran code in ${options.label} at ${new Date().toLocaleString()} ----\n${codeToRun}`
      );
  }

  // Function to attach a download button onto the canvas
  // allowing the user to download the image.
  function qwebrImageCanvasDownloadButton(canvas, canvasContainer) {

      // Create the download button
      const downloadButton = document.createElement('button');
      downloadButton.className = 'qwebr-canvas-image-download-btn';
      downloadButton.textContent = 'Download Image';
      canvasContainer.appendChild(downloadButton);

      // Trigger a download of the image when the button is clicked
      downloadButton.addEventListener('click', function() {
          const image = canvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.href = image;
          link.download = 'qwebr-canvas-image.png';
          link.click();
      });
    }
    

  // Function to parse the pager results
  globalThis.qwebrParseTypePager = async function (msg) { 

      // Split out the event data
      const { path, title, deleteFile } = msg.data; 

      // Process the pager data by reading the information from disk
      const paged_data = await mainWebR.FS.readFile(path).then((data) => {
          // Obtain the file content
          let content = new TextDecoder().decode(data);

          // Remove excessive backspace characters until none remain
          while(content.match(/.[\b]/)){
          content = content.replace(/.[\b]/g, '');
          }

          // Returned cleaned data
          return content;
      });

      // Unlink file if needed
      if (deleteFile) { 
          await mainWebR.FS.unlink(path); 
      } 

      // Return extracted data with spaces
      return paged_data;
  } 

  // Function to run the code using webR and parse the output
  globalThis.qwebrComputeEngine = async function(
      codeToRun, 
      elements, 
      options) {

      // Call into the R compute engine that persists within the document scope.
      // To be prepared for all scenarios, the following happens: 
      // 1. We setup a canvas device to write to by making a namespace call into the {webr} package
      // 2. We use values inside of the options array to set the figure size.
      // 3. We capture the output stream information (STDOUT and STERR)
      // 4. We disable the current device's image creation.
      // 5. Piece-wise parse the results into the different output areas

      // Create a pager variable for help/file contents
      let pager = [];

      // Handle how output is processed
      let showMarkup = options.results === "markup" && options.output !== "asis";
      let processOutput;

      if (showMarkup) {
          processOutput = qwebrEscapeHTMLCharacters;
      } else {
          processOutput = qwebrIdentity;
      }

      // ---- 
      // Convert from Inches to Pixels by using DPI (dots per inch)
      // for bitmap devices (dpi * inches = pixels)
      let fig_width = options["fig-width"] * options["dpi"]
      let fig_height = options["fig-height"] * options["dpi"]

      // Initialize webR
      await mainWebR.init();

      // Configure capture output
      let captureOutputOptions = {
          withAutoprint: true,
          captureStreams: true,
          captureConditions: false,
          // env: webR.objs.emptyEnv, // maintain a global environment for webR v0.2.0
      };
      
      // Determine if the browser supports OffScreen
      if (qwebrOffScreenCanvasSupport()) {
          // Mirror default options of webr::canvas()
          // with changes to figure height and width.
          captureOutputOptions.captureGraphics = {
              width: fig_width,
              height: fig_height,
              bg: "white", // default: transparent
              pointsize: 12,
              capture: true
          };
      }  else {
          // Disable generating graphics
          captureOutputOptions.captureGraphics = false;
      }

      // Store the code to run in history
      qwebrLogCodeToHistory(codeToRun, options);

      // Setup a webR canvas by making a namespace call into the {webr} package
      // Evaluate the R code
      // Remove the active canvas silently
      const result = await mainWebRCodeShelter.captureR(
          `${codeToRun}`,
          captureOutputOptions
      );

      // -----

      // Start attempting to parse the result data
      processResultOutput:try {
          
          // Avoid running through output processing
          if (options.results === "hide" || options.output === "false") { 
              break processResultOutput; 
          }

          // Merge output streams of STDOUT and STDErr (messages and errors are combined.)
          // Require both `warning` and `message` to be true to display `STDErr`. 
          const out = result.output
          .filter(
              evt => evt.type === "stdout" || 
              ( evt.type === "stderr" && (options.warning === "true" && options.message === "true")) 
          )
          .map((evt, index) => {
              const className = `qwebr-output-code-${evt.type}`;
              const outputResult = qwebrPrefixComment(processOutput(evt.data), options.comment);
              return `<code id="${className}-editor-${elements.id}-result-${index + 1}" class="${className}">${outputResult}</code>`;
          })
          .join("\n");


          // Clean the state
          // We're now able to process pager events.
          // As a result, we cannot maintain a true 1-to-1 output order 
          // without individually feeding each line
          const msgs = await mainWebR.flush();

          // Use `map` to process the filtered "pager" events asynchronously
          const pager = await Promise.all(
              msgs.filter(msg => msg.type === 'pager').map(
                  async (msg) => {
                      return await qwebrParseTypePager(msg);
                  }
              )
          );

          // Nullify the output area of content
          elements.outputCodeDiv.innerHTML = "";
          elements.outputGraphDiv.innerHTML = "";

          // Design an output object for messages
          const pre = document.createElement("pre");
          if (/\S/.test(out)) {
              // Display results as HTML elements to retain output styling
              const div = document.createElement("div");
              div.innerHTML = out;

              // Calculate a scaled font-size value
              const scaledFontSize = qwebrScaledFontSize(
                  elements.outputCodeDiv, options);

              // Override output code cell size
              pre.style.fontSize = `${scaledFontSize}px`;
              pre.appendChild(div);
          } else {
              // If nothing is present, hide the element.
              pre.style.visibility = "hidden";
          }

          elements.outputCodeDiv.appendChild(pre);

          // Determine if we have graphs to display
          if (result.images.length > 0) {

              // Create figure element
              const figureElement = document.createElement("figure");
              figureElement.className = "qwebr-canvas-image";

              // Place each rendered graphic onto a canvas element
              result.images.forEach((img) => {

                  // Construct canvas for object
                  const canvas = document.createElement("canvas");

                  // Add an image download button
                  qwebrImageCanvasDownloadButton(canvas, figureElement);

                  // Set canvas size to image
                  canvas.width = img.width;
                  canvas.height = img.height;

                  // Apply output truncations
                  canvas.style.width = options["out-width"] ? options["out-width"] : `${fig_width}px`;
                  if (options["out-height"]) {
                      canvas.style.height = options["out-height"];
                  }

                  // Apply styling
                  canvas.style.display = "block";
                  canvas.style.margin = "auto";

                  // Draw image onto Canvas
                  const ctx = canvas.getContext("2d");
                  ctx.drawImage(img, 0, 0, img.width, img.height);
            
                  // Append canvas to figure output area
                  figureElement.appendChild(canvas);

              });
              
              if (options['fig-cap']) {
                  // Create figcaption element
                  const figcaptionElement = document.createElement('figcaption');
                  figcaptionElement.innerText = options['fig-cap'];
                  // Append figcaption to figure
                  figureElement.appendChild(figcaptionElement);    
              }
          
              elements.outputGraphDiv.appendChild(figureElement);

          }

          // Display the pager data
          if (pager) {
          // Use the `pre` element to preserve whitespace.
          pager.forEach((paged_data, index) => {
              let pre_pager = document.createElement("pre");
              pre_pager.innerText = paged_data;
              pre_pager.classList.add("qwebr-output-code-pager");
              pre_pager.setAttribute("id", `qwebr-output-code-pager-editor-${elements.id}-result-${index + 1}`);
              elements.outputCodeDiv.appendChild(pre_pager);
          });
          }
      } finally {
          // Clean up the remaining code
          mainWebRCodeShelter.purge();
      }
  }

  // Function to execute the code (accepts code as an argument)
  globalThis.qwebrExecuteCode = async function (
      codeToRun,
      id,
      options = {}) {

      // If options are not passed, we fall back on the bare minimum to handle the computation
      if (qwebrIsObjectEmpty(options)) {
          options = { 
              "context": "interactive", 
              "fig-width": 7, "fig-height": 5, 
              "out-width": "700px", "out-height": "", 
              "dpi": 72,
              "results": "markup", 
              "warning": "true", "message": "true",
          };
      }

      // Next, we access the compute areas values
      const elements = {
          runButton: document.getElementById(`qwebr-button-run-${id}`),
          outputCodeDiv: document.getElementById(`qwebr-output-code-area-${id}`),
          outputGraphDiv: document.getElementById(`qwebr-output-graph-area-${id}`),
          id: id,
      }

      // Disallowing execution of other code cells
      document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
          btn.disabled = true;
      });

      if (options.context == EvalTypes.Interactive) {
          // Emphasize the active code cell
          elements.runButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin qwebr-icon-status-spinner"></i> <span>Run Code</span>';
      }

      // Evaluate the code and parse the output into the document
      await qwebrComputeEngine(codeToRun, elements, options);

      // Switch to allowing execution of code
      document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
          btn.disabled = false;
      });

      if (options.context == EvalTypes.Interactive) {
          // Revert to the initial code cell state
          elements.runButton.innerHTML = '<i class="fa-solid fa-play qwebr-icon-run-code"></i> <span>Run Code</span>';
      }
  }

  </script>
</head>
<body class="quarto-light">
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/loader.js"></script>
<script type="module" id="qwebr-monaco-editor-init">

  // Configure the Monaco Editor's loader
  require.config({
    paths: {
      'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs'
    }
  });
</script>
<script type="module">
// Function to update Monaco Editors when body class changes
function updateMonacoEditorsOnBodyClassChange() {
    // Select the body element
    const body = document.querySelector('body');

    // Options for the observer (which mutations to observe)
    const observerOptions = {
        attributes: true,  // Observe changes to attributes
        attributeFilter: ['class'] // Only observe changes to the 'class' attribute
    };

    // Callback function to execute when mutations are observed
    const bodyClassChangeCallback = function(mutationsList, observer) {
        for(let mutation of mutationsList) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                // Class attribute has changed
                // Update all Monaco Editors on the page
                updateMonacoEditorTheme();
            }
        }
    };

    // Create an observer instance linked to the callback function
    const observer = new MutationObserver(bodyClassChangeCallback);

    // Start observing the target node for configured mutations
    observer.observe(body, observerOptions);
}

// Function to update all instances of Monaco Editors on the page
function updateMonacoEditorTheme() {
    // Determine what VS Theme to use
    const vsThemeToUse = document.body.classList.contains("quarto-dark") ? 'vs-dark' : 'vs' ;

    // Iterate through all initialized Monaco Editors
    qwebrEditorInstances.forEach( function(editorInstance) { 
        editorInstance.updateOptions({ theme: vsThemeToUse }); 
    });
}

// Call the function to start observing changes to body class
updateMonacoEditorsOnBodyClassChange();
</script>
<script type="module">
// Global array to store Monaco Editor instances
globalThis.qwebrEditorInstances = [];

function isValidCodeLineNumbers(stringCodeLineNumbers) {
  // Regular expression to match valid input strings
  const regex = /^(\d+(-\d+)?)(,\d+(-\d+)?)*$/;
  return regex.test(stringCodeLineNumbers);
}

// Function that builds and registers a Monaco Editor instance    
globalThis.qwebrCreateMonacoEditorInstance = function (cellData) {

  const initialCode = cellData.code;
  const qwebrCounter = cellData.id;
  const qwebrOptions = cellData.options;

  // Retrieve the previously created document elements
  let runButton = document.getElementById(`qwebr-button-run-${qwebrCounter}`);
  let resetButton = document.getElementById(`qwebr-button-reset-${qwebrCounter}`);
  let copyButton = document.getElementById(`qwebr-button-copy-${qwebrCounter}`);
  let editorDiv = document.getElementById(`qwebr-editor-${qwebrCounter}`);

  // Load the Monaco Editor and create an instance
  let editor;
  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(editorDiv, {
      value: initialCode,
      language: 'r',
      theme: 'vs-light',
      automaticLayout: true,           // Works wonderfully with RevealJS
      scrollBeyondLastLine: false,
      minimap: {
        enabled: false
      },
      fontSize: qwebrScaledFontSize(editorDiv, qwebrOptions),         
      renderLineHighlight: "none",      // Disable current line highlighting
      hideCursorInOverviewRuler: true,  // Remove cursor indictor in right hand side scroll bar
      readOnly: qwebrOptions['read-only'] ?? false,
      quickSuggestions: qwebrOptions['editor-quick-suggestions'] ?? false,
      wordWrap: (qwebrOptions['editor-word-wrap'] == 'true' ? "on" : "off")
    });

    // Store the official counter ID to be used in keyboard shortcuts
    editor.__qwebrCounter = qwebrCounter;

    // Store the official div container ID
    editor.__qwebrEditorId = `qwebr-editor-${qwebrCounter}`;

    // Store the initial code value and options
    editor.__qwebrinitialCode = initialCode;
    editor.__qwebrOptions = qwebrOptions;

    // Set at the model level the preferred end of line (EOL) character to LF.
    // This prevent `\r\n` from being given to the webR engine if the user is on Windows.
    // See details in: https://github.com/coatless/quarto-webr/issues/94
    // Associated error text: 
    // Error: <text>:1:7 unexpected input

    // Retrieve the underlying model
    const model = editor.getModel();
    // Set EOL for the model
    model.setEOL(monaco.editor.EndOfLineSequence.LF);
    
    // Dynamically modify the height of the editor window if new lines are added.
    let ignoreEvent = false;
    const updateHeight = () => {
      // Increment editor height by 2 to prevent vertical scroll bar from appearing
      const contentHeight = editor.getContentHeight() + 2;

      // Retrieve editor-max-height option
      const maxEditorHeight = qwebrOptions['editor-max-height'];

      // If editor-max-height is missing, allow infinite growth. Otherwise, threshold.
      const editorHeight = !maxEditorHeight ?  contentHeight : Math.min(contentHeight, maxEditorHeight);

      // We're avoiding a width change
      //editorDiv.style.width = `${width}px`;
      editorDiv.style.height = `${editorHeight}px`;
      try {
        ignoreEvent = true;

        // The key to resizing is this call
        editor.layout();
      } finally {
        ignoreEvent = false;
      }
    };

    // Function to generate decorations to highlight lines
    // in the editor based on input string.
    function decoratorHighlightLines(codeLineNumbers) {
      // Store the lines to be lighlight
      let linesToHighlight = [];
      
      // Parse the codeLineNumbers string to get the line numbers to highlight
      // First, split the string by commas
      codeLineNumbers.split(',').forEach(part => {
        // Check if we have a range of lines
        if (part.includes('-')) {
            // Handle range of lines (e.g., "6-8")
            const [start, end] = part.split('-').map(Number);
            for (let i = start; i <= end; i++) {
                linesToHighlight.push(i);
            }
        } else {
            // Handle single line (e.g., "7")
            linesToHighlight.push(Number(part));
        }
      });
  
      // Create monaco decorations for the lines to highlight
      const decorations = linesToHighlight.map(lineNumber => ({
          range: new monaco.Range(lineNumber, 1, lineNumber, 1),
          options: {
              isWholeLine: true,
              className: 'qwebr-editor-highlight-line'
          }
      }));
  
      // Return decorations to be applied to the editor
      return decorations;
    }

    // Ensure that the editor-code-line-numbers option is set and valid
    // then apply styling
    if (qwebrOptions['editor-code-line-numbers']) {
      // Remove all whitespace from the string
      const codeLineNumbers = qwebrOptions['editor-code-line-numbers'].replace(/\s/g,'');
      // Check if the string is valid for line numbers, e.g., "1,3-5,7"
      if (isValidCodeLineNumbers(codeLineNumbers)) {
        // Apply the decorations to the editor
        editor.createDecorationsCollection(decoratorHighlightLines(codeLineNumbers));
      } else {
        // Warn the user that the input is invalid
        console.warn(`Invalid "editor-code-line-numbers" value in code cell ${qwebrOptions['label']}: ${codeLineNumbers}`);
      }
    }

    // Helper function to check if selected text is empty
    function isEmptyCodeText(selectedCodeText) {
      return (selectedCodeText === null || selectedCodeText === undefined || selectedCodeText === "");
    }

    // Registry of keyboard shortcuts that should be re-added to each editor window
    // when focus changes.
    const addWebRKeyboardShortCutCommands = () => {
      // Add a keydown event listener for Shift+Enter to run all code in cell
      editor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {

        // Retrieve all text inside the editor
        qwebrExecuteCode(editor.getValue(), editor.__qwebrCounter, editor.__qwebrOptions);
      });

      // Add a keydown event listener for CMD/Ctrl+Enter to run selected code
      editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, () => {

        // Get the selected text from the editor
        const selectedText = editor.getModel().getValueInRange(editor.getSelection());
        // Check if no code is selected
        if (isEmptyCodeText(selectedText)) {
          // Obtain the current cursor position
          let currentPosition = editor.getPosition();
          // Retrieve the current line content
          let currentLine = editor.getModel().getLineContent(currentPosition.lineNumber);

          // Propose a new position to move the cursor to
          let newPosition = new monaco.Position(currentPosition.lineNumber + 1, 1);

          // Check if the new position is beyond the last line of the editor
          if (newPosition.lineNumber > editor.getModel().getLineCount()) {
            // Add a new line at the end of the editor
            editor.executeEdits("addNewLine", [{
            range: new monaco.Range(newPosition.lineNumber, 1, newPosition.lineNumber, 1),
            text: "\n", 
            forceMoveMarkers: true,
            }]);
          }
          
          // Run the entire line of code.
          qwebrExecuteCode(currentLine, editor.__qwebrCounter, editor.__qwebrOptions);

          // Move cursor to new position
          editor.setPosition(newPosition);
        } else {
          // Code to run when Ctrl+Enter is pressed with selected code
          qwebrExecuteCode(selectedText, editor.__qwebrCounter, editor.__qwebrOptions);
        }
      });
    }

    // Register an on focus event handler for when a code cell is selected to update
    // what keyboard shortcut commands should work.
    // This is a workaround to fix a regression that happened with multiple
    // editor windows since Monaco 0.32.0 
    // https://github.com/microsoft/monaco-editor/issues/2947
    editor.onDidFocusEditorText(addWebRKeyboardShortCutCommands);

    // Register an on change event for when new code is added to the editor window
    editor.onDidContentSizeChange(updateHeight);

    // Manually re-update height to account for the content we inserted into the call
    updateHeight();

    // Store the editor instance in the global dictionary
    qwebrEditorInstances[editor.__qwebrCounter] = editor;

  });

  // Add a click event listener to the run button
  runButton.onclick = function () {
    qwebrExecuteCode(editor.getValue(), editor.__qwebrCounter, editor.__qwebrOptions);
  };

  // Add a click event listener to the reset button
  copyButton.onclick = function () {
    // Retrieve current code data
    const data = editor.getValue();
    
    // Write code data onto the clipboard.
    navigator.clipboard.writeText(data || "");
  };
  
  // Add a click event listener to the copy button
  resetButton.onclick = function () {
    editor.setValue(editor.__qwebrinitialCode);
  };
  
}
</script>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title"><p><b>外国書購読 Day3</b> <br> <span style="color: #282A36; ">Analysis of Accounting Transactions</span></p></h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Soichi Matsuura 
</div>
</div>
</div>

</section>
<section>
<section id="review-of-day2" class="title-slide slide level1 center">
<h1>review of Day2</h1>

</section>
<section id="big-data" class="slide level2">
<h2>Big Data</h2>
<p>The R language uses <strong>4 storage formats</strong> for data:</p>
<ul>
<li><em>vectors</em></li>
<li><em>matrix</em></li>
<li><em>data frames</em></li>
<li><em>factors</em></li>
</ul>
<!-- R言語はデータに対して、ベクトル、行列、配列、データフレーム、tibbles(tidyverse)、リスト、ファクターといった7つの主要な格納形式を使用する。 -->
</section>
<section id="準備" class="slide level2">
<h2>準備</h2>
<p>In order to use packages, you use the <code>pacman</code> package to install and load the necessary packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, auditanalytics, knitr, kableExtra)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>tidyverse</code> is a collection of R packages designed for data science.</li>
<li><code>auditanalytics</code> is a package that provides data in this class.</li>
<li><code>knitr</code> is a package for dynamic report generation in R.</li>
<li><code>kableExtra</code> is a package for creating tables in R Markdown.</li>
</ul>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="" aria-hidden="true" tabindex="-1"></a>big_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb2-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"ch1_amount_data.csv"</span>,</span>
<span id="cb2-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">package =</span> <span class="st">"auditanalytics"</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-4"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(big_data)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
   year transient   financial        text multimedia mobile
  &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
1  1930         0  323436613.  332755554.          0      0
2  1932         0  397718380.  481387776.          0      0
3  1934         0  716513950.  692322681.          0      0
4  1936         0 1887577972. 2621529575.          0      0
5  1938         0 3395111970. 3223325972.          0      0
6  1940         0 9167974599. 9663220031.          0      0</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="" aria-hidden="true" tabindex="-1"></a>big_data <span class="ot">&lt;-</span> big_data <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>( <span class="co"># wide to long</span></span>
<span id="cb4-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>year), <span class="co"># year column is not included</span></span>
<span id="cb4-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"data_type"</span>,</span>
<span id="cb4-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb4-6"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(big_data)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
   year data_type       value
  &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
1  1930 transient          0 
2  1930 financial  323436613.
3  1930 text       332755554.
4  1930 multimedia         0 
5  1930 mobile             0 
6  1932 transient          0 </code></pre>
</div>
</div>
<p><code>pivot_longer()</code> is a function from tidyverse that replaces columns with indicators, and is used here to gather multiple lines on a single graph./</p>
</section>
<section class="slide level2">

<h3 id="graph-growth-of-stored-data">Graph : Growth of Stored Data</h3>
<div class="cell">
<details class="code-fold">
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="" aria-hidden="true" tabindex="-1"></a>big_data<span class="sc">$</span>amount <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(big_data<span class="sc">$</span>value)</span>
<span id="cb6-2"><a href="" aria-hidden="true" tabindex="-1"></a>big_data <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> amount, <span class="at">col =</span> data_type) <span class="sc">+</span></span>
<span id="cb6-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> data_type, <span class="at">size =</span> amount), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">"sqrt"</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">1990</span>,<span class="dv">2020</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Number of Bits of Storage"</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="gaisho_2024_03_files/figure-revealjs/unnamed-chunk-4-1.png" width="960" class="r-stretch"></section>
<section id="vectors" class="slide level2">
<h2>Vectors</h2>
<!-- ## ベクトル -->
<p>You can make a vector using <code>c()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">5.3</span>, <span class="dv">6</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">4</span>) <span class="co"># number vector</span></span>
<span id="cb7-2"><a href="" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>) <span class="co"># character vector</span></span>
<span id="cb7-3"><a href="" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span>,<span class="cn">FALSE</span>) <span class="co"># logical vector</span></span>
<span id="cb7-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1.0  2.0  5.3  6.0 -2.0  4.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="" aria-hidden="true" tabindex="-1"></a>b</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "one"   "two"   "three"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="" aria-hidden="true" tabindex="-1"></a>c</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE  TRUE FALSE  TRUE FALSE</code></pre>
</div>
</div>
</section>
<section id="example-vectors" class="slide level2">
<h2>Example: Vectors</h2>
<div id="qwebr-insertion-location-1"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</section>
<section class="slide level2">

<h3 id="vector-operations">Vector Operations</h3>
<p>Refer to elements of a vector using subscripts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="" aria-hidden="true" tabindex="-1"></a>a[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)] <span class="co"># 2nd and 4th elements of the vector</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="" aria-hidden="true" tabindex="-1"></a>a[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)] <span class="co"># 1st to 3rd elements of the vector</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.0 2.0 5.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="" aria-hidden="true" tabindex="-1"></a>a[<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>)] <span class="co"># all elements except the 3rd</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  2  6 -2  4</code></pre>
</div>
</div>
</section>
<section id="matrix" class="slide level2">
<h2>Matrix</h2>
<p>All columns in a matrix must have the <strong>same mode</strong> and the <strong>same length</strong>. <!-- 行列のすべての列は同じモード(数値、文字など)と同じ長さでなければならない。 --> Transfer the vector to a <span class="math inline">5 \times 5</span> matrix .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">25</span>), <span class="dv">5</span>, <span class="dv">5</span>, <span class="at">byrow =</span> F)</span>
<span id="cb19-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mat)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,]    1    6   11   16   21
[2,]    2    7   12   17   22
[3,]    3    8   13   18   23
[4,]    4    9   14   19   24
[5,]    5   10   15   20   25</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>If you want to fill the matrix by rows, use <code>byrow = TRUE</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">25</span>), <span class="dv">5</span>, <span class="dv">5</span>, <span class="at">byrow =</span> T)</span>
<span id="cb21-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mat)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,]    1    2    3    4    5
[2,]    6    7    8    9   10
[3,]   11   12   13   14   15
[4,]   16   17   18   19   20
[5,]   21   22   23   24   25</code></pre>
</div>
</div>
</section>
<section id="inverse-matrix-and-determinant" class="slide level2">
<h2>Inverse Matrix and Determinant</h2>
<p>Next, you try to solve the inverse matrix with <code>solve()</code> and calculate the determinant of the matrix with <code>det()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># create a 3x3 matrix</span></span>
<span id="cb23-2"><a href="" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">9</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> T)</span>
<span id="cb23-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mat)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]   41   77   57
[2,]   26   66   48
[3,]    9   93   33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(mat) <span class="co"># inverse matrix</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]        [,2]         [,3]
[1,]  0.10132979 -0.12234043  0.002925532
[2,]  0.01888298 -0.03723404  0.021542553
[3,] -0.08085106  0.13829787 -0.031205674</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">det</span>(mat) <span class="co"># determinant of the matrix</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -22560</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Extract elements from a matrix using subscripts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="" aria-hidden="true" tabindex="-1"></a>mat[, <span class="dv">3</span>] <span class="co"># 3th column of the matrix</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 57 48 33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="" aria-hidden="true" tabindex="-1"></a>mat[<span class="dv">3</span>,]  <span class="co"># 3rd row of the matrix</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  9 93 33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="" aria-hidden="true" tabindex="-1"></a>mat[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># rows 2 to 4 and columns 1 to 3</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]   26   66
[2,]    9   93</code></pre>
</div>
</div>
</section>
<section id="data.frame-and-tibble" class="slide level2">
<h2>data.frame and tibble</h2>
<ul>
<li><p>A data frame is more general than a matrix, in that <strong>different columns can have different modes</strong> (numeric, character, factor, etc.). <!-- similar to SAS and SPSS datasets. --> <!-- データフレーム(data frame)は行列よりも一般的であり、SASやSPSSのデータセットのように、異なる列には数値、文字、ファクターなどの異なる型をもちうる。 --></p></li>
<li><p>Data frames represent <strong>the most widely used format</strong> for data storage and retrieval in the <em>R</em> language <!-- データフレームは、R言語でのデータの格納と検索で最も広く使用されている型である。 --></p></li>
<li><p>Type <code>data.frame</code> is like a spreadsheet of Excel. Column means variable and row means observation.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="create-a-data-frame">Create a data frame</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID     =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb35-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">Color  =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>, <span class="cn">NA</span>),</span>
<span id="cb35-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">Passed =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb35-5"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-6"><a href="" aria-hidden="true" tabindex="-1"></a>mydata[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># columns 1 and 2 of data frame</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID Color
1  1   red
2  2 white
3  3   red
4  4  &lt;NA&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="" aria-hidden="true" tabindex="-1"></a>mydata[<span class="fu">c</span>(<span class="st">"ID"</span>,<span class="st">"Color"</span>)] <span class="co"># columns ID and Age from data frame</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID Color
1  1   red
2  2 white
3  3   red
4  4  &lt;NA&gt;</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="example-data-frame">Example: Data Frame</h3>
<div id="qwebr-insertion-location-2"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</section>
<section id="list" class="slide level2">
<h2>List</h2>
<ul>
<li>An ordered collection of objects (components). <!-- リストはオブジェクト(コンポーネント)の順序付きコレクションである。 --></li>
<li>A list allows you to gather a variety of objects under one name. <!-- リストを使用すると、さまざまな(おそらく関連のない)オブジェクトを1つの名前の下にまとめることができる。 --></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="st">"seven"</span>; b <span class="ot">&lt;-</span> <span class="st">"seven"</span></span>
<span id="cb39-2"><a href="" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="dv">0</span> ; y <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># example of a list with 4 components -</span></span>
<span id="cb39-5"><a href="" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb39-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Fred"</span>,</span>
<span id="cb39-7"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">mynumbers =</span> a,</span>
<span id="cb39-8"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">mymatrix =</span> y,</span>
<span id="cb39-9"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fl">5.3</span></span>
<span id="cb39-10"><a href="" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-11"><a href="" aria-hidden="true" tabindex="-1"></a>w</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$name
[1] "Fred"

$mynumbers
[1] "seven"

$mymatrix
[1] 0

$age
[1] 5.3</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="" aria-hidden="true" tabindex="-1"></a>list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">"Fred"</span>, <span class="at">mynumbers =</span> a, <span class="at">mymatrix =</span> y, <span class="at">age =</span> <span class="fl">5.3</span>)</span>
<span id="cb41-2"><a href="" aria-hidden="true" tabindex="-1"></a>list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">"Joe"</span>,  <span class="at">mynumbers =</span> b, <span class="at">mymatrix =</span> z, <span class="at">age =</span> <span class="fl">10.11</span>) <span class="co"># 誤字</span></span>
<span id="cb41-3"><a href="" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(list1,list2)</span>
<span id="cb41-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify elements of a list using the [[]] convention.</span></span>
<span id="cb41-5"><a href="" aria-hidden="true" tabindex="-1"></a>w[[<span class="dv">1</span>]] <span class="co"># 1st component of the list</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fred"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="" aria-hidden="true" tabindex="-1"></a>v[[<span class="st">"mynumbers"</span>]] <span class="co"># component named mynumbers in list</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "seven"</code></pre>
</div>
</div>
</section>
<section id="example-list" class="slide level2">
<h2>Example: list</h2>
<div id="qwebr-insertion-location-3"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</section>
<section id="factors" class="slide level2">
<h2>Factors</h2>
<!-- 因子は、名目的な値を [ 1. ... k ]（kは名目変数の一意な値の数）の範囲の整数ベクトルとして格納し、これらの整数にマッピングされた文字列（元の値）の内部ベクトルを格納する。 -->
<ul>
<li>Tell R that a variable is nominal by making it a factor. <!-- ある変数が名目変数であることをRで指定するには、その変数をファクター型にする。 --></li>
<li>The factor stores the <em>nominal values</em> as a vector of integers in the range <span class="math inline">[1, \dots , k ]</span> (where <span class="math inline">k</span> is the number of unique values in the nominal variable), and <em>an internal vector of character strings (the original values) mapped to these integers</em>. <!-- ファクター型は、名目変数のユニークな値の数を$k$とすると、$[1, \dots , k]$の範囲の整数ベクトルとして、これらの整数
に変換された文字列(元の値)の内部ベクトルとして格納している。 --></li>
</ul>
</section>
<section id="make-factors" class="slide level2">
<h2>Make factors</h2>
<p>Nominal variables are those that represent discrete categories without any intrinsic order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"male"</span>, <span class="dv">20</span>), <span class="fu">rep</span>(<span class="st">"female"</span>, <span class="dv">30</span>))</span>
<span id="cb45-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gender)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Length     Class      Mode 
       50 character character </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(gender)　<span class="co"># ファクター型に変換</span></span>
<span id="cb47-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gender)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>female   male 
    30     20 </code></pre>
</div>
</div>
</section>
<section id="ordered-factors" class="slide level2">
<h2>Ordered Factors</h2>
<p>Ordered factores are those that represent discrete categories with an intrinsic order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="" aria-hidden="true" tabindex="-1"></a>rating <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"medium"</span>,<span class="st">"large"</span>, <span class="st">"small"</span>)  <span class="co"># 文字ベクトル</span></span>
<span id="cb49-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rating)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "medium" "large"  "small" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="" aria-hidden="true" tabindex="-1"></a>rating <span class="ot">&lt;-</span> <span class="fu">ordered</span>(rating) <span class="co"># 順序付きファクターに変換</span></span>
<span id="cb51-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rating)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] medium large  small 
Levels: large &lt; medium &lt; small</code></pre>
</div>
</div>
</section>
<section id="useful-functions-for-dataset-inspection-and-manipulation" class="slide level2">
<h2>Useful Functions for Dataset Inspection and Manipulation</h2>
<!-- ## データセットの確認と操作に役立つ関数 -->
<div class="cell">
<details class="code-fold">
<summary>コード</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="" aria-hidden="true" tabindex="-1"></a>arry <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="co">#</span></span>
<span id="cb53-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"morph_array.csv"</span>, <span class="co">#</span></span>
<span id="cb53-3"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">package =</span> <span class="st">"auditanalytics"</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-4"><a href="" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb53-5"><a href="" aria-hidden="true" tabindex="-1"></a>arry <span class="sc">|&gt;</span></span>
<span id="cb53-6"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">longtable =</span> T) <span class="sc">|&gt;</span> <span class="co">#</span></span>
<span id="cb53-7"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>( <span class="co"># specify table style</span></span>
<span id="cb53-8"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb53-9"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">full_width =</span> F, <span class="at">font_size =</span> <span class="dv">18</span></span>
<span id="cb53-10"><a href="" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top" data-quarto-postprocess="true" style="font-size: 18px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">scope</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ben_1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cost_1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ben_2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cost_2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ben_3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cost_3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ben_4</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cost_4</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ben_5</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cost_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">810</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">940</td>
<td style="text-align: right;">440</td>
<td style="text-align: right;">140</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">190</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1370</td>
<td style="text-align: right;">890</td>
<td style="text-align: right;">1610</td>
<td style="text-align: right;">1010</td>
<td style="text-align: right;">3970</td>
<td style="text-align: right;">2770</td>
<td style="text-align: right;">3430</td>
<td style="text-align: right;">2460</td>
<td style="text-align: right;">3020</td>
<td style="text-align: right;">2650</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">9070</td>
<td style="text-align: right;">4850</td>
<td style="text-align: right;">6190</td>
<td style="text-align: right;">3250</td>
<td style="text-align: right;">5710</td>
<td style="text-align: right;">3590</td>
<td style="text-align: right;">7650</td>
<td style="text-align: right;">5360</td>
<td style="text-align: right;">7970</td>
<td style="text-align: right;">5220</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">4720</td>
<td style="text-align: right;">2400</td>
<td style="text-align: right;">4650</td>
<td style="text-align: right;">3950</td>
<td style="text-align: right;">330</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">2120</td>
<td style="text-align: right;">1580</td>
<td style="text-align: right;">2600</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">8650</td>
<td style="text-align: right;">4830</td>
<td style="text-align: right;">9100</td>
<td style="text-align: right;">4060</td>
<td style="text-align: right;">5090</td>
<td style="text-align: right;">3480</td>
<td style="text-align: right;">8400</td>
<td style="text-align: right;">7540</td>
<td style="text-align: right;">5930</td>
<td style="text-align: right;">4610</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section class="slide level2">

<h3 id="data-inspection">Data Inspection</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(arry) <span class="co">#  要素・コンポーネントの数</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(arry) <span class="co"># オブジェクトのクラス・型</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(arry) <span class="co"># オブジェクトの変数名</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "scope"  "ben_1"  "cost_1" "ben_2"  "cost_2" "ben_3"  "cost_3" "ben_4" 
 [9] "cost_4" "ben_5"  "cost_5"</code></pre>
</div>
</div>
</section></section>
<section>
<section id="analysis-of-accounting-transactions" class="title-slide slide level1 center">
<h1>Analysis of Accounting Transactions</h1>

</section>
<section id="audit-precedures-and-accounting-cycle" class="slide level2">
<h2>audit precedures and accounting cycle</h2>
<!-- ## 監査手続と会計サイクル -->
<ul>
<li>Audit procedures are designed around the accounting cycles. <!-- 監査手続は、会計サイクルに沿って計画される。 --></li>
<li>There are both <em>practical</em> and <em>theoretical</em> reasons for this. <!-- これには、実務的な理由と理論的な理由がある。 --></li>
<li>The accounting cycles define the particular processing of transactions, and <strong>interim tests</strong> (暫定的検証) focus entirely on particular transactions and their processing. <!-- 会計サイクルは特定の取引についてのプロセスを定義し、暫定的検証（interim test）は特定の取引とそのプロセスに完全に焦点を当てる。 --></li>
<li>The same economic event will be reflected in multiple transactions, and there are economies in designing audits around this fact. <!-- 同じとされた経済事象は複数の取引に反映されることになり、このような事実を中心に監査を計画することは経済的である。 --></li>
<li>In <em>substantive year-end tests</em> (実証手続), the income statement accounts are transaction based, and their accurate estimation depends on understanding the accounting cycles. <!-- 期末の実証手続では、損益計算書は取引に基づくものであり、その正確な計算は会計サイクルの理解にかかっている。 --></li>
</ul>
</section>
<section id="pcaob" class="slide level2">
<h2>PCAOB</h2>
<p>Guidance from the PCAOB’s AS 2100 through 2600 can be used to structure the sampling and analysis decision-making in an audit: <!-- PCAOB監査基準（以下、AS）の2100から2600までのガイダンス（PCAOBのウェブサイトpcaobus.orgで入手可能）は、監査におけるサンプリングと意思決定分析（analysis decision-making）を構成するために利用することができる。 --></p>
<ol type="1">
<li><strong>Planning and risk assessment phase</strong> : Using the <em>audit risk assessment matrix</em>, determine which transaction flows will have predicted error rates(予想逸脱率) greater than tolerable rate(許容逸脱率), or predicted error amounts greater than tolerable misstatement amount. <!-- 1. **監査計画とリスク評価の段階**： 監査リスク評価マトリクスを使用して、どの取引フローにおいて、予想逸脱率が許容逸脱率を超えるか、または予想虚偽表示額が許容虚偽表示額を超えるかを決定する。--> <!--memo 「許容逸脱率」－母集団における実際の逸脱率が一定の率を上回らないような適切な保証水準を得るために、監査人が設定した所定の内部統制の逸脱率をいう。 --></li>
</ol>
<ul>
<li>Their function is to provide the foundation for determining initial audit scope, the budget and predicted contract cost of the audit, and for selecting particular audit tests that will be performed. <!-- この機能は、初期の監査範囲、および監査契約にかかる予算および予定費用を決定し、特定の監査手続の実施を選択するための基礎を提供する。 --></li>
<li>This work typically uses <em>little or no transaction data from the client</em>, rather relies on the prior years audit conclusions and tests, benchmarks from similar firms in the client’s industry and available audit resources. <!-- この業務では、通常、被監査会社からの取引データはほとんどまたは全く使用しない。 --> <!-- むしろ前年度の監査の結論や監査手続の結果、被監査会社が属する産業の類似企業から算定したベンチマーク、及び利用可能な監査リソースに依存する。 --></li>
</ul>
</section>
<section class="slide level2">

<ol start="2" type="1">
<li><p><strong>Interim compliance tests (tests of transaction, mid-year tests)</strong> (運用評価手続) : Each significant transaction processing step may potentially be tested, but the audit program typically restricts <em>scope of the interim tests to those found to be “<strong>at risk</strong>” in the planning and risk assessment phase of the audit</em>. Where risk assessment matrix predictions exceed tolerable rates or amounts, plan to use attribute sampling (to find actual rate of error); for other tests, use discovery sampling to detect the possibility that error rate might be intolerable. <!-- The product of this phase is the internal control report (specified in AU section 319 and PCAOB AS No. 5) which may also be the basis for assertions in the Sarbanes–Oxley letter signed by management. --> <!-- 2. **運用評価手続**： 重要な取引処理のステップを検証する可能性があるが、監査計画は通常、運用評価手続の範囲を監査計画およびリスク評価の段階で「リスクがある」と判断されたものに限定する。リスク評価マトリクスの予測値が、許容逸脱率や許容虚偽表示額を超える場合には、（実際の逸脱率を知るために）属性サンプリング（attribute sampling）を使用するよう計画する。他の場合の手続については、発見サンプリング（discovery sampling）を利用して、逸脱率が許容できない可能性を検出する。この段階の成果物は、（AU section 319およびPCAOB AS No.5に規定される）内部統制報告書であり、これは、Sarbanes–Oxley法の経営者による報告書の主張の基礎となることもある。　 --></p></li>
<li><p><strong>Substantive tests</strong> (実証手続) : Substantive tests assess the probability of <strong>material error</strong> (重要な虚偽表示) in the accounts summarized in the various financial reports distributed to shareholders. Based on error rates discovered in interim compliance tests (and reported in the internal control memo) and expand the minimum tests of monetary balances on the trial balance. <!-- 3. **実証手続**： 株主へ公表される各種財務報告書に要約されている財務諸表に重要な虚偽表示がある可能性を評価する。運用評価手続で発見された（、また内部統制メモで報告された）逸脱率に基づき、試算表上の金額残高への監査の対象範囲を拡大する。 --></p></li>
</ol>
</section>
<section class="slide level2">

<ul>
<li>Corporate accounting systems are universally implemented on computer systems today—either in-house systems, or increasingly through service bureaus and <strong>software as a service</strong> (SaaS) infrastructure. <!-- 現在、企業の会計システムは、一般的にコンピュータシステム上に構築されている（社内システム上に構築されることもあれば、経理業務を受託するサービスビューロー（service bureaus）やSaaS（Software as a Service）インフラを利用するケースも増えている）。 --></li>
<li>Auditing is fundamentally about <em>drawing conclusions on the financial statement balances</em> (which are summary statistic) from detailed investigations of individual accounting transactions. <!-- (i.e., the economic events that record the data for these account balances). --> <!-- 監査とは、基本的に、個々の会計上の取引（勘定にデータとして記録される経済的事象）の詳細な調査から、（様々な数値を要約したものに過ぎない）財務諸表項目に関する結論を導き出すことである。 --></li>
<li>Since both balances and transactions are recorded in the computer databases today, audit sampling can only be completed with computer programs. <!-- 現在、勘定も取引も（紙ではなく）コンピュータのデータベースに記録されるため、監査サンプリングはコンピュータ・プログラムによってのみ行うことが可能である。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Additionally, corporations are retaining more accounting data than ever, partly because of new regulations from e.g.&nbsp;Sarbanes–Oxley, and partly because investors value more information, and corporations strive to provide it. <!-- さらに、SOX法などによって要請される新たな規則のために、投資家がより多くの情報を重視し企業がそれを提供しようと努めているので、企業はこれまで以上に多くの会計データを保持するようになっている。 --></li>
<li>Though this creates some up-front costs for auditors, it also makes the selection, audit, and analysis of transaction samples much more efficient. <!-- このことは、監査人にとって若干の先行投資にかかる費用が生じるものの、取引サンプルの選択、監査、および分析をより効率的なものにしている。 --> The following provides the basic statistics that you need to understand to properly conduct an audit—either test of transaction (mid- year, internal control) or substantive (year-end, balance) tests. <!-- 本章の以下の部分は、適切な監査の実施（期中に内部統制に関して行う運用評価手続や期末に勘定に対して行う実証手続）のために理解する必要がある基本的な統計情報について学ぶ。--></li>
</ul>
</section></section>
<section>
<section id="the-origin-of-accounting-transactions" class="title-slide slide level1 center">
<h1>The Origin of Accounting Transactions</h1>

</section>
<section id="accounting-transaction" class="slide level2">
<h2>Accounting Transaction</h2>
<ul>
<li>Accounting transactions begin as real-world events involving a firm — processes like sales that are localized in value, time, and space. <!-- 会計取引は、企業が関与する現実世界の事象（価値、時間、および空間の局所的な売上プロセス）として開始される。 --></li>
<li>The vast majority of these events are irrelevant to accountants — events that have no impact on the wealth of the firm. <!-- これらの事象の大部分は、会社の富に影響を与えない事象であり、財務諸表には無関係である。 --></li>
<li>Eligibility for an event to become an accounting transaction is determined by <em>commercial law</em> — whatever events will <em>create income, financial obligations, or financial allocations</em> are likely to become accounting transactions. <!-- ある事象が会計取引となる要件は、商法によって決定され、収入、財的な義務、または財務的な配分を生み出す事象であれば何でも、会計取引となる可能性が高い。 --></li>
<li>The route from event to accounting transaction involves <em>three components</em> : <!-- 事象から会計取引に至るまでの経路には、3つの要素が含まれる。 --></li>
</ul>
</section>
<section id="the-origin-of-accounting-transactions-1" class="slide level2">
<h2>The Origin of Accounting Transactions</h2>
<ol type="1">
<li><p><em>The definition of the boundaries of the firm</em>. Thus the same event may be an accounting transaction on a divisional financial statement, but will not be incorporated into the consolidated financial statements. <!-- 1. **会社の境界についての定義** 従って、同じ事象が部門レベルの財務諸表上では会計取引である可能性があっても、連結財務諸表には組み込まれないことがある。 --></p></li>
<li><p><em>The relevant commercial law applying to the event-transaction</em>. Often this pertains to the definition of “<strong>ownership</strong>” of an asset, or “<strong>obligation</strong>” for a <em>promise, warranty, or contract</em>. <!-- Where ownership and obligations cannot be determined, the firm may need to report “contingent” liabilities or assets in a note. --> <!-- Before the nineteenth century, law mainly related to product transactions, but the twentieth century witnessed an explosion of intricacies in the law which have made this determination much more difficult. --> <!-- 2. **事象-取引に適用される商法の関連規定** 多くの場合、これは資産の「所有権」または契約（promise）の「義務」、保証（warranty）、もしくは契約の定義に関係する。所有権や義務が確定できない場合、企業は「偶発（contingent）」債務や資産を注記で報告する必要があるかもしれない。19世紀以前は、法律は主に製品の売買取引に関するものであったが、20世紀に入ると、法律が爆発的に複雑になり、この判断がより難しくなった。 --></p></li>
<li><p><em>The capture system for recording the event-transaction</em>. Auditor responsibility for capture of transactions has expanded significantly over the past two decades, particularly with the <em>Sarbanes–Oxley Act of 2002</em>. Firms are expected to have capture systems to assure that where there is a legal ownership or liability, that it shows up in the accounting reports. <!-- 3. **事象-取引の記録システム** 過去20年間、特に2002年のSOX法により、監査人の取引の記録に対する責任は大幅に拡大した。
企業は、法的な所有権や義務がある場合、それが財務諸表へ表示されることを確実なものとするために、記録システムを構築することが期待されている。 --></p></li>
</ol>
</section>
<section id="chart-of-accounts" class="slide level2">
<h2>Chart of Accounts</h2>
<ul>
<li>Once an event has successfully bridged the transition from real world to captured and recorded accounting transaction, <em>it needs a name and a sign</em>. <!-- ある事象が、現実世界から会計取引として識別され記録されるまでの橋渡しに成功したら、その事象には名前と符号が必要となる。 --></li>
<li>This is the responsibility of the “<em>Chart of Accounts</em>”. <!-- これが 「勘定科目一覧（Chart of Accounts）」の責任である。 --></li>
<li>The Chart of Accounts is an artificial categorization system that is set up by the firm’s controller or financial executive. <!-- 勘定科目一覧は、企業の経理担当者または財務担当役員によって設定される人工的な分類システムである。 --></li>
<li>It varies from firm to firm, reflecting the idiosyncrasies of the firm’s particular business. <!-- これは、会社によって異なり、その会社特有のビジネスの特性を反映している。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>There are general guidelines for constructing any Chart of Accounts, guided by <em>generally accepted accounting principles</em> (GAAP) and needed to assure that investors can easily compare investment in one firm with another. <!-- 勘定科目一覧の作成には、一般に公正妥当と認められた会計原則（Generally Accepted Accounting Principles：以下、GAAP）に基づく一般的な指針があり、勘定科目一覧は投資家がある企業への投資と他の企業への投資を容易に比較できるようにするために必要である。 --></li>
<li>High volume transactions such as sales and payroll will have their own journals - today these are typically computer systems dedicated to processing a single type of transaction. <!-- 売上や給与計算のような大量の取引は、それぞれ独自の帳簿を持っており、現在、これらの独自の帳簿は、通常、単一種類の取引を処理するための専用コンピュータ・システムとなっている。--></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Less common transactions may receive less attention, and thus may be more error prone. <!-- あまり一般的でない取引は、あまり注目されないため、誤謬が発生しやすいかもしれない。  --></li>
<li>In addition, there may be specific idiosyncrasies of GAAP that modify the application and interpretation of any of these <em>four filters</em>. <!-- さらに、下記の4つのフィルターのどれかの適用と解釈を変更するような、GAAP特有の特性があるかもしれない。 --></li>
<li>Thus when auditors speak of a “<em>transaction stream</em>” (取引のフロー) they are fundamentally referencing some real-world event located in time, space, and value, but which has been processed through a set of filters: <!-- 従って、監査人が「取引フロー（transaction stream）」と言う場合、基本的には、時間、空間、 および価値で位置づけられる現実世界の事象を指しているが、それは下記の連続したフィルターを通して処理されたものである。 --></li>
</ul>
</section>
<section id="the-five-filters" class="slide level2">
<h2>The Five Filters</h2>
<ol type="1">
<li>capture. 取引の識別</li>
<li>legal ownership and valuation. 法的な所有権と評価</li>
<li>firm boundaries. 企業の境界</li>
<li>classification. 分類</li>
<li>GAAP. GAAP</li>
</ol>
<!--
1.
2.
3.
4.
5.
 -->
</section>
<section class="slide level2">

<ul>
<li>This complexity is fundamental to process of accounting, and is necessary for assuring that stakeholders have <em>informative and comparable financial statements</em>. <!-- このような複雑性は、会計プロセスの基本であり、利害関係者が情報提供的で比較可能な財務諸表を入手できるようにするために必要なものである。 --></li>
<li>The remainder of the accounting process is a matter of stylized summarization of the transactions processed through these filters. <!-- （5段階のプロセス以外の）会計プロセスの残りの部分は、これらのフィルターを通して処理された取引について数値を定型的に要約していくことに関する問題である。 --></li>
<li>The summarization is inherently <strong>linear-additive</strong> with a few non-linear exceptions applied to allocations over time or output. <!-- この要約は本質的に線形加法的（linear-additive）であるが、時間や（生産高などの）アウトプットに応じた配分に適用されるいくつかの非線形の例外もある。 --></li>
<li>Sadly, the most consequential part of accounting - <em>this five stage filtering process</em> - is also the part that receives very little formal attention in auditing. <!-- 残念ながら、財務諸表の最も重要な部分であるこの5段階のフィルタリング・プロセスは、監査ではほとんど注目されない部分でもある。 --></li>
</ul>
</section>
<section id="audit-tests-as-learning-models" class="slide level2">
<h2>Audit Tests as Learning Models</h2>
<p>Auditing may be seen as a sequence of evidence collection and analyses that help the auditor learn enough to render an opinion. Conceptually, the tests involve a sequence of inferences: <!-- 監査は、監査人が監査意見を表明するのに相応しい学習を行わせるための体系的な証拠収集と分析として捉えることができる。 --> <!-- 概念的には、監査手続には以下のような一連の推論が含まれる。 --></p>
<ol type="1">
<li><p><strong>Audit planning</strong> will have set scope and sample size values for audit tasks that in general ‘seek to discover’ (i.e., <strong>discovery sampling</strong>) whether or not transaction processing is or is not in control. This is usually stated as an <em>assessment of error rates</em> rather than dollar magnitudes of error. <!-- 1. 監査計画では、運用評価手続に適用される監査範囲とサンプルサイズが設定される。ここで運用評価手続は、全体として取引処理が統制されているか否かを「発見しようとする」ために実施される（すなわち、このような手続は発見サンプリング（discovery sampling）といえる）。このような運用評価手続では、虚偽表示額ではなく逸脱率の評価が行われる。 --></p></li>
<li><p>If errors are discovered in a particular transaction flow, then <em>sufficient additional evidence</em> (十分な追加的監査証拠) must be gathered to assess the rate of error occurrences in the transaction flow (i.e., attribute sampling). <!-- 2. 特定の取引フローにおいて逸脱が発見された場合、その取引フローにおける逸脱率を評価するために、十分な追加証拠が収集されなければならない（すなわち、このような手続は属性サンプリング（attribute sampling）といえる）。 --></p></li>
</ol>
</section>
<section class="slide level2">

<ol start="3" type="1">
<li><p>Transaction flows with error rates that are sufficiently high to be deemed “out-of-control” (i.e., intolerable from the audit perspective) are listed on <em>the Internal Control Memo</em> generated at the end of the <em>Interim compliance audit</em>. <!-- 3. 「全体として統制できていない（out-of-control）」、つまり監査の観点からは許容できないと判断されるほど十分に逸脱率が高い取引フローは、運用評価手続の最後に作成される内部統制についての内部報告（Internal Control Memo）に記載される。 --></p></li>
<li><p>Financial statement account balances affected by any transaction flows with error rates that are sufficiently high to be deemed “out-of-control” will have their sample sizes in the audit program for year-end substantive tests adjusted to assure an accurate assessment of the existence of material error in the audited financial statements. <!-- 4. 全体として統制できていないと判断されるほど逸脱率が高い取引フローの影響を受ける財務諸表の勘定残高については、監査計画において実証手続のサンプルサイズが調整される。これは、監査済財務諸表における重要な虚偽表示を正確に評価するためである。 --></p></li>
</ol>
</section>
<section class="slide level2">

<ul>
<li>Various ad hoc and formal models have been proposed for the gradual accumulation of knowledge of the accounts throughout the audit. <!-- 監査を通じて財務諸表に関する知識を 段階的に蓄積するために、様々なアドホックモデルや形式的モデルが提案されてきた。 --></li>
<li>My own preference is for systems of audit task evidence accumulation modeled as <em>Bayesian conjugate priors</em>. <!-- 筆者が好んでいるのは、ベイズ共役事前分布としてモデル化された監査証拠の収集・評価のシステムである。 --></li>
<li>The most general of these involves the <em>Gamma distribution</em>, but we will simplify some of the steps using the <em>simpler one-parameter Poisson distribution</em>. <!-- このようなモデルで最も一般的なのはガンマ分布を利用したものであるが、著者はより単純なパラメータが1つだけのポアソン分布を利用して簡略化している --></li>
<li>Both distributions take on values on the positive quadrant, and thus are <em>more suitable for modeling accounting distributions than the Normal distribution</em>. <!-- 。どちらの分布も正の象限上の値をとるので、正規分布よりも会計数値をモデル化するのに適している。 --></li>
</ul>
</section></section>
<section>
<section id="working-with-dates" class="title-slide slide level1 center">
<h1>Working with Dates</h1>
<!-- 日付データの処理 -->
<ul>
<li>Time is an essential component of auditing. <!-- 時間は監査を実施するにあたって重要な要素である。 --></li>
<li><em>Income statement accounts</em> represent sums of transactions <strong>within strictly set periods</strong>, and <em>balance sheet accounts</em> are stated at <strong>a specific time</strong>. <!-- 損益計算書の勘定科目は厳密に設定された期間内の取引額の合計を表し、貸借対照表の勘定科目は特定の時点で計上される。 --> <!-- - Auditors routinely test timing of transactions for cutoff errors and frauds such as check kiting allows fraudsters to build up a balance in one bank by writing bad checks on another bank; or lapping involves stealing a customer payment and using any additional payments from that customer to cover the theft. --> <!-- 監査人は日常的に、カットオフエラーや、キッティングと呼ばれる小切手詐欺（不正実施者ががある銀行に対して預金がないにもかかかわらず小切手を振り出して、別の銀行の預金の残高を発生させるもの）やラッピング（顧客からの代金を盗み、他の顧客からの代金を窃盗した代金の補填に充てること）のような不正を検査するために取引のタイミングを検証する。 --></li>
<li>Transactions are always time-stamped, and the internal control, processing and auditing of client systems are heavily dependent on timing of transactions. <!-- 取引には常にタイムスタンプが押され、クライアントシステムの内部統制、処理、および監査（の信頼性）は取引のタイミングに大きく依存する。 --> <!-- Unfortunately, in computer environments, date-time data can be frustrating, error prone and difficult to work with, even though they are an essential element of all accounting systems.  --> <!-- 残念なことに、多くのコンピュータ環境において、日付・時刻のデータは、すべての会計システムに重要jな要素であるにもかかわらず、苛立たしく、問題が発生しやすく、扱うのが難しい。 --> <!-- Fortunately, the R package *lubridate* simplifies date-time manipulation and calculations in a fashion unparalleled in other software.  --></li>
</ul>
</section>
<section id="lubridate-packages" class="slide level2">
<h2><code>lubridate</code> packages</h2>
<!-- しかし幸いなことに、Rパッケージ*lubridate*は、他のソフトウェアにはない方法で、日時・時刻データの操作と計算を簡単にしてくれる。 -->
<ul>
<li>The <code>lubridate</code> package makes it easier to do the things R does with date-times and possible to do the things that Base-R does not.</li>
<li><code>lubridate</code> is included in <code>tidyverse</code> package now. <!-- `lubridate`パッケージは、日付・時刻データの処理を容易にすることができ、Rの基本関数ではできないことができる。 --></li>
<li>We can use these functions: <code>ymd()</code>，<code>mdy()</code>，<code>dmy()</code> etc. <!-- 日時の解析: ymd(), ymd_hms, dmy(), dmy_hms, mdy()など --></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(auditanalytics, tidyverse)</span>
<span id="cb60-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="dv">20101215</span>) <span class="co"># year month day</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2010-12-15"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">"4/1/17"</span>) <span class="co"># month day year</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017-04-01"</code></pre>
</div>
</div>
</section>
<section id="other-funcitons-in-lubridate-packages" class="slide level2">
<h2>Other funcitons in <code>lubridate</code> packages</h2>
<p>A simple function to get and set elements of a date-time, <code>year()</code>, <code>month()</code>, <code>mday()</code>, etc. <!-- ## 日時の要素を取得・設定する簡単な関数, year(), month(), mday(),など --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="" aria-hidden="true" tabindex="-1"></a>bday <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="st">"14/10/1979"</span>)</span>
<span id="cb64-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(bday) <span class="co"># 月を取得</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(bday, <span class="at">label =</span> <span class="cn">TRUE</span>) <span class="co"># 1979年10月14日は日曜日</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 日
Levels: 日 &lt; 月 &lt; 火 &lt; 水 &lt; 木 &lt; 金 &lt; 土</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(bday) <span class="ot">&lt;-</span> <span class="dv">2016</span></span>
<span id="cb68-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(bday, <span class="at">label =</span> <span class="cn">TRUE</span>) <span class="co"># 2016年10月14日は金曜日</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 金
Levels: 日 &lt; 月 &lt; 火 &lt; 水 &lt; 木 &lt; 金 &lt; 土</code></pre>
</div>
</div>
</section>
<section id="with_tz-and-force_tz" class="slide level2">
<h2><code>with_tz()</code> and <code>force_tz()</code></h2>
<p>Helper functions for handling time zones in <code>lubridate</code>: <code>with_tz()</code>, <code>force_tz()</code>. <!-- ## lubridateのタイムゾーンを扱うためのヘルパー関数: with_tz(), force_tz() --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2010-12-13 15:30:30"</span>) <span class="co"># time stamp</span></span>
<span id="cb70-2"><a href="" aria-hidden="true" tabindex="-1"></a>time <span class="co"># 2010年12月13日15時30分30秒</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2010-12-13 15:30:30 UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">with_tz</span>(time, <span class="st">"America/Chicago"</span>) <span class="co"># time zone change</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2010-12-13 09:30:30 CST"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">force_tz</span>(time, <span class="st">"America/Chicago"</span>) <span class="co">#</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2010-12-13 15:30:30 CST"</code></pre>
</div>
</div>
<p>timezoneに合わせて時刻も変換したい場合は<code>with_tz()</code>，timezoneだけを置き換えたい場合は<code>force_tz()</code></p>
</section>
<section id="lubridate-operations" class="slide level2">
<h2><code>lubridate</code> operations</h2>
<p>The <code>lubridate</code> also expands the type of mathematical operations that can be performed with date-time objects, and defines three time span classes that play roles in auditing: <!-- `lubridate`は、日時オブジェクトで実行できる数学的演算の種類も拡張し、監査において役割を果たす3つの時間間隔クラスを定義する。 --></p>
<ul>
<li><strong>durations</strong>, which measure the <em>exact amount of time between two points</em> <!-- - 持続時間(durations)は、2つの点の間の正確な時間を測定する --></li>
<li><strong>periods</strong>, which accurately track clock times despite leap years, leap seconds, and day light savings time <!-- - 期間(periods)は、うるう年、うるう秒、夏時間にも対応した時計時間を正確に追跡する --></li>
<li><strong>intervals</strong>, a protean summary of the time information between two points <!-- - 区間(intervals)は、2点間の時間情報の多様な要約である --></li>
</ul>
</section>
<section id="example-of-lubridate-operations" class="slide level2">
<h2>Example of <code>lubridate</code> operations</h2>
<div id="qwebr-insertion-location-4"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<!--
start <- ymd_hms("2024-10-16 13:00:00")
finish <- ymd_hms("2024-10-16 16:40:00")
-->
</section></section>
<section>
<section id="accounting-transactions" class="title-slide slide level1 center">
<h1>Accounting Transactions</h1>

</section>
<section id="accounting-transactions-for-auditors" class="slide level2">
<h2>Accounting Transactions for Auditors</h2>
<ul>
<li>Accounting transactions are the <strong>raw data</strong> in an accounting system. <!-- 会計取引は、会計システムにおける「生データ」である。 --></li>
<li>They represent measurements of economic events such as sales or purchases, that cross the border of the firm. <!-- 会計取引は、企業の境界を越える売上や仕入のような経済事象の測定値を表すものである。 --></li>
<li>Transactions are “measured” and “recorded” on <em>journal entries</em>, the documents of original entry. <!-- 取引は、原書記入帳(documents of original entry)に*仕訳*で「測定」され、「記録」される。 --></li>
<li>Journal entries were originally simply reminders and descriptive notes recorded in a journal book. <!-- 仕訳はもともと、単に仕訳帳に記録されたリマインダーや記述的なメモであった。 --></li>
<li>But with more formal, mathematical developments in accounting, they evolved into their current form of documents of original entry. <!-- しかし、会計におけるより形式的で数学的な発展により、原書記入帳の現在の形式に進化した。 --> <!-- - For high volume transactions, there will typically be specialized journals, e.g., the Sales Journal, or Purchase Journal, that consolidate the recording of these types of transactions in the accounting systems. --> <!-- 高頻度の取引については、売上仕訳帳や仕入仕訳帳などの特殊な仕訳帳があり、会計システムにおけるこの種の取引の記録を統合する。 --></li>
</ul>
</section>
<section id="th-century-developments-in-accounting" class="slide level2">
<h2>20th Century Developments in Accounting</h2>
<ul>
<li>Before the twentieth century, accounting was concerned mainly with computing the <strong>asset value</strong> of the firm, and focused on economic events that made the firm richer or poorer. <!-- 20世紀以前、会計は主に企業の資産価値を計算し、企業を豊かにしたり貧しくしたりする経済的な出来事に焦点を当てていた。 --></li>
<li>The twentieth century saw a transition to a more holistic perspective, where transactions were recorded to track, in addition to wealth, <em>managerial performance</em>, and <em>stakeholder interests</em>. <!-- 20世紀には、より包括的な視点への移行が見られ、取引は財産に加えて、経営者の業績や利害関係者の利益を追跡するために記録されるようになった。 --> <!-- In practice, our minimum level of resolution in transactions and accounts is one dollar (a single monetary unit). --> <!-- 実務上、取引と勘定の最小解像度は1ドル（単一の通貨単位）である。 --> <!-- - This resolution limit is in fact the basis of audit procedures such as dollar-unit sampling. --> <!-- この解像度の制限は、ドル単位抽出などの監査手続きの基礎となっている。 --></li>
<li>We are not limited to dollar levels of resolution; annual reports may use <em>thousands or millions of dollars</em> as their level of resolution. <!-- 解像度のレベルはドルに限定されているわけではなく、年次報告書では数千ドルや数百万ドルを解像度のレベルとして使用することができる。 --></li>
<li>Additionally, accounting and double-entry bookkeeping are methods of generating summarizations of transactions, and these often take the form of <strong>value</strong> <span class="math inline">\times</span> <strong>quantity</strong> statistics. <!-- くわえて、会計と複式簿記は取引の要約を生成する方法であり、これらはしばしば価値$\times $数量の統計量の形をとる。 --></li>
</ul>
</section>
<section id="the-histogram-of-accounting-transactions" class="slide level2">
<h2>The Histogram of Accounting Transactions</h2>
<ul>
<li>In the histogram below which was constructed from a real-world transaction journal, we use <code>qplot()</code> to produce a <em>histogram of discrete transaction values</em> at a resolution of one dollar. <!-- 以下のヒストグラムは、実際の取引仕訳帳から作成されたものであり、`qplot`（ggplotの省略形）を使用して、1ドルの解像度で離散的な取引値のヒストグラムを作成している。 --></li>
<li>The level of resolution determines the number of histogram bins, in this case 30. <!-- 解像度のレベルは、ヒストグラムのビンの数を決定する。この場合は30である。 --></li>
<li>Human cognition tends to be overwhelmed by large numbers of bins, which is why we often see financial statistics summarized at levels of resolution larger than one dollar (Fig. 1). <!-- 人間の認知は、多数のビンに圧倒されがちである。これが、しばしば1ドルより大きな解像度で要約された財務統計を見る理由である（図1）。 --></li>
</ul>
</section>
<section class="slide level2">

<h3 id="fig.-1.-histogram-of-accounting-transactions">Fig. 1. Histogram of Accounting Transactions</h3>

<img data-src="img/audit_fig01.png" class="r-stretch quarto-figure-center"><p class="caption">Figure 1</p></section>
<section class="slide level2">

<ul>
<li>This histogram displays several characteristics commonly seen in actual transaction probability distributions: <!-- このヒストグラムには、実際の取引確率分布でよく見られるいくつかの特徴が表示されている。 --></li>
</ul>
<ol type="1">
<li>the distribution is <strong>left-bounded at zero</strong>. <!-- 1. 分布はゼロで左に制限されている。 --></li>
<li>the distribution may be <strong>zero-inflated</strong>, i.e., it may have a substantial number of zero measurements. <!-- 2. 分布はゼロが多く含まれている、すなわち、ゼロの測定値が多く含まれている可能性がある。 --></li>
<li><strong>the distribution is multimodal</strong>, with a succession of value clusters trailing off to the right. <!-- 分布は多峰性であり、右に伸びる値のクラスターが続いている。 --></li>
</ol>
</section>
<section class="slide level2">

<h3 id="first-characteristics">First characteristics</h3>
<ul>
<li>The first characteristic is built into accounting systems by design; <em>account entries should not contain negative values</em>. <!-- 第1の特徴は会計システムの設計に組み込まれている。勘定科目には負の値を含めるべきではない。 --> <!-- Rather, when a transaction reduces an account balance, e.g., a reduction of Sales when there is a Sales Return, the reduction should be recorded in the "contra" account Sales Returns and Allowances. --> <!-- むしろ、取引が勘定科目の残高を減少させる場合、例えば、売上返品がある場合、減少は「対称」勘定の売上返品と手数料に計上されるべきである。 --></li>
<li>This convention goes back to the birth of accounting. <!-- この慣習は会計の誕生にさかのぼる。 --></li>
<li>In ninth century Baghdad, Al-Khwarizmi solved linear and quadratic equations using algebraic methods derived from the work of the Indian mathematician Brahmagupta, who invented negative numbers. <!-- 9世紀のバグダッドで、アル＝ワリズミーは、負の数を発明したインドの数学者ブラフマグプタの研究からもたらされた代数的手法を用いて、線形方程式と二次方程式を解いた。 --> <!-- Nonetheless, Al-Khwarizmi felt that negative results were meaningless. --> <!-- それにもかかわらず、アル＝ワリズミーは、負の結果は意味をなさないと感じていた。 --></li>
<li>In his treatise on the laws of inheritance (where the double-entry system was first published) Al-Khwarizmi instructed his readers to represent negative quantities as debts - i.e., <em>contra-accounts</em>. <!-- アル＝ワリズミーは、相続の法律に関する彼の論文（複式簿記が初めて発表された場所）で、読者に負の数量を債務（すなわち、対称勘定）として表現するよう指示した。 --></li>
</ul>
</section>
<section class="slide level2">

<h3 id="second-characteristics">Second Characteristics</h3>
<ul>
<li>The second characteristic reflects the existence of “convenience” transactions that record an economic event that has no effect on firm wealth. <!-- 第2の特徴は、企業の富に影響を与えない経済的事象を記録する「便宜的」な取引の存在を反映している。 --></li>
<li>These could reflect estimates, adjustments, or other ad hoc entries. <!-- これらは、見積り、調整、その他のアドホックな仕訳を反映している可能性がある。 --></li>
<li>The final characteristic is most interesting. <!-- 最後の特徴は最も興味深い。 --> <!-- - The verdict is still out on why we see this in transaction streams, but it seems to have several sources. --> <!-- なぜ取引ストリームでこれを見るのかはまだわかっていないが、いくつかのソースがあるようだ。 --></li>
<li>Transactions may be produced by several independent processes, perhaps representing different locations, product values, or other factor. <!-- 取引は、異なる場所、製品価値、その他の要因を表すかもしれないが、いくつかの独立したプロセスによって生成される可能性がある。 --></li>
<li>Another explanation arises from the mathematics of many transaction amounts - the unit price times the number of items in the transaction. <!-- 別の説明は、多くの取引金額の数学、単価$\times $取引数量から生じる。 --></li>
</ul>
</section>
<section class="slide level2">

<p>Even where values and quantities are unimodally distributed, their product can be multimodal, as is seen in the following graph (Fig. 2). <!-- 値と数量が単峰性分布であっても、その積は多峰性になることがある。 --> <!-- 以下のグラフ（図2）を見てみよう。 --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">lambda =</span> <span class="dv">2</span>)  <span class="co"># ポワソン分布から1000個の乱数を生成</span></span>
<span id="cb76-2"><a href="" aria-hidden="true" tabindex="-1"></a>quantity <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1000</span>, <span class="dv">10000</span>) <span class="co"># ポワソン分布から1000個の乱数を生成</span></span>
<span id="cb76-3"><a href="" aria-hidden="true" tabindex="-1"></a>value <span class="ot">&lt;-</span> price <span class="sc">*</span> quantity      <span class="co"># 価格と数量の積</span></span>
<span id="cb76-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(value, <span class="at">geom =</span> <span class="st">"histogram"</span>) <span class="co"># ヒストグラム</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="gaisho_2024_03_files/figure-revealjs/qplot01-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(value, <span class="at">geom =</span> <span class="st">"density"</span>)   <span class="co"># 密度分布</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="gaisho_2024_03_files/figure-revealjs/qqplot2-1.png" width="960" class="r-stretch"></section>
<section id="the-central-limit-theorem-and-accounting" class="slide level2">
<h2>The Central Limit Theorem and Accounting</h2>
<ul>
<li>Because accounting systems use linear operators, and <strong>summation</strong> is central to most accounting computations, it is natural to assume - when sampling, summarizing, or estimating errors - that errors are Normally distributed, because of the <strong>Central Limit Theorem</strong> (CLT). <!-- 会計システムは線形演算を使用し、ほとんどの会計計算において加算が中心的な役割を果たすため、サンプリング、要約、誤差の推定を行う際には、中心極限定理（CLT）により、誤差は正規分布に従うと仮定するのが自然である。 --></li>
<li>The CLT provides useful approximations, and is appropriate in many situations. <!-- 中心極限定理は有用な近似値を提供し、多くの状況において適切である。 --> <!-- Nonetheless, the auditor should not blindly invoke CLT convergence to justify Normality assumptions in the search for material errors in the financial statements (Fig. 3). --> <!-- それにもかかわらず、監査人は、財務諸表における重大な誤りを探すために正規性の仮定を正当化するために、中心極限定理の収束を盲目的に引き合いに出すべきではない（図3）。 --> <!-- - In a search for material errors, it may not be the entire transaction or account distribution that is important, but just **the upper tail**. --> <!-- 重大な誤りを探す際には、取引や勘定の分布全体が重要なのではなく、上側のテールだけが重要であるかもしれない。 --></li>
<li>Audit decisions tend to focus on the existence of material misstatements, which limit them to the upper tail. <!-- 監査の意思決定は、重大な誤りの存在に焦点を当てる傾向があり、これは上側のテールに限定される。 --></li>
</ul>
<!-- For a broad range of distributions, the asymptotic upper tail distribution can be inferred from the Fisher–Tippett–Gnedenko (FTG) theorem, an extreme value counterpart to the CLT. -->
<!-- 広範囲の分布については、中心極限定理の極限値に対応するフィッシャー・ティペット・グネデンコ(FTG)の定理から、漸近的な上側テール分布を推定することができる。 -->
<!-- The FTG Theorem proves that extreme values can only converge to either the Gumbel, Fréchet, or Weibull distributions or they do not converge at all. -->
<!-- FTG定理は、極値はガンベル分布、フレシェ分布、またはワイブル分布のいずれかにしか収束しないことを証明している。 -->
<!-- FTG convergence applies only to the right tail of the distribution, and is widely invoked in insurance risk models. -->
<!-- FTG収束は分布の右側テールにのみ適用され、保険リスクモデルで広く引用されている。 -->
<!-- This can be very useful in practice, empirical distributions in finance can be complicated, with multiple modes which may not be stable over time. -->
<!-- これは実務で非常に有用であり、金融における経験分布は複雑であり、複数のモードがあり、時間の経過とともに安定しない場合がある。 -->
<ul>
<li>Being able to more accurately characterize accounting distributions that matter allows the auditor to potentially reduce sample sizes, and lower the cost of auditing. <!-- 重要な会計分布をより正確に特徴付けることができれば、監査人はサンプルサイズを縮小し、監査のコストを削減することができる。 --></li>
</ul>
</section>
<section id="couching-institutional-language-in-statistical-terms" class="slide level2">
<h2>Couching Institutional Language in Statistical Terms</h2>
<!-- 統計的用語で制度的言語を表現する -->
<ul>
<li>Generally, auditing assumes underlying Gaussian distributions of account and transaction values. <!-- 一般的に監査では、勘定残高や取引金額が正規分布（ガウス分布）に従うと仮定している。 --> <!-- - Evidence has existed for some time (Loebbecke and Steinbart 1987) that empirical distributions of account and transaction values are kurtotic and can be multimodal. --> <!-- 会計取引の金額について経験的に想定されている分布が盲目的であり、（実際の分布が）多峰形な可能性があるという実証的証拠は以前から存在する（Loebbecke and Steinbart 1987）。 --></li>
<li>Gaussian assumptions are made for convenience, and there has been no clear evidence to date this assumption is unreasonable. <!-- 便宜上正規分布（ガウス分布）が仮定されているわけだが、この仮定が不合理であるという明確な実証的証拠もこれまで存在していない。 --></li>
<li>Auditors are concerned with the potential errors in audit decision-making that can arise from mis-classifying audit asset and transaction distributions. <!-- 監査人は、監査する資産や取引の分布を誤分類することから生じる可能性のある監査意思決定における失敗の可能性を懸念している。 --></li>
<li>If these are large, then auditors are either collecting more evidence than needed (driving up audit costs) or unnecessarily incurring additional risk of an incorrect audit opinion (and thus potential litigation). <!-- これらの監査意思決定における失敗が大きい場合、監査人は必要以上の監査証拠を収集することになる（ひいては監査コストを押し上げる）か、不必要に誤った監査意見（ひいては潜在的な訴訟につながる）の追加的な損害のリスクを負うことになる。 --></li>
</ul>
</section>
<section class="slide level2">

<p>The AICPA defines <em>two aspects</em> to sampling risk when <strong>performing tests of controls</strong>: <!-- AICPAは、運用評価手続を実施する際のサンプリングリスクについて、下記の2つの側面を定義している。 --></p>
<ol type="1">
<li><em>The risk of assessing control risk too low</em> represents the risk that an audit sample supports the conclusion that the design and operation of an internal con rol is effective when in fact it is not. <!-- 1. 統制リスクを過大評価するリスクは、内部統制の設計と運用が実際には有効であるにもかかわらず、有効ではないという結論が監査サンプルによって裏付けら るリスクを意味する（第1種の過誤、濡れ衣のリスク）。 --></li>
<li><em>The risk of assessing control risk too high</em> represents the risk that an audit sample supports the conclusion that the design and operation of an internal control is not effective when in fact it is effective. <!-- 2. 統制リスクを過大評価するリスクは、内部統制の設計と運用が実際には有効でないにもかかわらず、有効であるという結論が監査サンプルによって裏付けられるリスクを意味する（第2種の過誤、見逃しのリスク）。 --></li>
</ol>
<!--
松浦メモ 監基報330
(1) 「運用評価手続」－アサーション・レベルの重要な虚偽表示を防止又は発見・是正する内部統
制について、その運用状況の有効性を評価するために立案し実施する監査手続をいう。
(2) 「実証手続」－アサーション・レベルの重要な虚偽表示を看過しないよう立案し実施する監
査手続をいい、以下の二つの手続で構成される。
  ① 詳細テスト（取引種類、勘定残高及び注記事項に関して実施する。）
  ② 分析的実証手続
(3) 「リスク対応手続」－監査リスクを許容可能な低い水準に抑えるために、識別し評価したア
サーション・レベルの重要な虚偽表示リスクに対応して、立案し実施する監査手続をいう。リス
ク対応手続は、運用評価手続と実証手続で構成する。

監査人が監査意見を述べるにあたっては、財務諸表の各項目、構成する要素となる取引や会計事象の正しさを確かめなければならない。その確かめるべき目標を「監査要点」といい、これに適合した十分かつ適切な監査証拠を監査手続を実施して入手する。
具体的には、
●実在性（本当にあるのか）
●網羅性（すべて記録されているか）
●権利と義務の帰属（会社のものか）
●評価の妥当性（適切な価額か）
●期間配分の適切性（正しい期間に計上されているか）
●表示の妥当性（きちんと開示されているか）
-->
</section>
<section class="slide level2">

<p>The AICPA defines two aspects to sampling risk when <strong>performing substantive tests</strong>: <!-- AICPAは、実証手続を実施する際のサンプリングリスクには2つの側面があると定義している。 --></p>
<ol type="1">
<li>The risk of incorrect acceptance represents the risk that an audit sample supports the conclusion that a material misstatement does not exist when in fact a material misstatement does exist. This risk is similar to the risk of assessing control risk too low. <!-- (1) 誤った承認のリスクは、監査サンプルが、実際には重大な誤りが存在するにもかかわらず、重大な誤りが存在しないという結論を支持するリスクを表している。このリスクは、統制リスクを低く評価しすぎるリスクに類似している。 --></li>
<li>The risk of incorrect rejection represents the risk that an audit sample supports the conclusion that a material misstatement exists when in fact a material misstatement does not exist. This risk is similar to the risk of assessing control risk too high. <!-- (2) 誤った拒否のリスクは、監査サンプルが、実際には重大な誤りが存在しないにもかかわらず、重大な誤りが存在するという結論を支持するリスクを表している。このリスクは、統制リスクを高く評価しすぎるリスクに類似している。 --></li>
</ol>
</section>
<section class="slide level2">

<ul>
<li>Ultimately, an audit must provide shareholders in publicly traded securities an independent verification of the “<em>fairness</em>” of accounting reports. <!-- 究極的には、監査は上場企業の証券を保有する株主に会計報告の「公正性（fairness）」について独立した立場から立証しなければならない。 --></li>
<li>Audit procedures are dictated by two objectives: <em>cost efficiency</em> in data collection and analysis, and “<em>fairness</em>” in reporting. <!-- 監査手続は、データ収集と分析における監査コストの効率と、報告における「公正性」という2つの目的によって規定される。 --></li>
<li>Fairness is generally interpreted as <em>absence of “material error”</em> in the accounting reports. <!-- 公正性とは、一般的に会計報告に「重要な虚偽表示」がないことと解釈される。 --></li>
<li>For audits performed by an outside audit firm, risk assessment is a very crucial stage before accepting an audit engagement. <!-- 外部の監査法人による行われる監査において，リスク評価は監査契約を引き受ける前でも極めて重要な段階である。 --> <!-- It is an integral part of determining the audit tasks that will be performed in the audit program. --> <!-- 監査計画で実施される監査業務を決定する上で欠かせない一部である。 --> <!-- According to ISA 315, Understanding the Entity and its Environment and Assessing the Risks of Material Misstatement, “the auditor should perform risk assessment procedures to obtain an understanding of the entity and its environment, including its internal control.” --> <!-- ISA315「企業およびその環境の理解ならびに重要な虚偽表示リスクの評価」によると、「監査人は、内部統制を含む企業およびその環境を理解するために、リスク評価手続を実施しなければならない。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Evidence relating to the auditor’s risk assessment of a material misstatement in the client’s accounting statements. <!-- 監査人は、被監査会社の財務諸表における重要な虚偽表示リスクの評価に関する監査証拠を入手する。 --></li>
<li>Then, the auditor obtains initial evidence regarding the classes of transactions at the client and the operating effectiveness of the client’s internal controls. <!-- そして、監査人は、被監査会社の取引の種類および被監査会社の内部統制の有効性に関する（監査計画の）初期における監査証拠を入手する。 --></li>
<li>In auditing, audit risk includes <strong>inherent risk</strong> (IR), <strong>control risk</strong> (CR), and <strong>detection risk</strong> (DR). <!-- 監査リスクには、固有リスク（inherent risk：IR）、統制リスク（control risk：CR）、および発見リスク（detection riskDR）が含まれる。 --></li>
</ul>
</section>
<section id="the-audit-risk-model" class="slide level2">
<h2>The Audit Risk Model</h2>
<ul>
<li>The audit risk model expresses the risk of an auditor providing an inappropriate opinion of a commercial entity’s accounting statements and is calculated: <span class="math inline">AR = IR \times CR \times DR</span> . <!-- 監査リスクモデルは、営利企業の財務諸表に対する監査意見の表明が不適切なものとなるリスクを表すものであり、$AR = IR \times CR \times DR$で計算される。 --></li>
<li>In this formula, <span class="math inline">IR</span> refers to the risk involved in a business or transaction. <!-- この式において、$IR$とは、事業や取引に潜む固有のリスクを指す。 --> <!-- Example, transactions involving exchange of cash may have higher $IR$ than transactions involving settlement by checks. --> <!-- 例えば、現金の授受を伴う取引は、小切手による決済を伴う取引よりも$IR$が高くなる可能性がある。 --></li>
<li><span class="math inline">CR</span> refers to the risk that a misstatement could occur but <strong>may not be detected and corrected or prevented by entity’s internal control mechanism</strong>. <!-- $CR$とは、（事業や取引に潜む）虚偽表示が発生するが、企業の内部統制の仕組みによって発見・是正されない、または防止されないリスクをいう。 --></li>
<li><span class="math inline">DR</span> is the probability that <em>the audit procedures may fail to detect existence of a material error or fraud</em>. <!-- $DR$とは、監査手続が重要な誤謬や不正の存在を発見できない可能性のことである。 --></li>
<li>While <span class="math inline">CR</span> depends on <em>the strength or weakness of the internal control procedures</em>, DR is either due to sampling error or human factors. <!-- $CR$が（被監査会社による）内部統制の手続の厳格さや甘さに依存するのに対し、$DR$は（監査人による）サンプリングエラーや人的要因によるものである。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>Due to the breadth of qualitative and quantitative material that analytical procedures consider, audit risk models have typically been interpreted as abstract heuristics that provide a framework for auditor judgment, but not methods to explicitly process the external data. <!-- 分析的手続が考慮する質的および量的なデータの幅が広いため、監査リスクモデルは通常、監査判断の枠組みを提供する抽象的な問題解決方法として解釈されてきたが、外部データを明示的に処理する方法ではなかった。 --></p></li>
<li><p>But this need not be the case, as there are formal statistical models for assessment of financial reports using external data used by investors. <!-- しかし、投資家が利用する外部データを使った財務報告の評価のための正式な統計モデルが存在するのであれば、そうである必要はない。 --></p></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>The most influential of these is the <strong>efficient markets hypothesis</strong> (EMH) which states that asset prices reflected in these markets fully reflect all available information, and provides a strong motivation for reliance on asset markets for decision-making. <!-- その中で最も影響力があるのは、効率的市場仮説（efficient markets hypothesis：以下、EMH）である。 --> <!-- EMHは、市場に反映される資産価格は利用可能なすべての情報を完全に反映しているとし、意思決定を証券市場に依存する強い動機付けとなっている。 --></li>
<li>The distribution of abnormal returns in US asset markets provides complete and unbiased information about corporate performance. <!-- 米国の証券市場における異常リターンの分布は、企業業績に関する完全かつ偏りのない情報を提供している。 --></li>
<li>From the auditor’s perspective, in acquiring plausible financial and non-financial evidence prior to and during actual fieldwork, inexpensive evidence that can fully reflect all available information about a firm and the industry in which it operations should be extremely attractive. <!-- 監査人の観点からは、実際の監査実施に先立ち、また監査実施中に、もっともらしい財務的な監査証拠及び非財務的な監査証拠を入手する上で、企業及びその企業が事業を行っている業界に関する入手可能な全ての情報を完全に反映することができる安価な実証的な証拠は、極めて魅力的であるはずである。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Analytical procedures incorporating information-rich asset market statistics hold the potential to substitute for increased audit scope or risk without incurring additional fieldwork. <!-- 情報が豊富な証券市場の統計を組み込んだ分析的手続は、追加的な監査の実施を行うことなく、監査範囲の拡大やリスクの増加に代わる可能性を秘めている。 --></li>
<li>Tests of market efficiency have typically been carried out jointly with the <strong>Capital Asset Pricing Model</strong> (CAPM). <!-- 市場効率性のテストは通常、資本資産価格モデル（Capital Asset Pricing Model：以下、CAPM）と共同で行われてきた。 --></li>
<li>Both market efficiency and audit models in practice favor an assumption that transaction time series are Gaussian distributed. <!-- 市場効率性と監査モデルの両方が、実際には、取引時系列が正規分布（ガウス分布）しているという仮定を支持している。 --></li>
<li>Decision makers understand that this is only an approximation of reality, but it is often considered “<em>good enough</em>” with the Central Limit Theorem (CLT) commonly invoked as justification. <!-- 意思決定者は、これが現実の近似に過ぎないことを理解しているが、一般的に中心極限定理（CLT）が正当化として引き合いに出されるため、しばしば「これで十分」と考えられている。 --> <!-- But as was argued earlier, CLT convergence is most appropriate when trying to generate unbiased estimates for accounts, rather than for assessing extreme value situations such as material errors in financial statements. --> <!-- しかし、先に論じたように、CLTの収束が最も適切なのは、財務諸表の重要な虚偽表示のような極値の状況を評価するためではなく、財務諸表に対して不偏の見積りを生成しようとする場合である。 --></li>
</ul>
</section>
<section id="transaction-samples-and-populations" class="slide level2">
<h2>Transaction Samples and Populations</h2>
<p>Auditing depends heavily on sampling to control the cost of auditing. <!-- 監査は、監査コストに重大な影響を与えるサンプリングに大きく依存している。 --></p>
<ul>
<li>A statistical sample is a subset of the population. <!-- 統計的サンプルは母集団の部分集合である。 --></li>
<li>The population is all of the transactions relevant to a particular audit or procedure. <!-- 母集団とは、特定の監査や手続に関連するすべての取引のことである。 --> <!-- For example, in confirmation of accounts receivable (A/R) the population is all of the accounts receivable from customers buying on credit for the year (assuming an annual audit). --> <!-- 例えば、売掛金（accounts receivable：A/R）の確認では、母集団は、（年次監査を想定すると）会計年度に与信取引を行った得意先からの売掛金すべてである。 --></li>
<li>Audit samples are usually several orders of magnitude smaller than the population. <!-- 監査サンプルは通常、母集団より数桁小さい。 --> <!-- For example, auditors might take a sample of 100 units (transactions or dollars) from a population of 1 million accounts receivable or 0.01% of the items in the population. --> <!-- 例えば、監査人は100万単位の勘定の母集団から100単位（取引単位または金額単位）のサンプル（または母集団の0.01%）を抽出する。 --></li>
</ul>
</section>
<section id="sampling-bases" class="slide level2">
<h2>Sampling Bases</h2>
<ul>
<li>The sampling base or metric is the unit used to draw the sample. <!-- サンプリング単位（sampling unit, base, or metric）は、サンプルを抽出するために利用される単位である。 --></li>
<li>Monetary unit sampling (one dollar is a sample item) is applied at year end for substantive testing—determining whether the financial statement account balances contain material errors. <!-- （ドル単位では1ドルがサンプル単位となる）金額単位サンプリング（Monetary unit sampling）は、財務諸表の勘定残高に重要な虚偽表示があるかを判定する実証手続に適用される。 --></li>
<li>Transaction or Record sampling (one accounting transaction is a sample item) is applied prior to year-end for <em>internal control testing</em> - determining whether the inherent level of transaction processing error risk that exists in each accounting cycle. <!-- 取引または記録のサンプリング（会計取引1件がサンプル項目となる）は、年末前に内部統制のテストに適用され、各会計サイクルに存在する取引処理エラーリスクの固有レベルを判定する。 (文章が抜けてる)--></li>
</ul>
</section>
<section id="sampling-guidelines" class="slide level2">
<h2>Sampling Guidelines</h2>
<p>The AICPA provides guidelines on sampling in several standards: <!-- AICPAは、いくつかの監査基準において以下のようなサンプリングに関するガイドラインを提供している。 --></p>
<ul>
<li>Risk assessment standards (SAS Nos. 104-111).</li>
<li>Defining Professional Requirements Standard (SAS No.&nbsp;102).</li>
<li>Guidance on audit documentation (SAS 103).</li>
<li>Communicating internal control related matters (SAS 112 and SAS 115).</li>
<li>Audit Risk Alerts such as Communicating Internal Control Related Matters in an Audit—Understanding SAS No.&nbsp;115 These discuss several approaches to the audit sampling process.</li>
<li>Statistical audit sampling in tests of controls and for substantive tests of details.</li>
<li>Non-statistical audit sampling in tests of controls and for substantive tests of details.</li>
<li>Monetary unit sampling.</li>
<li>Attribute sampling.</li>
<li>Multi-location sampling considerations.</li>
</ul>
<!--
- リスク評価基準（SAS第104-111号）。
- 専門的要求事項を定義する基準（SAS第102号）。
- 監査調書に関する実務指針（SAS第103号）。
- 内部統制に関連する事項のコミュニケーション（SAS第112号及びSAS第115号）。
- 監査に関するリスク文書：監査における内部統制に関連する事項のコミュニケーションーSAS第115号の理解ー　
　これらの文書は、監査サンプリング手続に対して、以下のような手法について議論している。
- 運用評価手続および実証手続（詳細テスト）における統計的な監査サンプリング。
- 運用評価手続および実証手続（詳細テスト）における非統計的な監査サンプリング。
- 金額単位サンプリング
- 属性サンプリング
- 全社質問状のサンプリング（Multi-location sampling）の際の考慮事項
 -->
</section>
<section id="audit-and-accounting-manual-for-smes" class="slide level2">
<h2>Audit and Accounting Manual for SMEs</h2>
<ul>
<li><p>Additionally, the <em>AICPA Audit and Accounting Manual</em> addresses problems in small- and medium size CPA practices.</p></li>
<li><p>It explains engagement steps from planning, to performing procedures, to issuing reports: <!-- さらに、AICPAによる監査会計マニュアル（Audit and Accounting Manual）は、中小規模の公認会計士の実務における問題に取り組んでいる。また、同マニュアルは、監査契約の段階から監査契約、監査手続の実施や監査報告書の報告に至るまで以下のように説明している。 --></p></li>
<li><p>Guidance on internal controls.</p></li>
<li><p>Audit documentation guidelines.</p></li>
<li><p>Illustrative confirmation letters.</p></li>
<li><p>Illustrative engagement and representation letters.</p></li>
<li><p>Illustrative auditor’s reports.</p></li>
</ul>
<!--
- 内部統制に関する実務指針
- 監査調書に関する実務指針
- 確認書のひな形
- 監査契約書および経営者確認書のひな形
- 監査人報告書のひな形
 -->
</section>
<section id="types-of-sampling" class="slide level2">
<h2>Types of Sampling</h2>
<p>The AICPA discusses the following types of sampling in drawing conclusions from audit evidence.</p>
<!-- , which are discussed in depth later in the chapter on Design of Audit Programs: -->
<!-- AICPAは、（監査人が）監査証拠から結論を導き出す際の各種のサンプリングについて、以下のように説明している（これらのサンプリングについては監査計画の策定の章で詳細に説明する）。 -->
<ol type="1">
<li><strong>Judgmental sampling</strong> : Items are audited based on personal hunches and convenience involving a subjective selection of items for testing and a subjective evaluation of the results.</li>
<li><strong>Random sampling</strong> : Applies random number generators to assure that each population unit or item has an equal probability of being selected for the sample.</li>
<li><strong>Fixed-interval sampling</strong> : Specify an interval and a random starting point which must be greater than zero and less than or equal to the selection interval.</li>
<li><strong>Random-interval sampling</strong> :Specify an interval and a random seed which is the basis for a series of pseudo-random numbers.</li>
</ol>
</section>
<section class="slide level2">

<ol start="5" type="1">
<li><p><strong>Conditional sampling</strong> : Apply a condition to subject only a portion of the population to selection.</p></li>
<li><p><strong>Stratified sampling</strong> : A process of dividing a population in subgroups each of which is a set of sampling units with similar characteristics. <!-- Stratified sampling may be considered a particular form of conditional sampling — conditioned on item size (in dollars, etc.). --></p></li>
<li><p><strong>Transaction or Record sampling</strong> : Treat seach recorded transaction equivalently.</p></li>
<li><p><strong>Monetary Unit Sampling</strong> : Treats each recorded dollar equivalently.</p></li>
<li><p><strong>Estimation sampling</strong> : Sampling with an objective to estimate the proportion of errors to see if it is less than some acceptable level.</p></li>
<li><p><strong>Acceptance sampling</strong> : Sampling with an objective to reject or accept the population under certain conditions.</p></li>
<li><p><strong>Discovery sampling</strong> : Sampling with an objective to determine if the population is error free.</p></li>
</ol>
<!--
1. 判断サンプリング（judgmental sampling）：サンプル項目は個人的な直感や簡便な方法に基づいて項目の監査を行う方法。主観的に監査手続を行う項目を選択し、その結果を主観的に評価する。
2. ランダムサンプリング（random sampling）： 各母集団における単位または項目がサンプルとして選択される確率が等しいことを保証するために、乱数発生器を適用する方法。
3. 固定間隔サンプリング（fixed-interval sampling）： ランダムな開始点と間隔を指定する方法。開始点は0より大きく、選択した間隔以下でなければならない。
4. セルサンプリングまたは乱数間隔サンプリング（Cell or random-interval sampling）： 間隔と擬似乱数（pseudo-random numbers）の基礎となる乱数種（random seed）を指定する方法。
5. 条件付サンプリング（conditional sampling）： 母集団の一部だけを選択の対象とする条件付けを行う方法。
6. 層化サンプリング（）： 母集団を小集団に分けるプロセスで、各小集団は類似した特徴を持つサンプリング単位の集合である。層化サンプリングは、条件付サンプリングの特殊な形態と考えられる。
7. 取引サンプリングまたは記録サンプリング： 記録された各取引を同等に扱う。
8. 金額単位サンプリング： 記録された金額単位（ドル）を同等に扱う。
9. 見積りサンプリング： 虚偽表示や逸脱の割合を見積もり、それがある許容水準より小さいかどうかを確認することを目的としたサンプリング。
10. 採択サンプリング： ある条件下で母集団の受入れの可否を判断することを 目的とたサンプリング。
11. 発見サンプリング： 母集団に虚偽表示または逸脱がないかどうかを判断することを目的としたサンプリング。
  -->
</section>
<section id="accounting-cycles" class="slide level2">
<h2>Accounting Cycles</h2>
<p>An accounting cycle begins when accounting personnel create a transaction from a source document and ends with the completion of the financial reports and closing of temporary accounts in preparation for a new cycle. <!-- 会計サイクルは、経理担当者が原始文書に取引を記録する際に始まり、財務報告の完了と新しいサイクルに備えた仮勘定の締切で終わる。（主な機能を持つ）下記の5つの会計サイクルがある。 --> The five accounting cycles are:</p>
<ol type="1">
<li><strong>Revenue cycle</strong>.
<ol type="1">
<li>Sales orders,</li>
<li>Cash receipts.</li>
</ol></li>
<li><strong>Expenditure cycle</strong>. This cycle focuses on two separate resources; <em>inventory</em> and <em>human resources</em>. <!-- 3.  and is often considered two separate cycles; purchasing and payroll/HR. -->
<ol type="1">
<li>Inventory / purchasing;</li>
<li>Accounts payable;</li>
<li>Payroll;</li>
<li>Cash payments.</li>
</ol></li>
</ol>
</section>
<section class="slide level2">

<ol start="3" type="1">
<li><strong>Conversion cycle</strong> (Production cycle).
<ol type="1">
<li>Production;</li>
<li>Cost accounting.</li>
</ol></li>
<li><strong>Financing</strong> (Capital Acquisition and repayment).
<ol type="1">
<li>Borrowing/repayment;</li>
<li>Issuing stock;</li>
<li>Dividends;</li>
<li>Cash management.</li>
</ol></li>
<li><strong>Fixed assets.</strong></li>
</ol>
<!--
1. 収益サイクル
    1. 販売管理
    2. 売掛金の回収
2. 費用サイクル（このサイクルは、商品と人材という2つの別々の資源に焦点を当ており、購買と給与・HRという2つの別々のサイクルとされることもある。）
    1. 棚卸管理・購買管理
    2. 買掛金の支払い
    3. 給与計算
    4. 給与の支払い
3. コンバージョン（製造）サイクル
    1. 製造
    2. 原価計算
4. 財務（資金の調達・返済）
    1. 借入れと返済
    2. 株式の発行
    3. 配当
    4. キャッシュマネジメント
5. 固定資産 -->
<!-- ## 実証手続 -->
</section>
<section id="substantive-test" class="slide level2">
<h2>Substantive Test</h2>
<ul>
<li>The purpose of substantive procedures is <strong>to provide audit evidence</strong> as to the <em>completeness</em>, <em>accuracy</em>, and <em>validity</em> of the information contained in the accounting records or in the financial statements. <!-- 実証手続の目的は、会計記録または財務諸表に含まれる情報の網羅性、正確性、および妥当性に関する監査証拠を提供することである。 --></li>
<li>Substantive testing involves detailed examination of the monetary value of the account balances to determine their accuracy and to draw conclusions about the materiality of the error amounts in the accounts. <!-- 実証手続は、勘定残高の正確性を判断し、財務諸表における虚偽表示額の重要性について結論を導き出すために、勘定残高の価値を詳細に検討することを含む。 --></li>
<li>The extent and nature of substantive testing depends upon the decision taken about the effectiveness of the systems of internal control. <!-- 実証手続の範囲と種類は、内部統制システムの有効性に関する（監査人の）判断によって決まる。 --></li>
<li>In substantive testing, statistical sampling is used to obtain monetary estimates of the total error amount or confidence limits for the total error amount in a particular account. <!-- 実証手続において、統計的サンプリングは、特定の勘定における総虚偽表示の金額の見積りまたは総の信頼区間を得るために使用される。 --></li>
<li>The objective is to obtain <strong>reliable confidence limits</strong>. <!-- その目的は、監査で利用可能な信頼区間を得ることである。 --></li>
</ul>
</section>
<section id="metrics-and-estimates" class="slide level2">
<h2>Metrics and Estimates</h2>
<ul>
<li>Statisticians estimate; business analysts measure. <!-- 統計学者は推定を行うのに対し、ビジネスアナリストは測定する。 --></li>
<li>Statisticians often use the terms <em>statistic</em> and <em>estimate</em> for values calculated from the data, to draw a distinction between interpretations of the data, and the “true” state of affairs. <!-- 統計学者は、データの解釈と「真の」状態を区別するために、データから計算された値に対して統計量や推定値という言葉をよく使う。 --></li>
<li>Data scientists and business analysts are more likely to refer to such values as a <em>metric</em>. <!-- データサイエンティストやビジネスアナリストは、このような値を「測定値」(metric)と呼ぶことが多い。 --></li>
<li>The difference reflects the approach of statistics versus data science: accounting for uncertainty lies at the heart of the discipline of statistics. <!-- この違いは、統計学とデータサイエンスのアプローチを反映している。 --> <!-- 不確実性を考慮することが統計学の中心である。 --> <!-- Business or organizational objectives are the focus of data science. --> <!-- ビジネスや企業組織の目標は、データサイエンスの焦点として扱われる。 --></li>
</ul>
</section>
<section id="audit-and-statistics" class="slide level2">
<h2>Audit and Statistics</h2>
<p>In the past, the auditors initial step when confronted with a new database is to “foot” the dataset (i.e., compute a total) and “agree” that total to the client’s records (i.e., see whether client’s records agree with the computed total). <!-- 従来、監査人が新しいデータベースを扱うときの最初のステップは、データベースの「集計（foot）（すなわち、合計を計算すること）」と、その合計が被監査会社の記録と「一致（agree）」しているか確認することであった。 --> This is done with the “sum” command in R. <!-- Rでは`sum`コマンドで計算できる。 --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="" aria-hidden="true" tabindex="-1"></a>disburse <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">system.file</span>( <span class="co"># csvファイルの読み込み</span></span>
<span id="cb78-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"extdata"</span>,  <span class="st">"ch_2_AP_disbursements_journal.csv"</span>, <span class="co"># ファイル名</span></span>
<span id="cb78-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">package =</span> <span class="st">"auditanalytics"</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-4"><a href="" aria-hidden="true" tabindex="-1"></a>    ) <span class="co"># ファイルがない場合はエラーを返す</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(disburse) <span class="co"># descriptive statistics</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> disbursement_no        date            amount_paid  
 Length:50          Length:50          Min.   :2417  
 Class :character   Class :character   1st Qu.:2537  
 Mode  :character   Mode  :character   Median :2618  
                                       Mean   :2686  
                                       3rd Qu.:2800  
                                       Max.   :3190  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># output the total amount paid</span></span>
<span id="cb81-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'</span><span class="sc">\n\n</span><span class="st"> 支払帳の合計金額 = '</span>, <span class="fu">sum</span>(disburse<span class="sc">$</span>amount_paid))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

 支払帳の合計金額 =  134313.5</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p><em>R</em> has a number of packages that generate basic statistics fromt the data, beyond that of the built-in <em>summary</em> command Here are three of the most useful, applied to our banking industry dataset. <!--
Rには、標準のsummaryコマンド以外に、データから基本的な統計量を計算するパッケージが数多くある。
ここでは、本書で紹介する銀行業界のデータに適用できる、最も有用な3つのパッケージを紹介する。
--></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc) <span class="co"># 記述統計量の計算</span></span>
<span id="cb83-2"><a href="" aria-hidden="true" tabindex="-1"></a>bank_fin <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">system.file</span>(</span>
<span id="cb83-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"extdata"</span>, <span class="st">"ch_2_yahoo_fin.csv"</span>,</span>
<span id="cb83-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">package =</span> <span class="st">"auditanalytics"</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-5"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb83-6"><a href="" aria-hidden="true" tabindex="-1"></a>Hmisc<span class="sc">::</span><span class="fu">describe</span>(bank_fin) <span class="co"># Show summary statistics</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>bank_fin 

 9  Variables      38  Observations
--------------------------------------------------------------------------------
ticker 
       n  missing distinct 
      25       13       25 

lowest : BAC-PC BAC-PE BAC-PK BAC-PL BAC-PY, highest: WFC-PR WFC-PV WFC-PW WFC-PX WFC-PY
--------------------------------------------------------------------------------
name 
       n  missing distinct 
      25       13        7 

lowest : Banco Santander, S.A. GTD PFD SECS 6 Bank of America Corporation          Berkshire Hathaway Inc.              HSBC Holdings plc ADR A 1/40PF A     JPMorgan Chase &amp; Co.                
highest: Berkshire Hathaway Inc.              HSBC Holdings plc ADR A 1/40PF A     JPMorgan Chase &amp; Co.                 Visa Inc.                            Wells Fargo &amp; Company               
--------------------------------------------------------------------------------
price 
       n  missing distinct     Info     Mean      Gmd      .05      .10 
      25       13       25        1    12231    24374    22.38    22.93 
     .25      .50      .75      .90      .95 
   25.70    26.45    28.66   935.15  1437.69 
                      
Value      0e+00 3e+05
Frequency     24     1
Proportion  0.96  0.04

For the frequency table, variable is rounded to the nearest 5000
--------------------------------------------------------------------------------
change 
       n  missing distinct 
      26       12       22 

lowest : -0.01   -0.03   -0.04   -0.06   -0.07  
highest: 0.14    1.10    1.92    2631.00 ticker 
--------------------------------------------------------------------------------
percent_change 
       n  missing distinct     Info     Mean      Gmd      .05      .10 
      25       13       23    0.999   0.2016   0.4513   -0.268   -0.252 
     .25      .50      .75      .90      .95 
  -0.110    0.180    0.410    0.740    0.952 

lowest : -0.48 -0.27 -0.26 -0.24 -0.19, highest: 0.44  0.53  0.88  0.97  1.02 
--------------------------------------------------------------------------------
volume 
       n  missing distinct     Info     Mean      Gmd      .05      .10 
      25       13       25        1   520349   939507     4340     5020 
     .25      .50      .75      .90      .95 
   20982    34142    80933  1267169  3278800 

lowest :     243    4284    4566    5700   11997
highest:   89764  140922 2018000 3594000 6506000
--------------------------------------------------------------------------------
vol_ave 
       n  missing distinct     Info     Mean      Gmd      .05      .10 
      25       13       25        1   935629  1706024     6093     7569 
     .25      .50      .75      .90      .95 
   29831    44849    85711  2347830  6281000 
                                                       
Value             0   100000  3700000  6900000 11400000
Frequency        19        3        1        1        1
Proportion     0.76     0.12     0.04     0.04     0.04

For the frequency table, variable is rounded to the nearest 100000
--------------------------------------------------------------------------------
capitalization 
       n  missing distinct 
      25       13       25 

lowest : 211.288B 212.921B 214.807B 215.543B 216.366B
highest: 368.674B 403.496B 492.962B 493.498B 541.154B
--------------------------------------------------------------------------------
pe_ratio 
       n  missing distinct     Info     Mean      Gmd      .05      .10 
      25       13       25        1     43.2     71.1    2.846    3.834 
     .25      .50      .75      .90      .95 
   5.440    7.430   11.120   53.596  249.240 
                                                       
Value         0    5   10   15   30   45   55  295  505
Frequency     3   15    1    1    1    1    1    1    1
Proportion 0.12 0.60 0.04 0.04 0.04 0.04 0.04 0.04 0.04

For the frequency table, variable is rounded to the nearest 5
--------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="bank-financial-data">Bank Financial Data</h3>
<p>The <em>describe</em> and <em>describeBy</em> functions of the <em>psych</em> package offer rich reporting of summary statistics, though much of this may be superfluous in auditing. <!-- `psych`パッケージの`describe`関数と`describeBy`関数は、要約統計量の豊富なレポーティングを提供するが、その多くは監査には不必要かもしれない。 --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych) <span class="co"># 心理統計学のためのパッケージ</span></span>
<span id="cb85-2"><a href="" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(bank_fin) <span class="co"># 記述統計量の出力</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                vars  n      mean         sd   median   trimmed      mad    min
ticker*            1 38      9.55       8.61     7.50      8.91     9.64   1.00
name*              2 38      4.05       2.89     3.00      3.97     2.97   1.00
price              3 25  12231.23   60356.40    26.45    112.41     1.93  20.88
change*            4 38      8.84       7.52     7.50      8.34     9.64   1.00
percent_change     5 25      0.20       0.39     0.18      0.18     0.37  -0.48
volume             6 25 520348.92 1480580.79 34142.00 138295.05 32832.18 243.00
vol_ave            7 25 935628.64 2678595.35 44849.00 237653.14 45797.51 245.00
capitalization*    8 38      9.55       8.61     7.50      8.91     9.64   1.00
pe_ratio           9 25     43.20     113.07     7.43     12.99     3.16   0.01
                        max       range skew kurtosis        se
ticker*               26.00       25.00 0.47    -1.30      1.40
name*                  8.00        7.00 0.30    -1.61      0.47
price             301936.00   301915.12 4.42    18.23  12071.28
change*               23.00       22.00 0.37    -1.40      1.22
percent_change         1.02        1.50 0.41    -0.63      0.08
volume           6506000.00  6505757.00 3.01     8.48 296116.16
vol_ave         11488000.00 11487755.00 2.90     7.68 535719.07
capitalization*       26.00       25.00 0.47    -1.30      1.40
pe_ratio             506.93      506.92 3.19     9.35     22.61</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="bank-financial-data-by-group">Bank Financial Data by Group</h3>
<!-- ### 特定のグループごとの要約統計量をdescribeByで指定可能 -->
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describeBy</span>(bank_fin, bank_fin<span class="sc">$</span>name)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Descriptive statistics by group 
group: 
               vars  n mean  sd median trimmed mad min  max range skew kurtosis
ticker            1 13 1.00 0.0      1       1   0   1    1     0  NaN      NaN
name              2 13 1.00 0.0      1       1   0   1    1     0  NaN      NaN
price             3  0  NaN  NA     NA     NaN  NA Inf -Inf  -Inf   NA       NA
change            4 13 2.69 6.1      1       1   0   1   23    22 2.82     6.44
percent_change    5  0  NaN  NA     NA     NaN  NA Inf -Inf  -Inf   NA       NA
volume            6  0  NaN  NA     NA     NaN  NA Inf -Inf  -Inf   NA       NA
vol_ave           7  0  NaN  NA     NA     NaN  NA Inf -Inf  -Inf   NA       NA
capitalization    8 13 1.00 0.0      1       1   0   1    1     0  NaN      NaN
pe_ratio          9  0  NaN  NA     NA     NaN  NA Inf -Inf  -Inf   NA       NA
                 se
ticker         0.00
name           0.00
price            NA
change         1.69
percent_change   NA
volume           NA
vol_ave          NA
capitalization 0.00
pe_ratio         NA
------------------------------------------------------------ 
group: Banco Santander, S.A. GTD PFD SECS 6
               vars n     mean sd   median  trimmed mad      min      max range
ticker            1 1    15.00 NA    15.00    15.00   0    15.00    15.00     0
name              2 1     2.00 NA     2.00     2.00   0     2.00     2.00     0
price             3 1    22.72 NA    22.72    22.72   0    22.72    22.72     0
change            4 1    12.00 NA    12.00    12.00   0    12.00    12.00     0
percent_change    5 1     0.18 NA     0.18     0.18   0     0.18     0.18     0
volume            6 1 11997.00 NA 11997.00 11997.00   0 11997.00 11997.00     0
vol_ave           7 1 19388.00 NA 19388.00 19388.00   0 19388.00 19388.00     0
capitalization    8 1    20.00 NA    20.00    20.00   0    20.00    20.00     0
pe_ratio          9 1    49.93 NA    49.93    49.93   0    49.93    49.93     0
               skew kurtosis se
ticker           NA       NA NA
name             NA       NA NA
price            NA       NA NA
change           NA       NA NA
percent_change   NA       NA NA
volume           NA       NA NA
vol_ave          NA       NA NA
capitalization   NA       NA NA
pe_ratio         NA       NA NA
------------------------------------------------------------ 
group: Bank of America Corporation
               vars n     mean       sd   median  trimmed      mad     min
ticker            1 7     5.00     2.16     5.00     5.00     2.97    2.00
name              2 7     3.00     0.00     3.00     3.00     0.00    3.00
price             3 7   224.31   529.23    25.78   224.31     3.77   20.88
change            4 7     6.43     4.31     5.00     6.43     2.97    3.00
percent_change    5 7    -0.11     0.24    -0.19    -0.11     0.12   -0.27
volume            6 7 33409.00 29580.81 32345.00 33409.00 32341.44 4566.00
vol_ave           7 7 41777.29 34055.28 29831.00 41777.29 35695.08 5755.00
capitalization    8 7    15.00     2.16    15.00    15.00     2.97   12.00
pe_ratio          9 7    79.83   188.34     9.17    79.83     1.33    7.43
                    max    range skew kurtosis       se
ticker             8.00     6.00 0.00    -1.71     0.82
name               3.00     0.00  NaN      NaN     0.00
price           1424.47  1403.59 1.62     0.80   200.03
change            15.00    12.00 0.98    -0.63     1.63
percent_change     0.41     0.68 1.37     0.28     0.09
volume         86124.00 81558.00 0.56    -1.25 11180.50
vol_ave        85711.00 79956.00 0.18    -2.02 12871.69
capitalization    18.00     6.00 0.00    -1.71     0.82
pe_ratio         506.93   499.50 1.62     0.80    71.18
------------------------------------------------------------ 
group: Berkshire Hathaway Inc.
               vars n       mean         sd     median    trimmed        mad
ticker            1 2       9.50       0.71       9.50       9.50       0.74
name              2 2       4.00       0.00       4.00       4.00       0.00
price             3 2  151068.58  213358.75  151068.58  151068.58  223676.04
change            4 2      21.50       0.71      21.50      21.50       0.74
percent_change    5 2       0.92       0.06       0.92       0.92       0.07
volume            6 2 1009121.50 1426769.66 1009121.50 1009121.50 1495763.26
vol_ave           7 2 1890622.50 2673397.50 1890622.50 1890622.50 2802673.68
capitalization    8 2      24.50       0.71      24.50      24.50       0.74
pe_ratio          9 2       8.57      12.11       8.57       8.57      12.70
                  min        max      range skew kurtosis         se
ticker           9.00      10.00       1.00    0    -2.75       0.50
name             4.00       4.00       0.00  NaN      NaN       0.00
price          201.16  301936.00  301734.84    0    -2.75  150867.42
change          21.00      22.00       1.00    0    -2.75       0.50
percent_change   0.88       0.97       0.09    0    -2.75       0.04
volume         243.00 2018000.00 2017757.00    0    -2.75 1008878.50
vol_ave        245.00 3781000.00 3780755.00    0    -2.75 1890377.50
capitalization  24.00      25.00       1.00    0    -2.75       0.50
pe_ratio         0.01      17.14      17.13    0    -2.75       8.56
------------------------------------------------------------ 
group: HSBC Holdings plc ADR A 1/40PF A
               vars n     mean sd   median  trimmed mad      min      max range
ticker            1 1    11.00 NA    11.00    11.00   0    11.00    11.00     0
name              2 1     5.00 NA     5.00     5.00   0     5.00     5.00     0
price             3 1    26.45 NA    26.45    26.45   0    26.45    26.45     0
change            4 1    10.00 NA    10.00    10.00   0    10.00    10.00     0
percent_change    5 1     0.00 NA     0.00     0.00   0     0.00     0.00     0
volume            6 1 26376.00 NA 26376.00 26376.00   0 26376.00 26376.00     0
vol_ave           7 1 61496.00 NA 61496.00 61496.00   0 61496.00 61496.00     0
capitalization    8 1    26.00 NA    26.00    26.00   0    26.00    26.00     0
pe_ratio          9 1    56.04 NA    56.04    56.04   0    56.04    56.04     0
               skew kurtosis se
ticker           NA       NA NA
name             NA       NA NA
price            NA       NA NA
change           NA       NA NA
percent_change   NA       NA NA
volume           NA       NA NA
vol_ave          NA       NA NA
capitalization   NA       NA NA
pe_ratio         NA       NA NA
------------------------------------------------------------ 
group: JPMorgan Chase &amp; Co.
               vars n       mean         sd    median    trimmed      mad
ticker            1 3      13.00       1.00     13.00      13.00     1.48
name              2 3       6.00       0.00      6.00       6.00     0.00
price             3 3      54.84      46.66     28.05      54.84     0.44
change            4 3      12.67       9.45     16.00      12.67     5.93
percent_change    5 3       0.45       0.54      0.36       0.45     0.59
volume            6 3 2225376.33 3707131.82  89764.00 2225376.33 13934.96
vol_ave           7 3 3941765.67 6535296.89 198076.00 3941765.67 87258.42
capitalization    8 3      20.67       1.53     21.00      20.67     1.48
pe_ratio          9 3       5.61       4.77      2.87       5.61     0.04
                     min        max       range  skew kurtosis         se
ticker             12.00 1.4000e+01        2.00  0.00    -2.33       0.58
name                6.00 6.0000e+00        0.00   NaN      NaN       0.00
price              27.75 1.0871e+02       80.96  0.38    -2.33      26.94
change              2.00 2.0000e+01       18.00 -0.31    -2.33       5.46
percent_change     -0.04 1.0200e+00        1.06  0.16    -2.33       0.31
volume          80365.00 6.5060e+06  6425635.00  0.38    -2.33 2140313.55
vol_ave        139221.00 1.1488e+07 11348779.00  0.38    -2.33 3773155.42
capitalization     19.00 2.2000e+01        3.00 -0.21    -2.33       0.88
pe_ratio            2.84 1.1120e+01        8.28  0.38    -2.33       2.76
------------------------------------------------------------ 
group: Visa Inc.
               vars n       mean sd     median    trimmed mad        min
ticker            1 1      16.00 NA      16.00      16.00   0      16.00
name              2 1       7.00 NA       7.00       7.00   0       7.00
price             3 1     180.07 NA     180.07     180.07   0     180.07
change            4 1       7.00 NA       7.00       7.00   0       7.00
percent_change    5 1      -0.48 NA      -0.48      -0.48   0      -0.48
volume            6 1 3594000.00 NA 3594000.00 3594000.00   0 3594000.00
vol_ave           7 1 6906000.00 NA 6906000.00 6906000.00   0 6906000.00
capitalization    8 1      23.00 NA      23.00      23.00   0      23.00
pe_ratio          9 1      34.58 NA      34.58      34.58   0      34.58
                      max range skew kurtosis se
ticker              16.00     0   NA       NA NA
name                 7.00     0   NA       NA NA
price              180.07     0   NA       NA NA
change               7.00     0   NA       NA NA
percent_change      -0.48     0   NA       NA NA
volume         3594000.00     0   NA       NA NA
vol_ave        6906000.00     0   NA       NA NA
capitalization      23.00     0   NA       NA NA
pe_ratio            34.58     0   NA       NA NA
------------------------------------------------------------ 
group: Wells Fargo &amp; Company
               vars  n     mean       sd   median  trimmed      mad     min
ticker            1 10    21.50     3.03    21.50    21.50     3.71   17.00
name              2 10     8.00     0.00     8.00     8.00     0.00    8.00
price             3 10   167.96   447.30    26.42    26.63     0.90   25.58
change            4 10    14.60     3.57    15.50    14.88     3.71    8.00
percent_change    5 10     0.29     0.19     0.36     0.31     0.15   -0.07
volume            6 10 44811.50 39786.63 32546.00 37863.62 16703.71 4284.00
vol_ave           7 10 50484.90 35897.76 39847.00 44781.88 14567.29 7758.00
capitalization    8 10     6.50     3.03     6.50     6.50     3.71    2.00
pe_ratio          9 10    34.68    92.36     5.46     5.50     0.19    5.28
                     max     range  skew kurtosis       se
ticker             26.00      9.00  0.00    -1.56     0.96
name                8.00      0.00   NaN      NaN     0.00
price            1441.00   1415.42  2.28     3.57   141.45
change             19.00     11.00 -0.42    -1.31     1.13
percent_change      0.53      0.60 -0.56    -1.13     0.06
volume         140922.00 136638.00  1.31     0.62 12581.64
vol_ave        138836.00 131078.00  1.31     0.92 11351.87
capitalization     11.00      9.00  0.00    -1.56     0.96
pe_ratio          297.54    292.26  2.28     3.57    29.21</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>If the auditor wishes to use summary statistics for further processing, these can be formatted into data frames using the <em>tidy</em> function in <em>broom</em>; alternatively, the data frames can be used to print formatted tables, which may be included in audit papers.</p>
<!-- 監査人がさらなる処理に要約統計量を使用したい場合は、broom の tidy 関数を使用してデータフレームにフォーマットすることができる。あるいは、データフレームを利用してフォーマットされた表を印刷し、監査調書に含めることもできる。 -->
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(kableExtra, broom, pastecs) <span class="co"># パッケージの読み込み</span></span>
<span id="cb89-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="do">## Tidy these up and write them as a formated table, using kableExtra</span></span>
<span id="cb89-3"><a href="" aria-hidden="true" tabindex="-1"></a>pastecs<span class="sc">::</span><span class="fu">stat.desc</span>(bank_fin) <span class="sc">|&gt;</span></span>
<span id="cb89-4"><a href="" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb89-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">longtable =</span> T, <span class="at">caption =</span> <span class="st">"Summary Statistics"</span>) <span class="sc">|&gt;</span></span>
<span id="cb89-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> F, <span class="at">font_size =</span> <span class="dv">18</span>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top" data-quarto-postprocess="true" style="font-size: 18px; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Summary Statistics</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">column</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sd</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">median</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">trimmed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mad</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">min</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">max</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">range</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">skew</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">kurtosis</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ticker</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">name</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">price</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">2.602796e+08</td>
<td style="text-align: right;">9.735837e+08</td>
<td style="text-align: right;">1.215125e+04</td>
<td style="text-align: right;">8.494124e+04</td>
<td style="text-align: right;">1.214879e+04</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3.642895e+09</td>
<td style="text-align: right;">3.642895e+09</td>
<td style="text-align: right;">3.328201</td>
<td style="text-align: right;">12.076923</td>
<td style="text-align: right;">2.602012e+08</td>
</tr>
<tr class="even">
<td style="text-align: left;">change</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">percent_change</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">3.515023e+00</td>
<td style="text-align: right;">7.098547e+00</td>
<td style="text-align: right;">6.972503e-01</td>
<td style="text-align: right;">2.057527e+00</td>
<td style="text-align: right;">5.799849e-01</td>
<td style="text-align: right;">-0.48</td>
<td style="text-align: right;">2.500000e+01</td>
<td style="text-align: right;">2.548000e+01</td>
<td style="text-align: right;">2.331536</td>
<td style="text-align: right;">7.251627</td>
<td style="text-align: right;">1.897167e+00</td>
</tr>
<tr class="even">
<td style="text-align: left;">volume</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1.565820e+11</td>
<td style="text-align: right;">5.858680e+11</td>
<td style="text-align: right;">4.082325e+05</td>
<td style="text-align: right;">2.413592e+06</td>
<td style="text-align: right;">4.082246e+05</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">2.192119e+12</td>
<td style="text-align: right;">2.192119e+12</td>
<td style="text-align: right;">3.328201</td>
<td style="text-align: right;">12.076923</td>
<td style="text-align: right;">1.565798e+11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vol_ave</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">5.124946e+11</td>
<td style="text-align: right;">1.917564e+12</td>
<td style="text-align: right;">7.356739e+05</td>
<td style="text-align: right;">4.305602e+06</td>
<td style="text-align: right;">7.356659e+05</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">7.174873e+12</td>
<td style="text-align: right;">7.174873e+12</td>
<td style="text-align: right;">3.328201</td>
<td style="text-align: right;">12.076923</td>
<td style="text-align: right;">5.124906e+11</td>
</tr>
<tr class="even">
<td style="text-align: left;">capitalization</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">-Inf</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pe_ratio</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1.082288e+03</td>
<td style="text-align: right;">3.382558e+03</td>
<td style="text-align: right;">3.410240e+01</td>
<td style="text-align: right;">1.972988e+02</td>
<td style="text-align: right;">3.278888e+01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.278445e+04</td>
<td style="text-align: right;">1.278445e+04</td>
<td style="text-align: right;">3.280235</td>
<td style="text-align: right;">11.874574</td>
<td style="text-align: right;">9.040266e+02</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>However the auditor chooses to summarize a dataset, there are certain common statistics that will be generated. <!-- 監査人がデータセットをどのように要約するかにかかわらず、生成される共通の統計量がある。 --></li>
</ul>
<ol type="1">
<li><strong>Count</strong> : How many transactions (or rows) does the dataset contain. <!-- 1. 件数（count）： データセットに含まれる取引（または行）の数 --></li>
<li><strong>Information</strong> : Potentially the maximum amount that the data can tell you about is the variability of a particular construct. <!-- 1. 2.  （データセットに含まれる）情報（information）： データからわかる最大限のことは、特定の構成要素に対する変動性である。 --> <!-- Information is context specific (you cannot use a weather database to predict poker outcomes) and there is no absolute measure.  --> <!-- 情報は文脈に固有であり（ポーカーの結果を予測するのに天気データベースを使うことはできない）、絶対的な尺度はない。 --> In accounting transactions, the count of data is often not a good measure of information content. <!-- 会計取引では、データの数は情報量の良い尺度にはならないことが多い。 --> Accounting data is highly multicollinear - the same economic event (e.g., a sale) is repeatedly recorded in the data (e.g., as an account receivable of the same amount, as an inventory reduction of a related amount, as a collection, and so forth)</li>
</ol>
</section>
<section class="slide level2">

<!-- 会計データは非常に多重共線的であり、同じ経済事象が繰り返しデータに記録される（例えば売上の記録に対して、同額の売掛金の記録、関連する金額の在庫の削減の記録、売掛金の回収の記録など）。 -->
<ol start="3" type="1">
<li><strong>Mean</strong> : The basic estimate of location. The arithmetic mean (or just mean) is the sum of all the values divided by the number of values. <!-- 1. 平均値（mean）： 基礎的な（中心）位置の見積り。算術平均（または単に平均と呼ぶ）は、すべての値の合計を値の数で割ったものである。 --></li>
<li><strong>Trimmed mean</strong> : An arithmetic mean that removes a small designated percentage of the largest and smallest values before calculating the mean. <!-- 1. 刈込み平均（trimmed mean）： 平均を計算する前に、最大値と最小値から一定の割合を除去した算術平均。 --> <!-- After removing the specified outlier observations, the trimmed mean is found using a standard arithmetic averaging formula.  --> <!-- 外れ値となる特定の観測値を除去した後、標準的な算術平均式を用いて刈込み平均が求められる。 --></li>
<li><strong>Outlier</strong> : An outlier is any value that is very distant from the other values in a dataset. The exact definition of an outlier is somewhat subjective. <!--
Outliers are exceptions that should be further investigated.
Being an outlier in itself does not make a data value invalid or erroneous.
Nonetheless, outliers are often the result of data errors.
When outliers are the result of bad data, the mean will result in a poor estimate of location, while the median will still be valid.
Outliers are sometimes informative and sometimes a nuisance, in anomaly detection the points of interest are the outliers, and the greater mass of data serves primarily to define the “normal” against which anomalies are measured. --> <!-- 1. 外れ値（outlier）： 外れ値とは、データセット内の他の値から大きく外れた値のことである。外れ値を正確に定義しようとするとやや主観的になってしまうが、データの要約やプロットにおいて特定の（外れ値を検出する方法が）慣例として使われている。外れ値は、さらに詳細に調査されるべき例外である。外れ値だからといってそのデータ値が無効であったり、誤りであったりするわけではないが、データの誤りの結果として外れ値が生じることもある。悪いデータの結果として外れ値が生じている場合、平均値は（中心）位置の推定に問題が起きるが、中央値については有効のままである。外れ値は情報価値がある場合もあれば、厄介な場合もある。異常値検出（anomaly detection）では注目すべき点は外れ値であり、より多くの（他の）データは、異常を測定する基準となる「正常（normal）」を定義する役割を主に果たす。 --></li>
<li><strong>Median</strong> : The median is the middle number on a sorted list of the data. <!--
It provides a robust estimate of location since it is not influenced by outliers (extreme cases) that could skew the results.
An outlier is any value that is very distant from the other values in a dataset.
The exact definition of an outlier is somewhat subjective, although certain conventions are used in various data summaries and plots.
Being an outlier in itself does not make a data value invalid or erroneous.
Still, outliers are often the result of data errors such as mixing data of different units (kilometers versus meters) or bad readings from a sensor.
When outliers are the result of bad data, the mean will result in a poor estimate of location, while the median will be still valid.
In any case, outliers should be identified and are usually worthy of further investigation.
--> <!-- 6. 中央値（median）： 中央値は、データを並び替えたリストの真ん中に位置する数字である。結果を歪める可能性のある外れ値の影響を受けないので、中央値は（中心）位置について頑強な推定値を提供する。外れ値は、異なる単位（キロメートルとメートル）のデータが混在していたり、センサーが読み取りに失敗した、といったデータの誤りの結果であることがある。外れ値がデータの誤りの結果である場合、平均値は位置の推定に失敗するが、中央値はまだ有効である（いずれにせよ、外れ値は（その原因が）特定されるべきであり、通常はさらに調査する価値がある）。 --></li>
<li><strong>Variance</strong> : The primary variability statistic (though less commonly used than standard deviation). It is the sum of squared deviations from the mean divided by <span class="math inline">n − 1</span> where <span class="math inline">n</span> is the count. <!-- Location is just one dimension in summarizing a feature. A second dimension, variability, also referred to as dispersion, measures whether the data values are tightly clustered or spread out. At the heart of statistics lies variability: measuring it, reducing it, distinguishing random from real variability, identifying the various sources of real variability, and making decisions in the presence of it. --> <!-- 7. 分散（variance）： （標準偏差の方が良く利用されるが）主要なバラツキを測る統計量。平均からの偏差の2乗和をn-1で割ったもので、nは件数である。（中心）位置は特徴を要約する1次のモーメントにすぎない。2次のモーメントであるバラツキは、分散とも呼ばれ、測定値が密集しているか散財しているかを測定する。統計学の本質は、バラツキにある。すなわち、バラツキを測定し、バラツキを小さくし、ランダムなバラツキと実際のバラツキを区別すること、本当のバラツキのさまざまな原因を特定すること、そして（結果に）バラツキがある状況下で意思決定をすることである。 --></li>
</ol>
</section>
<section class="slide level2">

<ol start="8" type="1">
<li><strong>Deviations</strong> : (errors, residuals): The difference between the observed values and the estimate of location. <!-- 8. 偏差（deviations）： 観測値と推定値との差。誤差（errors）や残差（residuals）ともいう。 --></li>
<li><strong>Standard deviation</strong> : The square root of the variance. Standard deviation (sd) is more commonly used than variance, because its values are easy to compare to linear estimators such as the mean. <!-- Measures of variability are borrowed from the field of mechanics, where a moment is an expression involving the product of a distance and another physical quantity. In statistics, the first moment of a distribution is the mean, the second moment the variance, and third and fourth moments describe skewness and kurtosis. Higher moments are not particularly robust, so tend not to be used. --> <!-- 9. 標準偏差（standard deviation：SD）： 分散の平方根。標準偏差は平均などの線形推定量と比較しやすいので、分散よりもよく使われる。バラツキの測定値は力学の分野に由来しており、同分野ではモーメントが距離と別の物理量（力または質量）の積を含む式である。 --></li>
<li><strong>Degrees of freedom</strong> (df): Another concept borrowed mechanics. <!-- Where a mechanism is made of several parts, it is the number of possible independent relative motions between the parts of the mechanism. --> <!-- In statistics, the number of degrees of freedom is the number of values in the final calculation of a statistic that are free to vary. It is a rough way to determine whether a dataset is large enough to render a decision based on a particular hypothesis or statistic. Degrees of freedom considerations are important in computing sample statistics, as adjustments are required to assure the statistic is not biased. --> <!-- 10.    自由度（degrees of freedom：df）： 力学に由来するもう一つの概念。メカニズムがいくつかの部分から構成されている場合、メカニズムの部分間の独立した相対運動の可能性の数である。統計学では、自由度とは、ある統計量の最終的な計算において、自由に変化する値の数である。これは、データセットが特定の仮説や統計量に基づいて決定を下すのに十分な大きさかどうかを判断するための大まかな手法である。自由度の検討は、統計量が偏らないように調整する必要があるため、標本統計量を計算する上で重要である。 --></li>
<li><strong>Mean absolute deviation</strong> (mad, l1-norm, Manhattan norm): The mean of the absolute value of the deviations from the mean. <!-- 11.    平均偏差の絶対値 (mean absolute deviation：mad, L1-norm, Manhattan norm)： 平均からの偏差について絶対値をとった値の平均。 --></li>
<li><strong>Range</strong> : The difference between the largest (max) and the smallest (min) value in a dataset. <!-- 12.    範囲（range）：データセット内の最大値と最小値の差 --></li>
<li><strong>Skew and Kurtosis</strong> : In statistics, <!-- the first moment of a distribution is the mean, the second moment the variance, and  --> <em>third</em> and <em>fourth moments</em> describe skewness and kurtosis. <!-- Higher moments are not particularly robust, so tend not to be used. Typically central moments are reported, which means that the distance is computed from the mean of the distribution of transactions, rather than from zero. --> <!-- 13.    歪度（Skew）・尖度（Kurtosis）：統計学では、分布の1次のモーメントが平均、2次のモーメントが分散、3次のモーメントと4次のモーメントが歪度と尖度を表す。それ以上の高次のモーメントは特に頑強でないので、あまり使用されない。（特定の取引の分布に興味がある場合）通常、中心モーメント（つまり平均）が示されるが、これは距離がゼロからではなく、取引の分布の平均から計算されることを表している。 --></li>
</ol>
</section>
<section class="slide level2">

<ol start="14" type="1">
<li><p><strong>Order statistics</strong> : Metrics based on the data values sorted from smallest to biggest. <!-- 14.    順序統計量（order statistics）： 小さいものから大きいものへと並べたデータの指標 --></p></li>
<li><p><strong>Percentile (quantile)</strong> : The value such that p% of the values take on this value or less and (100 − p)% take on more than this value. The difference between the 75th percentile and the 25th percentile is called the interquartile range (IQR). <!-- 15.    パーセンタイル（percentile）・分位数（quantile）： 値のp％がこの値以下で、(100 - p)％がこの値以上であるような値。特に、75パーセンタイルと25パーセンタイルの差を四分位範囲（interquartile range：IQR）という --></p></li>
<li><p><strong>Correlation coefficient</strong> : A metric that measures the extent to which numeric variables are associated with one another (ranges from −1 to +1). <!-- 16.    相関係数： 量的変数が互いにどの程度関連しているかを測定する指標（範囲は-1から+1） --></p></li>
<li><p><strong>Scatterplot</strong> : A plot in which the x-axis is the value of one variable, and the y-axis the value of another. <!-- 17.    散布図（Scatterplot）：X軸をある変数の値、Y軸を別の変数の値とする図。 --></p></li>
</ol>
</section>
<section id="important-concepts-in-probability-and-statistics" class="slide level2">
<h2>Important Concepts in Probability and Statistics</h2>
<ul>
<li><em>Probability distributions</em> are models describing the variability of data or the underlying population from which the data is drawn. <!-- 確率分布は、データのバラツキやデータの元となる母集団を記述するモデルである。 --></li>
<li>There are perhaps <em>50 or 60 different distributions</em> that are used in characterizing population statistics, but only <em>half a dozen are commonly used</em>. <!-- 母集団を特徴づける分布は、50～60種類程度あるが、一般的に使われるのはそのうちの6つだけである。 --></li>
<li>Quite often when we refer to parametric statistics, we are making an assumption of <strong>Normal</strong> (Gaussian) distributions for the data. <!-- パラメトリック統計により分析するとき、分析者はデータについて正規分布（ガウス分布）を仮定していることが多い。   --></li>
<li>We will see later that this assumption may not be warranted for accounting and financial transactions. <!-- この仮定が会計取引や財務取引では正当化されない場合があることについては、後述する。 --></li>
</ul>
</section>
<section class="slide level2">

<ol type="1">
<li><strong>Normal (Gaussian) distribution</strong> : The <em>bell-shaped</em> normal distribution is iconic in traditional statistics. Related terms are: <!-- 1. 正規分布またはガウス分布： ベル型の正規分布は、伝統的な統計学の象徴である。関連用語として以下をあげる。 -->
<ul>
<li><em>Standardization</em> : Subtract the mean and divide by the standard deviation.</li>
<li><em>z-score</em> : The result of standardizing an individual data point.</li>
<li><em>Standard normal</em> : A normal distribution with <code>mean = 0</code> and standard deviation = 1.</li>
<li><em>QQ-Plot</em> : A quantile (of the sample) by quantile (of a Normal distribution) plot to visualize how close a sample distribution is to a Normal distribution. <!-- - For the disbursement data, an example of a QQ-plot follows --> <!-- - 標準化（standardization）： 平均を引き、標準偏差で割る。
 - zスコア（z-score）： 個々のデータポイントを標準化した結果。
 - 標準正規分布（standard normal distribution）： 平均=0、標準偏差=1の正規分布。
 - QQプロット（QQ-Plot）：標本分布が正規分布にどれだけ近いかを視覚化するための、（正規分布の）分位数による（標本の）分位数のプロット。以下のQQプロットは、支出データについての具体例である。 --></li>
</ul></li>
</ol>
</section>
<section id="qq-plot" class="slide level2">
<h2>QQ-Plot</h2>
<p>Read the disbursement data <code>ch_2_AP_disbursements_journal.csv</code> and create a QQ-plot.</p>
<div class="cell">
<details class="code-fold">
<summary>コード</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="" aria-hidden="true" tabindex="-1"></a>disburse <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">system.file</span>(</span>
<span id="cb90-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"extdata"</span>, <span class="st">"ch_2_AP_disbursements_journal.csv"</span>, <span class="co"># csv file</span></span>
<span id="cb90-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">package =</span> <span class="st">"auditanalytics"</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>))</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(disburse[,<span class="st">"amount_paid"</span>]))</span>
<span id="cb91-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d,</span>
<span id="cb91-3"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Normal Q-Q Plot"</span>, <span class="co"># QQプロットを作成</span></span>
<span id="cb91-4"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Theoretical Quantiles"</span>, <span class="co"># x軸のラベル</span></span>
<span id="cb91-5"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Sample Quantiles"</span>, <span class="co"># y軸のラベル</span></span>
<span id="cb91-6"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.it =</span> <span class="cn">TRUE</span>) <span class="co"># プロットするかどうか</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="gaisho_2024_03_files/figure-revealjs/qqplot_disburse-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<h3 id="various-distributions">various distributions</h3>
<ol start="2" type="1">
<li><strong>Binomial Distribution</strong> : A binomial distribution with parameters <span class="math inline">n</span> and <span class="math inline">p</span> is the discrete probability distribution of the number of successes in a sequence of n independent experiments <!-- , each asking a yes–no question, and each with its own Boolean-valued outcome: success/yes/true/one (with probability p) or failure/no/false/zero (with probability q = 1 p). --> A single success/failure experiment is also called a <strong>Bernoulli trial</strong> and a sequence of outcomes is called a <strong>Bernoulli process</strong>; for a single trial, the binomial distribution is a <strong>Bernoulli distribution</strong>. <!-- The binomial distribution is the basis for the popular binomial test of statistical significance.  --> <!-- 2. 二項分布： nとpをパラメータとする二項分布は、n個の独立したベルヌーイ試行（成功か失敗の2値の結果を持つ試行で、成功確率p・失敗確率1-pと表す）における成功回数の離散確率分布。ベルヌーイ試行の結果の列はベルヌーイ過程（Bernoulli process）と呼ばれ、ベルヌーイ試行を一度だけ行う（n=1）の場合の確率分布はベルヌーイ分布と呼ばれる。二項分布は、よく利用される統計的有意についての二項検定の基礎となる。 --></li>
<li><strong>Bernoulli distribution</strong> : A Bernoulli distribution is the <em>discrete probability distribution</em> of a random variable which takes the value 1 with probability <span class="math inline">p</span> and the value <span class="math inline">0</span> with probability <span class="math inline">q = 1 − p</span>. <!-- In other words, the probability distribution of any single experiment that asks a yes–no question; the question results in a Boolean-valued outcome, a single bit whose value is success/yes/true/one with probability p and failure/no/false/zero with probability q. --> <!-- 3. ベルヌーイ分布： ベルヌーイ分布とは、確率pで値1をとり、確率q = 1 - pで値0をとる確率変数の離散確率分布である。言い換えれば、YES・NOの質問を行うような、あらゆる単体の試行の確率分布である。質問の結果はブール値の結果であり、その値は確率pで1（成功/YES/真）、確率qで0（失敗/NO/偽）である単体の二値の値である。 --></li>
</ol>
</section>
<section class="slide level2">

<ol start="4" type="1">
<li><p><strong>Poisson distribution</strong> : the Poisson distribution is a discrete probability distribution that expresses the probability of a <em>given number of events occurring in a fixed interval</em> of time or space if these events occur with a known constant rate and independently of the time since the last event. <!-- The waiting time between Poisson events follows an Exponential distribution. --> <!-- 4. ポアソン分布（Poisson distribution）：ポアソン分布はある時間または空間の一定区間において、ある事象が一定の割合で（最後の事象からの時間とは独立に）発生する確率を表す離散確率分布である。ポアソン事象間の待ち時間は、指数分布に従う。 --></p></li>
<li><p><strong>Density and Cumulative Distribution</strong> : Probabilities have densities (in continuous distributions such as the Normal) or mass functions (in the case of discrete distributions such as the Poisson) that describe the probability of a given outcome. Cumulative distribution functions describe the probability up to a given value. <!-- An extension of summary statistics computes estimates of density and cumulative distribution functions for data, as the following example using our disbursements data will show. --></p></li>
</ol>
<!-- 5. （確率）密度と累積分布（Density and Cumulative Distribution）： 確率には所与の結果の確率を表す、密度関数（正規分布などの連続分布の場合）または質量関数（ポアソン分布などの離散分布の場合）がある。累積分布関数は、与えられた値までの確率を記述する。要約統計量（を拡張したdensity関数やecdf関数）は、出金データを使った下記の例が示すように、データの密度分布関数と累積分布関数の推定値を計算する。 -->
</section>
<section class="slide level2">

<h3 id="density-and-cumulative-distribution">Density and Cumulative Distribution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">density</span>(disburse[,<span class="st">"amount_paid"</span>]) <span class="co"># density</span></span>
<span id="cb92-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d, <span class="at">main =</span> <span class="st">"Density of Amount Paid"</span>)  <span class="co"># plot density</span></span>
<span id="cb92-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(d, <span class="at">col=</span><span class="st">"violet"</span>, <span class="at">border=</span><span class="st">"black"</span>) <span class="co"># add color</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="gaisho_2024_03_files/figure-revealjs/density-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb93-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ecdf</span>(disburse[,<span class="st">"amount_paid"</span>]), <span class="co"># 累積分布関数を計算</span></span>
<span id="cb93-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"Cumulative Density of Amount Paid"</span> <span class="co"># 図のタイトル</span></span>
<span id="cb93-4"><a href="" aria-hidden="true" tabindex="-1"></a>    ) <span class="co"># 誤植 ~いらない</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="gaisho_2024_03_files/figure-revealjs/CDF-1.png" width="960" class="r-stretch"><p><code>ecdf()</code> is a function that computes the empirical cumulative distribution function of a dataset.</p>
</section>
<section class="slide level2">

<ol start="6" type="1">
<li><strong>Random Sampling and Sample Bias</strong> : A sample is a subset of data from a larger dataset; statisticians call this larger dataset the population — a large, defined but sometimes theoretical or imaginary set of data. –&gt;</li>
</ol>
<!-- 2. ランダムサンプリング（Random Sampling）と標本バイアス（Sample Bias）：標本とは、 大きなデータセットから抽出したデータの部分集合である。統計学者は、この大きなデータセットを母集団（population）という。母集団は、（実際に存在する）明確なデータセットを指すこともあるが、理論上または想像上のデータセットを指すこともある。 -->
<ol start="7" type="1">
<li><p><strong>Central Limit Theorem</strong> : Proves that sums of independent variables asymptotically approach a Normal distribution as <em>sample size goes to infinity</em>. <!-- 7. 中心極限定理（Central Limit Theorem：CLT）： 無作為に抽出した標本の平均が、標本サイズが大きくなるにつれて漸近的に正規分布に近づくことを証明する定理である。 --></p></li>
<li><p><strong>Standard Error</strong> : This is roughly the standard deviation of the sample data. Standard deviation (which measures the variability of individual data points) is distinct from standard error (which measures the variability of a sample metric).</p></li>
</ol>
<!-- 8. 標準誤差（Standard Error）： わかりやすくいうとサンプルから得られた推定量の標準偏差（standard deviation）である。（データのバラツキを測定する）標準偏差は、（標本の推定量のバラツキを測定する）標準誤差とは異なる。 -->
<ol start="9" type="1">
<li><strong>Bootstrap and resampling</strong> : A bootstrap sample is taken with replacement from an observed dataset. Resampling takes repeated samples from observed data; includes both bootstrap and permutation (shuffling) procedures.</li>
</ol>
<!-- 1. リサンプリング（resampling）とブートストラップ（bootstrap）： リサンプリングは、観測されたデータから繰り返し標本を抽出する方法である。ブートストラップと順列（シャッフリング）手順の両方が含まれる。観察されたデータセットから復元を伴う（再）サンプリングから得られた標本をブートスラップ標本と呼ぶ。再サンプリングは，観察されたデータから繰り返し標本を取る．ブートストラップ法と並べ替え（シャッフリング）法の両方が含まれる。 -->
</section>
<section class="slide level2">

<ol start="10" type="1">
<li><strong>Hypothesis Tests</strong> (significance tests): Hypotheses are ways of turning complex problems into yes/no questions. <!-- They are another way of defining an A/B test.  --> <!-- The method grew commonplace after Neyman and Pearson (1933) provided an efficient hypothesis test.  --> Most audit procedures can be couched as hypothesis tests. Here are some key concepts in hypothesis testing: <!--
1.  仮説検定（hypothesis tests）・有意性検定（significance tests）： 仮説は、複雑な問題をYES/NOの問題に変える方法である。A/Bテストを定義するもう1つの方法である。Neyman and Pearson (1933)が効率的な仮説検定を提供した後、この方法が普及することとなった。ほとんどの監査手続は、仮説検定と言い換えることができる。以下は、仮説検定における重要な概念である。
--></li>
</ol>
<ul>
<li><em>p-value</em> : In statistical hypothesis testing, the p-value or probability value is, for a given hypothesis test, the probability that, when the null hypothesis is true, the statistical summary (such as the sample mean difference between two groups) would be equal to, or more extreme than, the actual observed results. The use and misuse of p-values in statistical hypothesis testing has become a controversial topic. <!-- - p値（p-value）： 統計的仮説検定では、p値または確率値（probability value）とは、ある仮説検定において、帰無仮説が真である場合に、その要約統計量（2群間の標本平均の差など）が実際の観察結果と等しいか、またはそれよりも極端な値になる確率である。統計的仮説検定におけるp値の使い方と誤用は、論争の的となっている。 --></li>
<li><em>Confidence Intervals</em> : Sampling leads to uncertain results, and that uncertainty is reduced through larger, higher quality samples. Confidence intervals are one way of describing the uncertainty of an estimate or prediction based on a sample. <!-- Confidence intervals are the only remaining tool from the old fiducial statistical inference. --> <!-- - 信頼区間（confidence interval）： サンプリングから得られる（母集団についての）結論は不確実であるが、その不確実性は、より大きな、より質の高い標本（をサンプリングすること）によって減少する。
    信頼区間は、標本に基づく推定値または予測値の不確実性を記述する1つの方法である。
    信頼区間は、（頻度主義に基づく）古典的な統計的推論における重要なツールである。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><em>Null and Alternative hypotheses</em> : Ways of dividing the decision space into two parts. <!-- 帰無仮説（null hypotheses）と対立仮説（alternative hypotheses）：（統計的決定理論において）決定空間（decision space）を（受容と棄却の）2つの部分集合に分割する方法と定義することができる。 --></li>
<li><em>One-way and two-way tests</em> : Hypothesis test that considers one tail or two of the distribution. <!-- - 片側検定（one-way test）と両側検定（two-way test）：分布の片裾を棄却域とする検定を片側検定と呼び、両裾を棄却域とする検定を両側検定と呼ぶ。 --></li>
<li><em>significance</em> (alpha): Critical value for selecting one or the other hypothesis. This is the probability that you will make a type I error. <!-- - 有意水準（significance level）またはα（alpha）： どちらかの仮説を選択するための閾値。これは第一種の過誤（type Ⅰ error）を犯す確率である。 --></li>
<li><em>power</em> (1-beta): Critical value for selecting one or the other hypothesis. This is the probability that you will not make a type II error. <!-- - 検出力（power）または1-β： どちらかの仮説を選択するための閾値。これは第二種の過誤（typeⅡ error）を犯さない確率である。 --></li>
<li><em>t-test</em> : An inferential statistic used to assess whether there is a significant difference between the means of two groups. <!-- -  t検定(t-test)：2群の平均の間に有意差があるかどうかを評価するために使用される（推測を伴う）統計手法。 --></li>
</ul>
</section>
<section class="slide level2">

<ol start="11" type="1">
<li><p><strong>Overfitting</strong> : Most measurements, and all samples misrepresent, in some way, the population. There is always danger of fitting models to these misrepresentations, thus generating incorrect decisions. This is controlled by <em>better sample size</em> and <em>quality</em>, and also by <em>resampling</em> to ensure robustness of estimation. <!-- 11.  過剰適合（overfitting）： ほとんどの測定とすべての標本は、何らかの形で（真の）母集団から誤差を伴って観察される。このような誤差を伴った観察にモデルを当てはめてしまうことで、誤った決定を生み出してしまう危険性が常に存在する。このような危険性は、より良いサンプルサイズとサンプルの質、また推定の頑健性を確保するためにリサンプリングを行うことによってコントロールできる。 --></p></li>
<li><p><strong>Linear Regression</strong> : Fits a model of the relationship between a scalar <strong>response</strong> (or <strong>dependent variable</strong>) and one or more <strong>explanatory variables</strong> (or <strong>independent variables</strong>). The following example builds a linear regression model to test the occurrence of insider breaches with audit fees and auditor decisions on section 404 audits, using the Sarbanes–Oxley data. <!-- 12.  線形回帰（linear regression）：1つの被説明変数（または従属変数）と1つ以上の説明変数（または独立変数）の間の関係のモデルをあてはめる手法。下記の例では、SOX法に基づく内部統制監査のデータを用いて、セクション404に基づく内部統制監査に関する監査報酬と監査人の意見を説明変数とし、インサイダー違反の発生を被説明変数として検証する線形回帰モデルを用いて検証を行う。 --></p></li>
</ol>
</section>
<section class="slide level2">

<p>Exploratory data analysis (EDA) using R’s <code>plotluck</code> package and <code>ch_2_data_types.csv</code> data file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">system.file</span>(</span>
<span id="cb94-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"extdata"</span>, <span class="st">"ch_2_data_types.csv"</span>, <span class="co"># csv file</span></span>
<span id="cb94-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">package =</span> <span class="st">"auditanalytics"</span>, <span class="at">mustWork =</span> <span class="cn">TRUE</span>))</span>
<span id="cb94-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># regression model OLS</span></span>
<span id="cb94-5"><a href="" aria-hidden="true" tabindex="-1"></a>lr <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> insd <span class="sc">~</span> audit_fee <span class="sc">+</span> effective_404, <span class="at">data =</span> df)</span>
<span id="cb94-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lr) <span class="co"># 結果の表示</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = insd ~ audit_fee + effective_404, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.1590 -0.1475 -0.1411 -0.1229  0.9292 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    1.486e-01  1.325e-02  11.217   &lt;2e-16 ***
audit_fee     -9.521e-10  4.449e-10  -2.140   0.0325 *  
effective_404  1.066e-02  1.816e-02   0.587   0.5574    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3449 on 1509 degrees of freedom
  (2 個の観測値が欠損のため削除されました)
Multiple R-squared:  0.003242,  Adjusted R-squared:  0.001921 
F-statistic: 2.454 on 2 and 1509 DF,  p-value: 0.08627</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Since <em>the dependent variable is dichotomous</em> (binary), results can be improved by using a <strong>logit model</strong> (from the built-in <em>glm</em> function). <!-- 被説明変数が二値変数なので、結果は（glm関数から）ロジット・モデル（logit model）を利用することで改善できる。 --></li>
<li>The following example also showcases <em>R</em>’s analysis of the residual errors (differences between the dependent variable values, and the estimated model on the right-hand side). <!-- 以下の例では、R による残差（被説明変数の実際の値とモデルからの推定値との差）の分析（①予測値と残差の散布図、②正規QQプロット、③予測値と標準化残差の絶対値の散布図、④標準化残差とてこ比の散布図）も紹介している。--></li>
<li>Leverage and distance provide measures of how particular transactions influence the estimation, and are important in identifying outliers. <!-- てこ比（leverage）とcookの距離（distance）は、特定の取引が推定与える影響についての測定値を提供し、異常値を識別する上で重要である。  --></li>
</ul>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="" aria-hidden="true" tabindex="-1"></a>lgt <span class="ot">&lt;-</span> <span class="fu">glm</span>( <span class="co"># general linear method</span></span>
<span id="cb96-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> insd <span class="sc">~</span> audit_fee <span class="sc">+</span> effective_404, <span class="co"># 回帰モデル</span></span>
<span id="cb96-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="co"># link function</span></span>
<span id="cb96-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df) <span class="co"># data frame</span></span>
<span id="cb96-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lgt) <span class="co"># 結果の表示</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = insd ~ audit_fee + effective_404, family = "binomial", 
    data = df)

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   -1.732e+00  1.128e-01 -15.354   &lt;2e-16 ***
audit_fee     -9.530e-09  4.496e-09  -2.120    0.034 *  
effective_404  8.928e-02  1.518e-01   0.588    0.557    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1214.8  on 1511  degrees of freedom
Residual deviance: 1209.4  on 1509  degrees of freedom
  (2 個の観測値が欠損のため削除されました)
AIC: 1215.4

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="graph-of-the-logit-model">Graph of the Logit Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lgt) <span class="co"># 図の作成</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="gaisho_2024_03_files/figure-revealjs/unnamed-chunk-21-1.png" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="gaisho_2024_03_files/figure-revealjs/unnamed-chunk-21-2.png" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="gaisho_2024_03_files/figure-revealjs/unnamed-chunk-21-3.png" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="gaisho_2024_03_files/figure-revealjs/unnamed-chunk-21-4.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section></section>
<section>
<section id="machine-learning-methods" class="title-slide slide level1 center">
<h1>Machine Learning Methods</h1>
<!-- ## 機械学習 -->
<p>Over the past decade, very useful extensions to twentieth century statistical models have been provided by advances in machine learning, and in particular deep-learning. <!-- この10年間で、20世紀の統計モデルに非常に有用な拡張機能が機械学習の進歩、とりわけ深層学習によって提供されている。 --> Deep learning is a branch of artificial intelligence that is computationally intensive, but highly flexible for inference from data. <!-- 深層学習は、計算量が多いが、データからの推論に非常に柔軟な人工知能の分野です。 --> Inference is a decision $$ (estimation, prediction) based on data <span class="math inline">x \in X</span> that hopefully contains information about a particular set of constructs. <!-- 推論は、データ$x \in X$に基づいて、特定の構造に関する情報を含んでいることを期待して、決定$\delta$（推定、予測）を行う。 --> Inference may be about: <!-- 推論は以下のようなものについて行われる。 --></p>
<ol type="1">
<li>Classification — e.g., identifying faces, threats. <!-- 1. 分類 : たとえば、顔、脅威の識別 --></li>
<li>Estimation — e.g., a vector <span class="math inline">\theta = \{\theta_1, \dots , \theta_n\}</span>. <!-- 2. 推定 : たとえば、ベクトル$\theta = \{\theta_1, \dots , \theta_n\}$。 --></li>
<li>Other decisions that may or may not be carried out in real time; e.g., driving a car. <!-- 3. リアルタイムで行われるかどうかはわからないその他の決定: たとえば、車の運転。 --></li>
</ol>
</section>
<section id="goals-of-machine-learning" class="slide level2">
<h2>Goals of Machine Learning</h2>
<ul>
<li>The implicit goal of machine learning is construction of decision strategies that minimize risk. <!-- 機械学習の暗黙の目標は、リスクを最小化する決定戦略の構築である。 --></li>
<li>Risk is an informal concept inherited from gambling, and roughly implies the expected loss from using a given decision strategy δ. <!-- リスクは、ギャンブルから受け継がれたインフォーマルな概念であり、おおよそ与えられた決定戦略$\delta$を使用した場合の期待損失を意味する。 --></li>
<li>Frequentist and Bayesian statisticians both base their decision strategies on real-world data, but sharply divided on the actual implementation and interpretation of decision risk. <!-- 頻度論的統計学者とベイズ統計学者は、ともに現実世界のデータに基づいて決定戦略を立てるが、決定リスクの実際の実装と解釈については、はっきりと分かれている。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>In practice, risk presents deep learning (and AI in general) with its greatest challenges. <!-- 実際、リスクは深層学習（およびAI全般）にとって最大の課題である。 --></li>
<li>For example, self-driving cars are trained on massive datasets extracted from many other cars; that knowledge of how to drive is encapsulated in weights in a network model that is firm-wired into a computer unit in a car. <!-- たとえば、自動運転車は、多くの他の車から抽出された大規模なデータセットで訓練される。 --> <!-- その運転方法の知識は、車のコンピュータユニットに固定されたネットワークモデルの重みにカプセル化されている。 --></li>
<li>It matters whether that unit was trained to save pedestrians, or to save property, or to save the driver—each implies a different decision risk. <!-- そのユニットが歩行者を救うために訓練されたか、財産を救うために訓練されたか、運転手を救うために訓練されたかは重要な問題である。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Traditionally, statistics have used a <strong>squared-error loss function</strong> <span class="math inline">l(\theta, \delta (X)) = \mathrm{E}_{\delta} [\delta (X) - \theta )^2]</span> where <span class="math inline">\delta(X) = \hat{\theta}</span> in the case of estimation. <!-- 従来、統計学では、推定の場合は$\delta(X) = \hat{\theta}$となる損失関数$l(\theta, \delta (X)) = \mathrm{E}_{\del/ta} [\delta (X) - \theta )^2]$を使用してきた。 --></li>
<li>This is easy to compute using pencil and paper, particularly when optimization relied on <em>first-order conditions</em> from calculus. <!-- これは、最適化が微積分の一次条件に依存していたときに、鉛筆と紙を使って簡単に計算することができた。 --></li>
<li>But most real-world decisions are not optimally made with squared-error loss functions. <!-- しかし、ほとんどの現実世界の決定は、二乗誤差損失関数を用いて最適に行われるものではない。 --></li>
<li>Although squared-error loss is still widely used, machine learning practitioners will also use more complex, sometimes asymmetric loss functions that more closely fit the real-world problems. <!-- 二乗誤差損失は今でも広く使われているが、機械学習を用いる実務家は、より複雑で、時には非対称な損失関数を使うこともある。 --> <!-- In particular for classification problems such as image recognition, squared-error loss makes little sense, and practitioners will tend to use cross-entropy, drawn from information theory, where the Kraft–McMillan theorem establishes the rationale for its application.  --> <!-- 特に画像認識などの分類問題では、二乗誤差損失はあまり意味がなく、実務家は情報理論から引き出された交差エントロピーを使う傾向がある。クラフト・マクミランの定理は、その適用根拠を確立している。 --></li>
<li>Business situations prefer asymmetric loss that penalizes costs and rewards revenues. <!-- ビジネスの現場では、コストをペナルティ、収益を報酬とする非対称損失が好まれている。 --></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>Whereas traditional statistics relies heavily on first-order conditions from calculus, <em>deep learning uses compute-intensive search algorithms</em> that explore the response surface of the risk function. <!-- 従来の統計学は、微積分の一階条件に大きく依存していたのに対し、深層学習は、リスク関数の応答曲面を探索する計算量の多い探索アルゴリズムを用いている。 --></p></li>
<li><p>The following example presents the “Hello World” of machine learning: recognizing handwritten numbers on the National Institute of Standards dataset. <!-- 以下の例は、機械学習の「Hello World」を示している: 国立標準技術研究所(National Institute of Standards)のデータセットに書かれた数値を認識する。 --></p></li>
</ul>
</section>
<section id="keras" class="slide level2">
<h2><code>keras</code></h2>
<p>Examples below assume that Tensorflow is installed. See <a href="https://www.tensorflow.org/install/">https://www.tensorflow.org/install/</a>。 <!-- 以下の例は、Tensorflowがインストールされていることを前提としている --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("keras") # install keras packages</span></span>
<span id="cb99-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb99-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># install_keras() # Run this only once. Installation takes time.</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- これで準備が整った。 -->
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="" aria-hidden="true" tabindex="-1"></a>mnist <span class="ot">&lt;-</span> <span class="fu">dataset_mnist</span>() <span class="co"># MNISTデータを読み込む</span></span>
<span id="cb100-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mnist)   <span class="co"># List class</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mnist) <span class="co"># See the structure of the data</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ train:List of 2
  ..$ x: int [1:60000, 1:28, 1:28] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ y: int [1:60000(1d)] 5 0 4 1 9 2 1 3 1 4 ...
 $ test :List of 2
  ..$ x: int [1:10000, 1:28, 1:28] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ y: int [1:10000(1d)] 7 2 1 0 4 1 4 9 5 9 ...</code></pre>
</div>
</div>
<p>The MNIST database was constructed from NIST’s Special Database 3 and Special Database 1 which contain <em>binary images of handwritten digits</em>.</p>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="" aria-hidden="true" tabindex="-1"></a>train_images <span class="ot">&lt;-</span> mnist<span class="sc">$</span>train<span class="sc">$</span>x <span class="co"># image data for training</span></span>
<span id="cb104-2"><a href="" aria-hidden="true" tabindex="-1"></a>train_labels <span class="ot">&lt;-</span> mnist<span class="sc">$</span>train<span class="sc">$</span>y <span class="co"># label data for training</span></span>
<span id="cb104-3"><a href="" aria-hidden="true" tabindex="-1"></a>test_images <span class="ot">&lt;-</span> mnist<span class="sc">$</span>test<span class="sc">$</span>x   <span class="co"># test image data</span></span>
<span id="cb104-4"><a href="" aria-hidden="true" tabindex="-1"></a>test_labels <span class="ot">&lt;-</span> mnist<span class="sc">$</span>test<span class="sc">$</span>y   <span class="co"># test label data</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Construct a neural network model. Keras Model composed of a linear stack of layers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="" aria-hidden="true" tabindex="-1"></a>network <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>() <span class="co"># null model</span></span>
<span id="cb105-2"><a href="" aria-hidden="true" tabindex="-1"></a>network <span class="sc">|&gt;</span></span>
<span id="cb105-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 28*28 pixel images are flattened into 784 pixel vectors</span></span>
<span id="cb105-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">512</span>, <span class="at">input_shape =</span> <span class="fu">c</span>(<span class="dv">28</span> <span class="sc">*</span> <span class="dv">28</span>)) <span class="sc">|&gt;</span></span>
<span id="cb105-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ReLU activation function converts negative values to zero</span></span>
<span id="cb105-6"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_activation</span>(<span class="st">'relu'</span>) <span class="sc">|&gt;</span> <span class="co"># ReLU activation function</span></span>
<span id="cb105-7"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span>  <span class="co"># 10 output layers 1:10</span></span>
<span id="cb105-8"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># softmax activation function convert the output to a probability distribution</span></span>
<span id="cb105-9"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layer_activation</span>(<span class="st">"softmax"</span>) <span class="co"># softmax activation function</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Specify the algorithm and function series.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="" aria-hidden="true" tabindex="-1"></a>network <span class="sc">|&gt;</span> <span class="fu">compile</span>(       <span class="co"># モデルをコンパイル</span></span>
<span id="cb106-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">optimizer =</span> <span class="st">"rmsprop"</span>,  <span class="co"># 最適化アルゴリズム</span></span>
<span id="cb106-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">loss =</span> <span class="st">"categorical_crossentropy"</span>, <span class="co"># 損失関数</span></span>
<span id="cb106-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">"accuracy"</span>) <span class="co"># 評価関数</span></span>
<span id="cb106-5"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="training-and-test-data">Training and Test Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Training data</span></span>
<span id="cb107-2"><a href="" aria-hidden="true" tabindex="-1"></a>train_images <span class="ot">&lt;-</span> <span class="fu">array_reshape</span>( <span class="co"># 行列に変換</span></span>
<span id="cb107-3"><a href="" aria-hidden="true" tabindex="-1"></a>    train_images,              <span class="co"># 訓練用画像データ</span></span>
<span id="cb107-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">60000</span>, <span class="dv">28</span> <span class="sc">*</span> <span class="dv">28</span>)          <span class="co"># 画像の形状</span></span>
<span id="cb107-5"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb107-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Test data</span></span>
<span id="cb107-7"><a href="" aria-hidden="true" tabindex="-1"></a>test_images <span class="ot">&lt;-</span> <span class="fu">array_reshape</span>( <span class="co"># 行列に変換</span></span>
<span id="cb107-8"><a href="" aria-hidden="true" tabindex="-1"></a>    test_images,              <span class="co"># テスト用画像データ</span></span>
<span id="cb107-9"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">28</span> <span class="sc">*</span> <span class="dv">28</span>)         <span class="co"># 画像の形状</span></span>
<span id="cb107-10"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb107-11"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># 0が黒，255が白のデータを0-1の範囲に正規化</span></span>
<span id="cb107-12"><a href="" aria-hidden="true" tabindex="-1"></a>train_images <span class="ot">&lt;-</span> train_images <span class="sc">/</span> <span class="dv">255</span></span>
<span id="cb107-13"><a href="" aria-hidden="true" tabindex="-1"></a>test_images  <span class="ot">&lt;-</span> test_images  <span class="sc">/</span> <span class="dv">255</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="" aria-hidden="true" tabindex="-1"></a>train_labels <span class="ot">&lt;-</span> <span class="fu">to_categorical</span>(train_labels) <span class="co">#</span></span>
<span id="cb108-2"><a href="" aria-hidden="true" tabindex="-1"></a>test_labels <span class="ot">&lt;-</span> <span class="fu">to_categorical</span>(test_labels)   <span class="co">#</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Label data is one hot encoded. <!-- ラベルデータをone-hotエンコーディング --></p></li>
<li><p><code>to_categolical()</code> takes a vector or 1 column matrix of class labels and converts it into a matrix with <span class="math inline">p</span> columns, one for each category.</p></li>
<li><p>(補足) 0〜9の手書き文字の大小関係は今回関係ないため，10個のカテゴリーを意味する10列の行列に変換してます。</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="training-the-model">Training the Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> network <span class="sc">|&gt;</span></span>
<span id="cb109-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>( <span class="co"># training the model</span></span>
<span id="cb109-3"><a href="" aria-hidden="true" tabindex="-1"></a>        train_images, <span class="co"># training image data</span></span>
<span id="cb109-4"><a href="" aria-hidden="true" tabindex="-1"></a>        train_labels, <span class="co"># training label data</span></span>
<span id="cb109-5"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">epochs =</span> <span class="dv">10</span>,  <span class="co"># the number of times the model will be trained</span></span>
<span id="cb109-6"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="at">batch_size =</span> <span class="dv">128</span> <span class="co"># the number of samples per gradient update</span></span>
<span id="cb109-7"><a href="" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/10
469/469 - 1s - loss: 0.2602 - accuracy: 0.9245 - 1s/epoch - 3ms/step
Epoch 2/10
469/469 - 2s - loss: 0.1051 - accuracy: 0.9690 - 2s/epoch - 3ms/step
Epoch 3/10
469/469 - 2s - loss: 0.0690 - accuracy: 0.9790 - 2s/epoch - 5ms/step
Epoch 4/10
469/469 - 2s - loss: 0.0500 - accuracy: 0.9850 - 2s/epoch - 5ms/step
Epoch 5/10
469/469 - 3s - loss: 0.0377 - accuracy: 0.9889 - 3s/epoch - 6ms/step
Epoch 6/10
469/469 - 2s - loss: 0.0288 - accuracy: 0.9912 - 2s/epoch - 4ms/step
Epoch 7/10
469/469 - 2s - loss: 0.0224 - accuracy: 0.9936 - 2s/epoch - 4ms/step
Epoch 8/10
469/469 - 2s - loss: 0.0177 - accuracy: 0.9947 - 2s/epoch - 5ms/step
Epoch 9/10
469/469 - 3s - loss: 0.0133 - accuracy: 0.9961 - 3s/epoch - 6ms/step
Epoch 10/10
469/469 - 2s - loss: 0.0107 - accuracy: 0.9967 - 2s/epoch - 3ms/step</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="plot">Plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(history) <span class="co"># 訓練の履歴をプロット</span></span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="gaisho_2024_03_files/figure-revealjs/plot_keras-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>model evaluation <!-- # モデルを評価 --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> network <span class="sc">|&gt;</span></span>
<span id="cb112-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">evaluate</span>(test_images, test_labels, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb112-3"><a href="" aria-hidden="true" tabindex="-1"></a>metrics <span class="sc">|&gt;</span> <span class="fu">kable</span>()</span></code><button title="コピー" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">loss</td>
<td style="text-align: right;">0.0765595</td>
</tr>
<tr class="even">
<td style="text-align: left;">accuracy</td>
<td style="text-align: right;">0.9817000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="keras-model" class="slide level2">
<h2><code>keras</code> model</h2>
<ul>
<li>This particular Keras model overfits the MNIST data, with a final accuracy of 98% and loss of 7%. <!-- この特定のKerasモデルは、MNISTデータに過学習しており、最終的な精度は98%、損失は7%である。 --></li>
</ul>
<p>Machine learning is a vast and rapidly evolving field. <!-- 機械学習は広大で急速に進化している分野である。 --> It is increasingly for the analysis of social network and other text based intelligence required for the analytical review portion (and other parts) of the audit. <!-- 監査の分析的レビュー部分（およびその他の部分）に必要なソーシャルネットワークやその他のテキストベースの知能の分析にますます必要とされている。 --> In the future, expect its role in auditing to expand, as suitable models are developed in the field. <!-- 将来的には、適切なモデルが開発されるにつれて、監査における役割が拡大することが予想される。 --></p>
<!-- ##
Statistical Perspectives on Audit Evidence and its Information Content
-->
<!-- ## 監査証拠の統計的側面と情報内容 -->
</section></section>
<section>
<section id="statistical-perspectives-on-audit-evidence-and-its-information-content" class="title-slide slide level1 center">
<h1>Statistical Perspectives on Audit Evidence and its Information Content</h1>

</section>
<section id="補足" class="slide level2">
<h2>補足</h2>
<p>パラメータが<span class="math inline">\theta</span>である母集団の従う分布の確率密度関数を<span class="math inline">f(x \mid \theta)</span>とする。 そのとき，尤度関数は，</p>
<p><span class="math display">
L (\theta) = f(x \mid \theta)
</span></p>
<p>となり，対数尤度関数は，</p>
<p><span class="math display">
l (\theta) = \log L(\theta)
</span></p>
<p>となり，スコア関数は，</p>
<p><span class="math display">
\frac{\partial}{\partial \theta} \log l (\theta)
</span></p>
<p>と定義されます。</p>
</section>
<section id="support-and-the-additivity-of-evidence-the-log-likelihood" class="slide level2">
<h2>Support and the Additivity of Evidence: The Log-Likelihood</h2>
<!-- ### 監査証拠のサポートと追加可能性：対数尤度 -->
<ul>
<li>The log-likelihood has an intuitive interpretation, as suggested by the term <strong>“support</strong>.” <!-- wikiからのコピペ --> <!-- 対数尤度には、「サポート」という用語が示すように、直感的な解釈がある。 --></li>
<li>Given independent events, the overall log-likelihood is the sum of the log-likelihoods of the individual events, just as the overall log-probability is the sum of the log-probability of the individual events. <!-- wiki likelihood functionから コピペ --> <!-- 独立した事象が与えられたとき、全体の対数尤度は個々の事象の対数尤度の和であり、全体の対数確率は個々の事象の対数確率の和である。 --></li>
<li>Viewing data as evidence, this is interpreted as “support from independent evidence adds,” and the log-likelihood is the “<em>weight of evidence</em>.” <!-- wiki likelihood functionから コピペ --> <!-- データを証拠として見ると、これは「独立した証拠からのサポートが加わる」と解釈され、対数尤度は「証拠の重み」となる。 --></li>
<li>Interpreting <em>negative log-probability</em> as <em>information content</em>, log-likelihood of a model, given an event, is the negative of the surprisal of the event, given the model <!-- a model is supported by an event to the extent that the event is unsurprising, given the model. --> <!-- - wikiから完コピ --> <!-- 負の対数確率を情報量や驚きとして解釈すると、ある事象が与えられたときのモデルのサポート（対数尤度）は、そのモデル所与としたときの，当該事象の意外性（負の対数確率）の負の値となる。 --> <!-- つまり，そのモデルを所与として，当該事象が驚くべきものではない範囲で，モデルは事象によってサポートされる。 --> <!-- Just as the likelihood, given no event, being 1, the log-likelihood, given no event, is 0, which corresponds to the value of the empty sum: without any data, there is no support for any models. wikiから完コピ --> <!-- 事象がない場合の尤度が1であるように、事象がない場合の対数尤度は0であり、これは空の和の値に対応する: データがない場合、どのモデルにもサポートはない。 --> <!-- The log-likelihood is particularly convenient for maximum likelihood estimation. --> <!-- 対数尤度は、最尤推定に特に便利である。 --> <!-- Because logarithms are strictly increasing functions, maximizing the likelihood is equivalent to maximizing the log-likelihood. --> <!-- 対数は単調増加関数であるため、尤度を最大化することは対数尤度を最大化することと同じである。 --> <!-- Since concavity plays a key role in the maximization, and since most common probability distributions—in particular the exponential family—are only logarithmically concave, it is usually more convenient to work with a logarithmic transformation of the likelihood function, known as the log-likelihood function. --> <!-- 凹性は最大化において重要な役割を果たすが、一般的な確率分布、特に指数族は対数的に凹であるため、対数尤度関数として知られる尤度関数の対数変換で作業する方が便利である。 --></li>
</ul>
</section>
<section id="the-score" class="slide level2">
<h2>The “Score”　</h2>
<!-- #### ここ完全に英語版wikipediaの文章のコピペ (あとで消す) -->
<ul>
<li>In statistics, the <strong>score</strong> (or informant) is the gradient of the <em>log-likelihood function</em> with respect to the parameter vector. <!-- 統計学において、スコア（またはインフォーマント）は、パラメータベクトルに関する対数尤度関数の勾配である。 --></li>
<li>Evaluated at a particular point, the score indicates the steepness of the log-likelihood function and thereby the sensitivity to infinitesimal changes to the parameter values. <!-- パラメータベクトルの特定の点で評価されるスコアは、対数尤度関数の急勾配を示し、それによってパラメータ値の微小な変化に対する感度を示す。 --></li>
<li>If the log-likelihood function is continuous over the parameter space, the score will vanish at a local maximum or minimum; this fact is used in maximum likelihood estimation to find the parameter values that maximize the likelihood function. <!-- 対数尤度関数がパラメータ空間上で連続である場合、スコアは局所的な最大値または最小値で消滅する。 --> <!-- この事実は、最尤推定において尤度関数を最大化するパラメータ値を見つけるために用いられている。 --></li>
<li>Since the score is a function of the observations that are subject to sampling error, it lends itself to a test statistic known as score test in which the parameter is held at a particular value. <!-- スコアは、サンプリング誤差の影響を受ける観測値の関数であるため、パラメータを特定の値に保持するスコア検定として知られる検定統計量に適している。 --> <!-- Further, the ratio of two likelihood functions evaluated at two distinct parameter values can be understood as a definite integral of the score function. --> <!-- さらに、2つの異なるパラメータ値で評価された2つの尤度関数の比は、スコア関数の定積分として理解することができる。 --></li>
</ul>
<!-- ### フィッシャー情報量 -->
</section>
<section id="fisher-information" class="slide level2">
<h2>Fisher Information</h2>
<ul>
<li>In mathematical statistics, the Fisher information (sometimes simply called information) is a way of measuring the amount of information that an observable random variable <span class="math inline">X</span> carries about an unknown parameter <span class="math inline">\theta</span> of a distribution that models <span class="math inline">X</span>. <!-- 数理統計学において、フィッシャー情報量（単に情報量とよばれることもある）は、観測可能な確率変数$X$が$X$をモデル化する分布の未知のパラメータ$\theta$についてどれだけの情報を持っているかを測定する方法である。 --></li>
<li>Formally, it is the variance of fthe score, or the expected value of the observed information. <!-- 厳密には、フィッシャー情報量はスコアの分散、または観測情報の期待値である。 --> <!-- In Bayesian statistics, the asymptotic distribution of the posterior mode depends on the Fisher information and not on the prior (according to the Bernstein–von Mises theorem, which was anticipated by Laplace for exponential families). --> <!-- xlindoのコピペとwikipediaのコピペ --> <!-- ベイズ統計学では、事後モードの漸近分布は事前分布に依存せず、フィッシャー情報量に依存する（指数族に対してラプラスによって予想されたBernstein–von Misesの定理による）。 --> <!-- The role of the Fisher information in the asymptotic theory of maximum likelihood estimation was emphasized by the statistician Ronald Fisher (following some initial results by Francis Ysidro Edgeworth).  wikiのコピペ --> <!-- 統計学者のロナルド・フィッシャーは、（フランシス・イシドロ・エッジワースによる初期の結果に続いて）最尤推定の漸近理論におけるフィッシャー情報量の役割を強調した。 --> <!-- The Fisher information is also used in the calculation of the Jeffreys prior, which is used in Bayesian statistics. --> <!-- フィッシャー情報量は、ベイズ統計学で使用されるジェフリーズ事前分布(Jefferrys prior)の計算にも使用される。 --> <!-- The Fisher-information matrix is used to calculate the covariance matrices associated with maximum likelihood estimates. wikiコピペ --> <!-- フィッシャー情報量行列は、最尤推定に関連する共分散行列を計算するために使用される。 --> <!-- It can also be used in the formulation of test statistics, such as the Wald test. wikiコピペ--> <!-- フィッシャー情報量は、ワルド検定などの検定統計量の定式化にも使用できる。 --> <!-- Statistical systems of a scientific nature (physical, biological, etc.) whose likelihood functions obey shift invariance have been shown to obey maximum Fisher information.  wikiコピペ--> <!-- 最尤関数がシフト不変性を満たす科学的な統計システム（物理的、生物学的など）は、最大フィッシャー情報量を満たすことが示されている。 --> <!-- The level of the maximum depends upon the nature of the system constraints. wikiコピペ --> <!-- 最大値の水準は、システムの制約の性質によって異なる。 --></li>
<li>The Fisher information is a way of measuring the amount of information that an observable random variable <span class="math inline">X</span> carries about an unknown parameter $$ upon which the probability of <span class="math inline">X</span> depends. <!-- フィッシャー情報量は、観測可能な確率変数$X$が$X$の確率に依存する未知のパラメータ$\theta$についてどれだけの情報を持っているかを測定する方法である。 --> <!-- Let f(X; θ) be the probability density function (or probability mass function) for X conditional on the value of θ.  --> <!-- $f(X; \theta)$を、$\theta$の値に条件付けられた$X$の確率密度関数（または確率質量関数）であるとしよう。 --> <!-- It describes the probability that we observe a given outcome of X, given a known value of θ.  --> <!-- これは、既知の値$\theta$が与えられたとき、$X$の特定の値を観測する確率を表している。 --> <!-- If f is sharply peaked with respect to changes in θ, it is easy to indicate the “correct” value of θ from the data, or equivalently, that the data X provides a lot of information about the parameter θ.  --> <!-- $f$が$\theta$の変化に対して鋭いピークをなしている場合、データから「正しい」$\theta$の値を示すことは容易であり、同様に、データ$X$がパラメータ$\theta$について多くの情報を提供していることがわかる。 --> <!-- If the likelihood f is flat and spread out, then it would take many samples like of X to estimate the actual “true” value of θ that would be obtained using the entire population being sampled. --> <!-- 尤度$f$が平坦で広がっている場合、$X$のような多くのサンプルが必要となる。これは、サンプリングされる母集団を用いることで得られる実際の「真の」の値$\theta$を推定するために必要となる。 --></li>
</ul>
<div class="quarto-auto-generated-content">
<p><img src="img/kobe_logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Kobe University, Business Administration</p>
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="gaisho_2024_03_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="gaisho_2024_03_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="gaisho_2024_03_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="gaisho_2024_03_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="gaisho_2024_03_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="gaisho_2024_03_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="gaisho_2024_03_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="gaisho_2024_03_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="gaisho_2024_03_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="gaisho_2024_03_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'convex',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1400,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "コピーしました");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "コピーしました");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script type="module">
    // Handle cell initialization initialization
    qwebrCellDetails.map(
      (entry) => {
        // Handle the creation of the element
        qwebrCreateHTMLElement(entry);
        // In the event of interactive, initialize the monaco editor
        if (entry.options.context == EvalTypes.Interactive) {
          qwebrCreateMonacoEditorInstance(entry);
        }
      }
    );

    // Identify non-interactive cells (in order)
    const filteredEntries = qwebrCellDetails.filter(entry => {
      const contextOption = entry.options && entry.options.context;
      return ['output', 'setup'].includes(contextOption) || (contextOption == "interactive" && entry.options && entry.options.autorun === 'true');
    });

    // Condition non-interactive cells to only be run after webR finishes its initialization.
    qwebrInstance.then(
      async () => {
        const nHiddenCells = filteredEntries.length;
        var currentHiddenCell = 0;


        // Modify button state
        qwebrSetInteractiveButtonState(`🟡 Running hidden code cells ...`, false);

        // Begin processing non-interactive sections
        // Due to the iteration policy, we must use a for() loop.
        // Otherwise, we would need to switch to using reduce with an empty
        // starting promise
        for (const entry of filteredEntries) {

          // Determine cell being examined
          currentHiddenCell = currentHiddenCell + 1;
          const formattedMessage = `Evaluating hidden cell ${currentHiddenCell} out of ${nHiddenCells}`;

          // Update the document status header
          if (qwebrShowStartupMessage) {
            qwebrUpdateStatusHeader(formattedMessage);
          }

          // Display the update in non-active areas
          qwebrUpdateStatusMessage(formattedMessage);

          // Extract details on the active cell
          const evalType = entry.options.context;
          const cellCode = entry.code;
          const qwebrCounter = entry.id;

          if (['output', 'setup'].includes(evalType)) {
            // Disable further global status updates
            const activeContainer = document.getElementById(`qwebr-non-interactive-loading-container-${qwebrCounter}`);
            activeContainer.classList.remove('qwebr-cell-needs-evaluation');
            activeContainer.classList.add('qwebr-cell-evaluated');

            // Update status on the code cell
            const activeStatus = document.getElementById(`qwebr-status-text-${qwebrCounter}`);
            activeStatus.innerText = " Evaluating hidden code cell...";
            activeStatus.classList.remove('qwebr-cell-needs-evaluation');
            activeStatus.classList.add('qwebr-cell-evaluated');
          }

          switch (evalType) {
            case 'interactive':
              // TODO: Make this more standardized.
              // At the moment, we're overriding the interactive status update by pretending its
              // output-like. 
              const tempOptions = entry.options;
              tempOptions["context"] = "output"
              // Run the code in a non-interactive state that is geared to displaying output
              await qwebrExecuteCode(`${cellCode}`, qwebrCounter, tempOptions);
              break;
            case 'output':
              // Run the code in a non-interactive state that is geared to displaying output
              await qwebrExecuteCode(`${cellCode}`, qwebrCounter, entry.options);
              break;
            case 'setup':
              const activeDiv = document.getElementById(`qwebr-noninteractive-setup-area-${qwebrCounter}`);

              // Store code in history
              qwebrLogCodeToHistory(cellCode, entry.options);

              // Run the code in a non-interactive state with all output thrown away
              await mainWebR.evalRVoid(`${cellCode}`);
              break;
            default: 
              break; 
          }

          if (['output', 'setup'].includes(evalType)) {
            // Disable further global status updates
            const activeContainer = document.getElementById(`qwebr-non-interactive-loading-container-${qwebrCounter}`);
            // Disable visibility
            activeContainer.style.visibility = 'hidden';
            activeContainer.style.display = 'none';
          }
        }
      }
    ).then(
      () => {
        // Release document status as ready

        if (qwebrShowStartupMessage) {
          qwebrStartupMessage.innerText = "🟢 Ready!"
        }
      
        qwebrSetInteractiveButtonState(
          `<i class="fa-solid fa-play qwebr-icon-run-code"></i> <span>Run Code</span>`, 
          true
        );  
      }
    );
    </script>
    

</body></html>